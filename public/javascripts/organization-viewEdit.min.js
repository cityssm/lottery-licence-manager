"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),t=document.getElementById("container--remarks");if(e){const e=parseInt(t.getAttribute("data-organization-id"));let n;const a=function(t){const a=parseInt(t.currentTarget.getAttribute("data-remark-index"));llm.organizationRemarks.openEditRemarkModal(e,a,n)},s=function(t){const a=parseInt(t.currentTarget.getAttribute("data-remark-index"));llm.organizationRemarks.deleteRemark(e,a,!0,n)};n=function(){llm.organizationRemarks.getRemarksByOrganizationID(e,function(e){if(cityssm.clearElement(t),0===e.length)t.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(let n=0;n<e.length;n+=1){const a=e[n];t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(a.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(a.remark)+'</p><p class="is-size-7">'+(a.recordCreate_timeMillis===a.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+a.recordUpdate_userName+" - "+a.remarkDateString+" "+a.remarkTimeString+"</p></div>"+(a.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+a.remarkIndex+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+a.remarkIndex+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}const n=t.getElementsByClassName("is-edit-remark-button");for(let e=0;e<n.length;e+=1)n[e].addEventListener("click",a);const o=t.getElementsByClassName("is-delete-remark-button");for(let e=0;e<o.length;e+=1)o[e].addEventListener("click",s)}})},document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(t){t.preventDefault(),llm.organizationRemarks.openAddRemarkModal(e,n)});const o=t.getElementsByClassName("is-edit-remark-button");for(let e=0;e<o.length;e+=1)o[e].addEventListener("click",a);const r=t.getElementsByClassName("is-delete-remark-button");for(let e=0;e<r.length;e+=1)r[e].addEventListener("click",s)}const n=document.getElementById("remark--searchStr");if(n){n.value="";const e=document.getElementById("remark--displayCount"),a=t.getElementsByClassName("is-remark-block");n.addEventListener("keyup",function(){const t=n.value.trim().toLowerCase().split(" ");let s=a.length;for(let e=0;e<a.length;e+=1){const n=a[e].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase();let o=!0;for(let e=0;e<t.length;e+=1)if(-1===n.indexOf(t[e])){o=!1,s-=1;break}o?a[e].classList.remove("is-hidden"):a[e].classList.add("is-hidden")}e.innerText=s.toString()})}let a=!1,s={};const o=document.getElementById("bankRecordFilter--bankingYear"),r=document.getElementById("bankRecordFilter--accountNumber"),i=document.getElementById("table--bankRecords"),d=i.getAttribute("data-organization-id");function c(){!function(){s={},i.classList.remove("has-status-loaded"),i.classList.add("has-status-loading");const e=i.getElementsByClassName("is-bank-record-button");for(let t=0;t<e.length;t+=1){const n=e[t];n.classList.remove("is-success"),n.classList.remove("is-info"),n.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>',n.setAttribute("data-record-index","")}}();const e=function(e){for(let t=0;t<e.length;t+=1){const n=e[t];s[n.recordIndex]=n;const a=i.querySelector("[data-banking-month='"+n.bankingMonth+"']").querySelector("[data-bank-record-type='"+n.bankRecordType+"']");a&&(a.setAttribute("data-record-index",n.recordIndex.toString()),n.recordIsNA?(a.classList.add("is-info"),a.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'+(""===n.recordNote?"":' <span class="ml-2" data-tooltip="'+cityssm.escapeHTML(n.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')):(a.classList.add("is-success"),a.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+n.recordDateString+"</small>"+(""===n.recordNote?"":' <span class="ml-2" data-tooltip="'+cityssm.escapeHTML(n.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')))}i.classList.remove("has-status-loading"),i.classList.add("has-status-loaded")};""===r.value?e([]):cityssm.postJSON("/organizations/doGetBankRecords",{organizationID:d,bankingYear:o.value,accountNumber:r.value},e)}function l(){cityssm.postJSON("/organizations/doGetBankRecordStats",{organizationID:d},function(e){const t=(new Date).getFullYear();let n=t-1;if(0===e.length)r.innerHTML='<option value="">(No Accounts Recorded)</option>';else{r.innerHTML="";for(let t=0;t<e.length;t+=1){const a=e[t];n=Math.min(a.bankingYearMin,n);const s=cityssm.escapeHTML(a.accountNumber);r.insertAdjacentHTML("beforeend",'<option value="'+s+'">'+s+" (From "+a.bankingYearMin+" to "+a.bankingYearMax+")</option>")}}o.innerHTML="";for(let e=t;e>=n;e-=1)o.insertAdjacentHTML("beforeend",'<option value="'+e+'">'+e+"</option>");c()})}if(o.addEventListener("change",c),r.addEventListener("change",c),e){const e=function(e){let t,n=!1,i=!1,m=!0;const u=function(e){e.preventDefault(),cityssm.postJSON("/organizations/"+(n?"doEditBankRecord":"doAddBankRecord"),e.currentTarget,function(e){e.success?(t(),n||i&&!m?c():(a=!1,l())):cityssm.alertModal("Record Not Saved",e.message,"OK","danger")})},g=function(e){e.preventDefault();const n=e.currentTarget.getAttribute("data-record-index");cityssm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",function(){cityssm.postJSON("/organizations/doDeleteBankRecord",{organizationID:d,recordIndex:n},function(){t(),c()})})},b=e.currentTarget;let k="";const f=r.value;m=""===f;let p="",y=!1,h="";const v=new Date,E=v.getFullYear(),R=cityssm.dateToString(v);let L=R;v.setMonth(v.getMonth()-1);let I=v.getFullYear(),T=v.getMonth()+1;if("is-add-bank-record-button"!==b.id)if(i=!0,k=b.getAttribute("data-record-index"),I=parseInt(o.value),""===k)T=parseInt(b.closest("tr").getAttribute("data-banking-month")),p=b.getAttribute("data-bank-record-type");else{const e=s[parseInt(k)];n=!0,T=e.bankingMonth,p=e.bankRecordType,y=e.recordIsNA,L=e.recordDateString,h=e.recordNote}cityssm.openHtmlModal("organization-bankRecordEdit",{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=d,document.getElementById("bankRecordEdit--recordIndex").value=k;const e=document.getElementById("bankRecordEdit--accountNumber");e.value=f;const t=document.getElementById("bankRecordEdit--bankingYear");t.value=I.toString(),t.setAttribute("max",E.toString());const a=document.getElementById("bankRecordEdit--bankingMonth");a.value=T.toString();const s=document.getElementById("bankRecordEdit--bankRecordType");for(let e=0;e<exports.config_bankRecordTypes.length;e+=1)s.insertAdjacentHTML("beforeend",'<option value="'+exports.config_bankRecordTypes[e].bankRecordType+'">'+exports.config_bankRecordTypes[e].bankRecordTypeName+"</option>");""===p&&s.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>'),s.value=p;const o=document.getElementById("bankRecordEdit--recordDateString");if(o.value=L,o.setAttribute("max",R),y&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked"),document.getElementById("bankRecordEdit--recordNote").value=h,i&&(m||(e.setAttribute("readonly","readonly"),e.classList.add("is-readonly")),t.setAttribute("readonly","readonly"),t.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),a.classList.add("is-readonly"),s.setAttribute("readonly","readonly"),s.classList.add("is-readonly")),n){const e=document.getElementById("bankRecordEdit--deleteRecordButton");e.setAttribute("data-record-index",k),e.addEventListener("click",g)}else document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},onshown:function(e,n){t=n,e.getElementsByTagName("form")[0].addEventListener("submit",u)}})},t=i.getElementsByTagName("button");for(let n=0;n<t.length;n+=1)t[n].addEventListener("click",e);document.getElementById("is-add-bank-record-button").addEventListener("click",e)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(e){"organizationTabContent--bankRecords"!==e.id||a||(a=!0,l())}})}();