(function(){function E(){z={};g.classList.remove("has-status-loaded");g.classList.add("has-status-loading");for(var a=g.getElementsByTagName("button"),c=0;c<a.length;c+=1){var b=a[c];b.classList.remove("is-success");b.classList.remove("is-info");b.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>';b.setAttribute("data-record-index","")}}function u(){E();llm.postJSON("/organizations/doGetBankRecords",{organizationID:y,
bankingYear:v.value,accountNumber:q.value},function(a){for(var c=0;c<a.length;c+=1){var b=a[c];z[b.recordIndex]=b;var e=g.querySelector("[data-banking-month='"+b.bankingMonth+"']").querySelector("[data-bank-record-type='"+b.bankRecordType+"']");e&&(e.setAttribute("data-record-index",b.recordIndex),b.recordIsNA?(e.classList.add("is-info"),e.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'):(e.classList.add("is-success"),e.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+
b.recordDateString+"</small>"))}g.classList.remove("has-status-loading");g.classList.add("has-status-loaded")})}function C(){llm.postJSON("/organizations/doGetBankRecordStats",{organizationID:y},function(a){var c=(new Date).getFullYear(),b=c-1;if(0===a.length)q.innerHTML='<option value="">(No Accounts Recorded)</option>';else{q.innerHTML="";for(var e=0;e<a.length;e+=1){var d=a[e],b=Math.min(d.bankingYearMin,b),h=llm.escapeHTML(d.accountNumber);q.insertAdjacentHTML("beforeend",'<option value="'+h+
'">'+h+" (From "+d.bankingYearMin+" to "+d.bankingYearMax+")</option>")}}v.innerHTML="";for(a=c;a>=b;--a)v.insertAdjacentHTML("beforeend",'<option value="'+a+'">'+a+"</option>");u()})}var l="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),k=document.getElementById("container--remarks");if(l){var r=k.getAttribute("data-organization-id"),n,w=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.openEditRemarkModal(r,a,n)},x=function(a){a=
a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.deleteRemark(r,a,!0,n)};n=function(){llm.organizationRemarks.getRemarksByOrganizationID(r,function(a){llm.clearElement(k);if(0===a.length)k.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(var c=0;c<a.length;c+=1){var b=a[c];k.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+
(b.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+llm.escapeHTML(b.remark)+'</p><p class="is-size-7">'+b.recordUpdate_userName+" - "+b.remarkDateString+" "+b.remarkTimeString+"</p></div>"+(b.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+b.remarkIndex+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+
b.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}a=k.getElementsByClassName("is-edit-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",w);a=k.getElementsByClassName("is-delete-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",x)}})};document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(a){a.preventDefault();llm.organizationRemarks.openAddRemarkModal(r,
n)});for(var d=k.getElementsByClassName("is-edit-remark-button"),f=0;f<d.length;f+=1)d[f].addEventListener("click",w);d=k.getElementsByClassName("is-delete-remark-button");for(f=0;f<d.length;f+=1)d[f].addEventListener("click",x)}if(d=document.getElementById("remark--searchStr")){d.value="";var F=document.getElementById("remark--displayCount"),m=k.getElementsByClassName("is-remark-block");d.addEventListener("keyup",function(a){a=a.currentTarget.value.trim().toLowerCase().split(" ");for(var c=m.length,
b=0;b<m.length;b+=1){for(var d=m[b].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase(),f=!0,h=0;h<a.length;h+=1)if(-1===d.indexOf(a[h])){f=!1;--c;break}f?m[b].classList.remove("is-hidden"):m[b].classList.add("is-hidden")}F.innerText=c})}var A=!1,z={},v=document.getElementById("bankRecordFilter--bankingYear"),q=document.getElementById("bankRecordFilter--accountNumber"),g=document.getElementById("table--bankRecords"),y=g.getAttribute("data-organization-id");v.addEventListener("change",
u);q.addEventListener("change",u);if(l){l=function(a){var c,b=!1,d=function(a){a.preventDefault();llm.postJSON("/organizations/"+(b?"doEditBankRecord":"doAddBankRecord"),a.currentTarget,function(a){a.success?(c(),b?u():(A=!1,C())):llm.alertModal("Record Not Saved",a.message,"OK","danger")})},f=function(a){a.preventDefault();var b=a.currentTarget.getAttribute("data-record-index");llm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",function(){llm.postJSON("/organizations/doDeleteBankRecord",
{organizationID:y,recordIndex:b},function(){c();u()})})};a=a.currentTarget;var h="",k=q.value,g="",l=!1,m="",t=new Date,r=t.getFullYear(),n=llm.dateToString(t),w=n;t.setMonth(t.getMonth()-1);var x=t.getFullYear(),B=t.getMonth()+1,D=!1;"is-add-bank-record-button"!==a.id&&(D=!0,h=a.getAttribute("data-record-index"),x=v.value,""===h?(B=a.closest("tr").getAttribute("data-banking-month"),g=a.getAttribute("data-bank-record-type")):(a=z[parseInt(h)],b=!0,B=a.bankingMonth,g=a.bankRecordType,l=a.recordIsNA,
w=a.recordDateString,m=a.recordNote));llm.openHtmlModal("organization-bankRecordEdit",{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=y;document.getElementById("bankRecordEdit--recordIndex").value=h;var a=document.getElementById("bankRecordEdit--accountNumber");a.value=k;var c=document.getElementById("bankRecordEdit--bankingYear");c.value=x;c.setAttribute("max",r);var d=document.getElementById("bankRecordEdit--bankingMonth");d.value=B;for(var e=document.getElementById("bankRecordEdit--bankRecordType"),
p=0;p<llm.config_bankRecordTypes.length;p+=1)e.insertAdjacentHTML("beforeend",'<option value="'+llm.config_bankRecordTypes[p].bankRecordType+'">'+llm.config_bankRecordTypes[p].bankRecordTypeName+"</option>");""===g&&e.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>');e.value=g;p=document.getElementById("bankRecordEdit--recordDateString");p.value=w;p.setAttribute("max",n);l&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked");document.getElementById("bankRecordEdit--recordNote").value=
m;D&&(a.setAttribute("readonly","readonly"),c.setAttribute("readonly","readonly"),d.setAttribute("readonly","readonly"),e.setAttribute("readonly","readonly"),a.classList.add("is-readonly"),c.classList.add("is-readonly"),d.classList.add("is-readonly"),e.classList.add("is-readonly"));b?(a=document.getElementById("bankRecordEdit--deleteRecordButton"),a.setAttribute("data-record-index",h),a.addEventListener("click",f)):document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},onshown:function(a,
b){c=b;a.getElementsByTagName("form")[0].addEventListener("submit",d)}})};d=g.getElementsByTagName("button");for(f=0;f<d.length;f+=1)d[f].addEventListener("click",l);document.getElementById("is-add-bank-record-button").addEventListener("click",l)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(a){"organizationTab--bankRecords"!==a.id||A||(A=!0,C())}})})();
