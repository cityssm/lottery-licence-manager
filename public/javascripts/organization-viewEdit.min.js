(function(){function E(){y={};h.classList.remove("has-status-loaded");h.classList.add("has-status-loading");for(var a=h.getElementsByTagName("button"),c=0;c<a.length;c+=1){var b=a[c];b.classList.remove("is-success");b.classList.remove("is-info");b.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>';b.setAttribute("data-record-index","")}}function t(){E();llm.postJSON("/organizations/doGetBankRecords",{organizationID:w,
bankingYear:u.value,accountNumber:q.value},function(a){for(var c=0;c<a.length;c+=1){var b=a[c];y[b.recordIndex]=b;var f=h.querySelector("[data-banking-month='"+b.bankingMonth+"']").querySelector("[data-bank-record-type='"+b.bankRecordType+"']");f&&(f.setAttribute("data-record-index",b.recordIndex),b.recordIsNA?(f.classList.add("is-info"),f.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'+(""===b.recordNote?"":' <span class="has-margin-left-5" data-tooltip="'+
llm.escapeHTML(b.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')):(f.classList.add("is-success"),f.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+b.recordDateString+"</small>"+(""===b.recordNote?"":' <span class="has-margin-left-5" data-tooltip="'+llm.escapeHTML(b.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')))}h.classList.remove("has-status-loading");h.classList.add("has-status-loaded")})}function B(){llm.postJSON("/organizations/doGetBankRecordStats",
{organizationID:w},function(a){var c=(new Date).getFullYear(),b=c-1;if(0===a.length)q.innerHTML='<option value="">(No Accounts Recorded)</option>';else{q.innerHTML="";for(var f=0;f<a.length;f+=1){var e=a[f],b=Math.min(e.bankingYearMin,b),d=llm.escapeHTML(e.accountNumber);q.insertAdjacentHTML("beforeend",'<option value="'+d+'">'+d+" (From "+e.bankingYearMin+" to "+e.bankingYearMax+")</option>")}}u.innerHTML="";for(a=c;a>=b;--a)u.insertAdjacentHTML("beforeend",'<option value="'+a+'">'+a+"</option>");
t()})}var l="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),g=document.getElementById("container--remarks");if(l){var m=g.getAttribute("data-organization-id"),n,x=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.openEditRemarkModal(m,a,n)},v=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.deleteRemark(m,a,!0,n)};n=function(){llm.organizationRemarks.getRemarksByOrganizationID(m,function(a){llm.clearElement(g);
if(0===a.length)g.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(var c=0;c<a.length;c+=1){var b=a[c];g.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(b.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+
llm.escapeHTML(b.remark)+'</p><p class="is-size-7">'+(b.recordCreate_timeMillis===b.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+b.recordUpdate_userName+" - "+b.remarkDateString+" "+b.remarkTimeString+"</p></div>"+(b.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+b.remarkIndex+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+
b.remarkIndex+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}a=g.getElementsByClassName("is-edit-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",x);a=g.getElementsByClassName("is-delete-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",v)}})};document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(a){a.preventDefault();
llm.organizationRemarks.openAddRemarkModal(m,n)});for(var e=g.getElementsByClassName("is-edit-remark-button"),d=0;d<e.length;d+=1)e[d].addEventListener("click",x);e=g.getElementsByClassName("is-delete-remark-button");for(d=0;d<e.length;d+=1)e[d].addEventListener("click",v)}if(e=document.getElementById("remark--searchStr")){e.value="";var F=document.getElementById("remark--displayCount"),k=g.getElementsByClassName("is-remark-block");e.addEventListener("keyup",function(a){a=a.currentTarget.value.trim().toLowerCase().split(" ");
for(var c=k.length,b=0;b<k.length;b+=1){for(var e=k[b].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase(),d=!0,g=0;g<a.length;g+=1)if(-1===e.indexOf(a[g])){d=!1;--c;break}d?k[b].classList.remove("is-hidden"):k[b].classList.add("is-hidden")}F.innerText=c})}var z=!1,y={},u=document.getElementById("bankRecordFilter--bankingYear"),q=document.getElementById("bankRecordFilter--accountNumber"),h=document.getElementById("table--bankRecords"),w=h.getAttribute("data-organization-id");u.addEventListener("change",
t);q.addEventListener("change",t);if(l){l=function(a){var c,b=!1,e=!1,d=function(a){a.preventDefault();llm.postJSON("/organizations/"+(b?"doEditBankRecord":"doAddBankRecord"),a.currentTarget,function(a){a.success?(c(),b||e?t():(z=!1,B())):llm.alertModal("Record Not Saved",a.message,"OK","danger")})},g=function(a){a.preventDefault();var b=a.currentTarget.getAttribute("data-record-index");llm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",
function(){llm.postJSON("/organizations/doDeleteBankRecord",{organizationID:w,recordIndex:b},function(){c();t()})})};a=a.currentTarget;var h="",l=q.value,k="",m=!1,n="",r=new Date,x=r.getFullYear(),v=llm.dateToString(r),C=v;r.setMonth(r.getMonth()-1);var D=r.getFullYear(),A=r.getMonth()+1;"is-add-bank-record-button"!==a.id&&(e=!0,h=a.getAttribute("data-record-index"),D=u.value,""===h?(A=a.closest("tr").getAttribute("data-banking-month"),k=a.getAttribute("data-bank-record-type")):(a=y[parseInt(h)],
b=!0,A=a.bankingMonth,k=a.bankRecordType,m=a.recordIsNA,C=a.recordDateString,n=a.recordNote));llm.openHtmlModal("organization-bankRecordEdit",{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=w;document.getElementById("bankRecordEdit--recordIndex").value=h;var a=document.getElementById("bankRecordEdit--accountNumber");a.value=l;var c=document.getElementById("bankRecordEdit--bankingYear");c.value=D;c.setAttribute("max",x);var d=document.getElementById("bankRecordEdit--bankingMonth");
d.value=A;for(var f=document.getElementById("bankRecordEdit--bankRecordType"),p=0;p<llm.config_bankRecordTypes.length;p+=1)f.insertAdjacentHTML("beforeend",'<option value="'+llm.config_bankRecordTypes[p].bankRecordType+'">'+llm.config_bankRecordTypes[p].bankRecordTypeName+"</option>");""===k&&f.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>');f.value=k;p=document.getElementById("bankRecordEdit--recordDateString");p.value=C;p.setAttribute("max",v);m&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked",
"checked");document.getElementById("bankRecordEdit--recordNote").value=n;e&&(a.setAttribute("readonly","readonly"),c.setAttribute("readonly","readonly"),d.setAttribute("readonly","readonly"),f.setAttribute("readonly","readonly"),a.classList.add("is-readonly"),c.classList.add("is-readonly"),d.classList.add("is-readonly"),f.classList.add("is-readonly"));b?(a=document.getElementById("bankRecordEdit--deleteRecordButton"),a.setAttribute("data-record-index",h),a.addEventListener("click",g)):document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},
onshown:function(a,b){c=b;a.getElementsByTagName("form")[0].addEventListener("submit",d)}})};e=h.getElementsByTagName("button");for(d=0;d<e.length;d+=1)e[d].addEventListener("click",l);document.getElementById("is-add-bank-record-button").addEventListener("click",l)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(a){"organizationTabContent--bankRecords"!==a.id||z||(z=!0,B())}})})();
