"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main"),t=e.dataset.urlPrefix,n="true"===e.dataset.canUpdate,o=document.querySelector("#container--remarks");if(n){const e=Number.parseInt(o.dataset.organizationId,10),t=t=>{const n=Number.parseInt(t.currentTarget.dataset.remarkIndex,10);llm.organizationRemarks.openEditRemarkModal(e,n,r)},n=t=>{const n=Number.parseInt(t.currentTarget.dataset.remarkIndex,10);llm.organizationRemarks.deleteRemark(e,n,!0,r)},r=()=>{llm.organizationRemarks.getRemarksByOrganizationID(e,e=>{if(cityssm.clearElement(o),0===e.length)o.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(const t of e)o.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(t.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(t.remark)+'</p><p class="is-size-7">'+(t.recordCreate_timeMillis===t.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+t.recordUpdate_userName+" - "+t.remarkDateString+" "+t.remarkTimeString+"</p></div>"+(t.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+t.remarkIndex.toString()+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+t.remarkIndex.toString()+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>");const r=o.querySelectorAll(".is-edit-remark-button");for(const e of r)e.addEventListener("click",t);const a=o.querySelectorAll(".is-delete-remark-button");for(const e of a)e.addEventListener("click",n)}})};document.querySelector(".is-add-remark-button").addEventListener("click",t=>{t.preventDefault(),llm.organizationRemarks.openAddRemarkModal(e,r)});const a=o.querySelectorAll(".is-edit-remark-button");for(const e of a)e.addEventListener("click",t);const c=o.querySelectorAll(".is-delete-remark-button");for(const e of c)e.addEventListener("click",n)}const r=document.querySelector("#remark--searchStr");if(r){r.value="";const e=document.querySelector("#remark--displayCount"),t=o.querySelectorAll(".is-remark-block");r.addEventListener("keyup",()=>{const n=r.value.trim().toLowerCase().split(" ");let o=t.length;for(const e of t){const t=e.querySelector(".is-remark").textContent.trim().toLowerCase();let r=!0;for(const e of n)if(!t.includes(e)){r=!1,o-=1;break}r?e.classList.remove("is-hidden"):e.classList.add("is-hidden")}e.textContent=o.toString()})}let a=!1;const c=new Map,s=document.querySelector("#bankRecordFilter--bankingYear"),d=document.querySelector("#bankRecordFilter--accountNumber"),i=document.querySelector("#table--bankRecords"),l=i.dataset.organizationId,u=()=>{(()=>{c.clear(),i.classList.remove("has-status-loaded"),i.classList.add("has-status-loading");const e=i.querySelectorAll(".is-bank-record-info");for(const t of e){t.innerHTML='<i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i><br /><strong class="is-size-7 has-text-grey-light">No Record Recorded</strong>';const e=t.closest("td");e.dataset.recordIndex="",e.classList.remove("has-background-info-light"),e.classList.remove("has-background-success-light"),e.classList.remove("has-background-warning-light")}})();const e=e=>{for(const t of e){c.set(t.recordIndex,t);const e=i.querySelector("[data-banking-month='"+t.bankingMonth.toString()+"']").querySelector("[data-bank-record-type='"+t.bankRecordType+"']");if(!e)continue;e.dataset.recordIndex=t.recordIndex.toString();const n=e.querySelector(".is-bank-record-info");t.recordIsNA?(e.classList.add("has-background-info-light"),n.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><span class="has-text-weight-bold is-size-7">Not Applicable</span>'):t.recordDate?(e.classList.add("has-background-success-light"),n.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><span class="has-text-weight-bold is-size-7">Recorded '+t.recordDateString+"</span>"):(e.classList.add("has-background-warning-light"),n.innerHTML='<i class="fas fa-exclamation-triangle" aria-hidden="true"></i><br /><span class="has-text-weight-bold is-size-7">Not Recorded</span>'),""!==t.recordNote&&n.insertAdjacentHTML("beforeend",'<div class="is-size-7 has-text-left"><span class="icon"><i class="fas fa-sticky-note" aria-hidden="true"></i></span> '+cityssm.escapeHTML(t.recordNote)+"</div>")}i.classList.remove("has-status-loading"),i.classList.add("has-status-loaded")};""===d.value?e([]):cityssm.postJSON(t+"/organizations/doGetBankRecords",{organizationID:l,bankingYear:s.value,accountNumber:d.value},e)},b=()=>{cityssm.postJSON(t+"/organizations/doGetBankRecordStats",{organizationID:l},e=>{const t=(new Date).getFullYear();let n=t-1;if(0===e.length)d.innerHTML='<option value="">(No Accounts Recorded)</option>';else{d.innerHTML="";for(const t of e){n=Math.min(t.bankingYearMin,n);const e=cityssm.escapeHTML(t.accountNumber);d.insertAdjacentHTML("beforeend",'<option value="'+e+'">'+e+" (From "+t.bankingYearMin.toString()+" to "+t.bankingYearMax.toString()+")</option>")}}s.innerHTML="";for(let e=t;e>=n;e-=1)s.insertAdjacentHTML("beforeend",'<option value="'+e.toString()+'">'+e.toString()+"</option>");u()})},m=()=>{document.querySelector("#bankRecords--export").href=t+"/reports/bankRecordsFlat-byOrganizationAndBankingYear?organizationID="+l+"&bankingYear="+s.value};if(m(),d.addEventListener("change",u),s.addEventListener("change",u),s.addEventListener("change",m),n){const e=(e,n)=>{""!==e?cityssm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",()=>{cityssm.postJSON(t+"/organizations/doDeleteBankRecord",{organizationID:l,recordIndex:e},()=>{n&&n(),u()})}):cityssm.alertModal("No Record to Delete","","OK","info")},n=t=>{t.preventDefault();const n=t.currentTarget.closest("td").dataset.recordIndex;e(n)},o=n=>{const o=cityssm.isNavBlockerEnabled();let r,i=!1,m=!1,k=!0;const y=e=>{e.preventDefault(),cityssm.postJSON(t+"/organizations/"+(i?"doEditBankRecord":"doAddBankRecord"),e.currentTarget,e=>{e.success?(r(),i||m&&!k?u():(a=!1,b())):cityssm.alertModal("Record Not Saved",e.message,"OK","danger")})},g=n.currentTarget;let h="";const p=d.value;k=""===p;let v="",f=!1,S="";const R=new Date,M=R.getFullYear(),E=cityssm.dateToString(R);let q=E;R.setMonth(R.getMonth()-1);let L=R.getFullYear(),T=R.getMonth()+1;if("is-add-bank-record-button"!==g.id){m=!0;const e=g.closest("td");if(h=e.getAttribute("data-record-index"),L=Number.parseInt(s.value,10),""===h)T=Number.parseInt(e.closest("tr").dataset.bankingMonth,10),v=e.dataset.bankRecordType;else{const e=c.get(Number.parseInt(h,10));i=!0,T=e.bankingMonth,v=e.bankRecordType,f=e.recordIsNA,q=e.recordDateString,S=e.recordNote}}const N=t=>{t.preventDefault(),e(h,r)};cityssm.openHtmlModal("organization-bankRecordEdit",{onshow(){cityssm.enableNavBlocker(),document.querySelector("#bankRecordEdit--organizationID").value=l,document.querySelector("#bankRecordEdit--recordIndex").value=h;const e=document.querySelector("#bankRecordEdit--accountNumber");e.value=p;const t=document.querySelector("#bankRecordEdit--bankingYear");t.value=L.toString(),t.setAttribute("max",M.toString());const n=document.querySelector("#bankRecordEdit--bankingMonth");n.value=T.toString();const o=document.querySelector("#bankRecordEdit--bankRecordType");for(const e of exports.config_bankRecordTypes)o.insertAdjacentHTML("beforeend",'<option value="'+e.bankRecordType+'">'+e.bankRecordTypeName+"</option>");""===v&&o.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>'),o.value=v;const r=document.querySelector("#bankRecordEdit--recordDateString");if(r.value=q,r.setAttribute("max",E),f&&document.querySelector("#bankRecordEdit--recordIsNA").setAttribute("checked","checked"),document.querySelector("#bankRecordEdit--recordNote").value=S,m&&(k||(e.setAttribute("readonly","readonly"),e.classList.add("is-readonly")),t.setAttribute("readonly","readonly"),t.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.classList.add("is-readonly"),o.setAttribute("readonly","readonly"),o.classList.add("is-readonly")),i){const e=document.querySelector("#bankRecordEdit--deleteRecordButton");e.dataset.recordIndex=h,e.addEventListener("click",N)}else document.querySelector("#bankRecordEdit--moreOptionsDropdown").remove()},onshown(e,t){r=t,e.querySelector("form").addEventListener("submit",y),bulmaJS.init(e)},onremoved(){o||cityssm.disableNavBlocker()}})},r=document.querySelector("#is-add-bank-record-button");r&&r.addEventListener("click",o);const m=i.querySelectorAll(".is-bank-record-button");for(const e of m)e.addEventListener("click",o);const k=i.querySelectorAll(".is-bank-record-delete-button");for(const e of k)e.addEventListener("click",n);const y=e=>{const n=d.value;if(""===n)return void cityssm.alertModal("No Account Number Set","Please add at least one bank record with the account number you are looking to record.","OK","warning");let o=-1;const r=e=>{const t=document.querySelector("#bankRecordMonthEdit--recordDateString-"+e);t.classList.remove("is-readonly"),t.readOnly=!1},a=e=>{const t=e.currentTarget,n=t.value;t.checked?(e=>{const t=document.querySelector("#bankRecordMonthEdit--recordDateString-"+e);t.classList.add("is-readonly"),t.readOnly=!0,t.value=document.querySelector("#bankRecordMonthEdit--recordDateString-0").value})(n):r(n)},i=()=>{const e=document.querySelector("#bankRecordMonthEdit--recordDateString-0").value;for(let t=1;t<=o;t+=1)document.querySelector("#bankRecordMonthEdit--syncRecordDate-"+t.toString()).checked&&(document.querySelector("#bankRecordMonthEdit--recordDateString-"+t.toString()).value=e)},b=e=>{const t=e.currentTarget.value;"0"!==t&&document.querySelector("#bankRecordMonthEdit--syncRecordDate-"+t).checked?cityssm.alertModal("Date Not Changed","This date is synced with the date on the first band record type.","OK","warning"):(document.querySelector("#bankRecordMonthEdit--recordDateString-"+t).value=cityssm.dateToString(new Date),"0"===t&&i())};let m;const k=e=>{e.preventDefault(),cityssm.postJSON(t+"/organizations/doUpdateBankRecordsByMonth",e.currentTarget,e=>{e.success&&(m(),u())})},y=cityssm.isNavBlockerEnabled(),g=Number.parseInt(s.value,10),h=e.currentTarget.closest("tr"),p=Number.parseInt(h.getAttribute("data-banking-month"),10),v=h.querySelectorAll("td"),f=new Map;for(const e of v){const t=e.dataset.recordIndex;if(""!==t){const e=c.get(Number.parseInt(t,10));f.set(e.bankRecordType,e)}}cityssm.openHtmlModal("organization-bankRecordMonthEdit",{onshow(){cityssm.enableNavBlocker(),document.querySelector("#bankRecordMonthEdit--organizationID").value=l,document.querySelector("#bankRecordMonthEdit--accountNumber").value=n,document.querySelector("#bankRecordMonthEdit--bankingYear").value=g.toString(),document.querySelector("#bankRecordMonthEdit--bankingMonth").value=p.toString(),document.querySelector("#bankRecordMonthEdit--accountNumber-span").textContent=n,document.querySelector("#bankRecordMonthEdit--bankingYear-span").textContent=g.toString(),document.querySelector("#bankRecordMonthEdit--bankingMonth-span").textContent=p.toString();const e=document.querySelector("#container--bankRecordMonthEdit-recordTypes");for(const t of exports.config_bankRecordTypes){const n=(o+=1).toString();e.insertAdjacentHTML("beforeend","<hr />"),e.insertAdjacentHTML("beforeend",'<input id="bankRecordMonthEdit--recordIndex-'+n+'" name="recordIndex-'+n+'" type="hidden" value="" />'),e.insertAdjacentHTML("beforeend",'<input name="bankRecordType-'+n+'" type="hidden" value="'+cityssm.escapeHTML(t.bankRecordType)+'" />'),e.insertAdjacentHTML("beforeend",'<div class="columns is-mobile"><div class="column"><strong>'+cityssm.escapeHTML(t.bankRecordTypeName)+'</strong></div><div class="column is-narrow has-text-right">'+(0===o?"":'<div class="facheck facheck-inline facheck-fas-checked is-info"><input id="bankRecordMonthEdit--syncRecordDate-'+n+'" name="syncRecordDate-'+n+'" type="checkbox" value="'+n+'" checked /><label for="bankRecordMonthEdit--syncRecordDate-'+n+'">Sync Record Date</label></div>')+'<div class="facheck facheck-inline facheck-fas-checked is-info"><input id="bankRecordMonthEdit--recordIsNA-'+n+'" name="recordIsNA-'+n+'" type="checkbox" value="1" /><label for="bankRecordMonthEdit--recordIsNA-'+n+'">Not Applicable</label></div></div></div>'),e.insertAdjacentHTML("beforeend",'<div class="columns"><div class="column"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input'+(0===o?"":" is-readonly")+'" id="bankRecordMonthEdit--recordDateString-'+n+'" name="recordDateString-'+n+'" type="date" aria-label="Record Date"'+(0===o?"":" readonly")+' /><span class="icon is-small is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><button class="button is-info" id="bankRecordMonthEdit--setToToday-'+n+'" data-tooltip="Set to Today" type="button" value="'+n+'"><i class="fas fa-calendar-day" aria-hidden="true"></i><span class="sr-only">Set to Today</span></button></div></div></div><div class="column"><div class="control has-icons-left"><input class="input" id="bankRecordMonthEdit--recordNote-'+n+'" name="recordNote-'+n+'" type="text" placeholder="Optional Note" aria-label="Optional Note" /><span class="icon is-small is-left"><i class="fas fa-sticky-note" aria-hidden="true"></i></span></div></div></div>');const c=f.get(t.bankRecordType);if(c&&(document.querySelector("#bankRecordMonthEdit--recordIndex-"+n).value=c.recordIndex.toString(),c.recordIsNA&&(document.querySelector("#bankRecordMonthEdit--recordIsNA-"+n).checked=!0),document.querySelector("#bankRecordMonthEdit--recordDateString-"+n).value=c.recordDateString,document.querySelector("#bankRecordMonthEdit--recordNote-"+n).value=c.recordNote),0!==o){const e=document.querySelector("#bankRecordMonthEdit--syncRecordDate-"+n);e.addEventListener("change",a);const t=document.querySelector("#bankRecordMonthEdit--recordDateString-0").value;(c&&c.recordDateString!==t||!c&&""!==t)&&(e.checked=!1,r(n))}document.querySelector("#bankRecordMonthEdit--setToToday-"+n).addEventListener("click",b)}document.querySelector("#bankRecordMonthEdit--bankRecordTypeIndex").value=o.toString(),o>=0&&document.querySelector("#bankRecordMonthEdit--recordDateString-0").addEventListener("change",i)},onshown(e,t){document.querySelector("#form--bankRecordMonthEdit").addEventListener("submit",k),m=t},onremoved(){y||cityssm.disableNavBlocker()}})},g=i.querySelectorAll(".is-bank-record-month-button");for(const e of g)e.addEventListener("click",y)}llm.initializeTabs(document.querySelector("#tabs--organization"),{onshown(e){"organizationTabContent--bankRecords"!==e.id||a||(a=!0,b())}})})();