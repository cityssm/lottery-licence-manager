"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),t=document.getElementById("container--remarks");if(e){var a,n=parseInt(t.getAttribute("data-organization-id")),r=function(e){var t=parseInt(e.currentTarget.getAttribute("data-remark-index"));llm.organizationRemarks.openEditRemarkModal(n,t,a)},i=function(e){var t=parseInt(e.currentTarget.getAttribute("data-remark-index"));llm.organizationRemarks.deleteRemark(n,t,!0,a)};a=function(){llm.organizationRemarks.getRemarksByOrganizationID(n,function(e){if(cityssm.clearElement(t),0===e.length)t.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(var a=0;a<e.length;a+=1){var n=e[a];t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(n.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(n.remark)+'</p><p class="is-size-7">'+(n.recordCreate_timeMillis===n.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+n.recordUpdate_userName+" - "+n.remarkDateString+" "+n.remarkTimeString+"</p></div>"+(n.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+n.remarkIndex+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+n.remarkIndex+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}for(var s=t.getElementsByClassName("is-edit-remark-button"),o=0;o<s.length;o+=1)s[o].addEventListener("click",r);var d=t.getElementsByClassName("is-delete-remark-button");for(o=0;o<d.length;o+=1)d[o].addEventListener("click",i)}})},document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(e){e.preventDefault(),llm.organizationRemarks.openAddRemarkModal(n,a)});for(var s=t.getElementsByClassName("is-edit-remark-button"),o=0;o<s.length;o+=1)s[o].addEventListener("click",r);var d=t.getElementsByClassName("is-delete-remark-button");for(o=0;o<d.length;o+=1)d[o].addEventListener("click",i)}var c=document.getElementById("remark--searchStr");if(c){c.value="";var l=document.getElementById("remark--displayCount"),m=t.getElementsByClassName("is-remark-block");c.addEventListener("keyup",function(){for(var e=c.value.trim().toLowerCase().split(" "),t=m.length,a=0;a<m.length;a+=1){for(var n=m[a].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase(),r=!0,i=0;i<e.length;i+=1)if(-1===n.indexOf(e[i])){r=!1,t-=1;break}r?m[a].classList.remove("is-hidden"):m[a].classList.add("is-hidden")}l.innerText=t.toString()})}var u=!1,g={},b=document.getElementById("bankRecordFilter--bankingYear"),k=document.getElementById("bankRecordFilter--accountNumber"),v=document.getElementById("table--bankRecords"),f=v.getAttribute("data-organization-id");function p(){!function(){g={},v.classList.remove("has-status-loaded"),v.classList.add("has-status-loading");for(var e=v.getElementsByClassName("is-bank-record-button"),t=0;t<e.length;t+=1){var a=e[t];a.classList.remove("is-success"),a.classList.remove("is-info"),a.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>',a.setAttribute("data-record-index","")}}();var e=function(e){for(var t=0;t<e.length;t+=1){var a=e[t];g[a.recordIndex]=a;var n=v.querySelector("[data-banking-month='"+a.bankingMonth+"']").querySelector("[data-bank-record-type='"+a.bankRecordType+"']");n&&(n.setAttribute("data-record-index",a.recordIndex.toString()),a.recordIsNA?(n.classList.add("is-info"),n.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'+(""===a.recordNote?"":' <span class="ml-2" data-tooltip="'+cityssm.escapeHTML(a.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')):(n.classList.add("is-success"),n.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+a.recordDateString+"</small>"+(""===a.recordNote?"":' <span class="ml-2" data-tooltip="'+cityssm.escapeHTML(a.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')))}v.classList.remove("has-status-loading"),v.classList.add("has-status-loaded")};""===k.value?e([]):cityssm.postJSON("/organizations/doGetBankRecords",{organizationID:f,bankingYear:b.value,accountNumber:k.value},e)}function y(){cityssm.postJSON("/organizations/doGetBankRecordStats",{organizationID:f},function(e){var t=(new Date).getFullYear(),a=t-1;if(0===e.length)k.innerHTML='<option value="">(No Accounts Recorded)</option>';else{k.innerHTML="";for(var n=0;n<e.length;n+=1){var r=e[n];a=Math.min(r.bankingYearMin,a);var i=cityssm.escapeHTML(r.accountNumber);k.insertAdjacentHTML("beforeend",'<option value="'+i+'">'+i+" (From "+r.bankingYearMin+" to "+r.bankingYearMax+")</option>")}}b.innerHTML="";for(var s=t;s>=a;s-=1)b.insertAdjacentHTML("beforeend",'<option value="'+s+'">'+s+"</option>");p()})}if(b.addEventListener("change",p),k.addEventListener("change",p),e){for(var h=function(e){var t,a=!1,n=!1,r=!0,i=function(e){e.preventDefault(),cityssm.postJSON("/organizations/"+(a?"doEditBankRecord":"doAddBankRecord"),e.currentTarget,function(e){e.success?(t(),a||n&&!r?p():(u=!1,y())):cityssm.alertModal("Record Not Saved",e.message,"OK","danger")})},s=function(e){e.preventDefault();var a=e.currentTarget.getAttribute("data-record-index");cityssm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",function(){cityssm.postJSON("/organizations/doDeleteBankRecord",{organizationID:f,recordIndex:a},function(){t(),p()})})},o=e.currentTarget,d="",c=k.value;r=""===c;var l="",m=!1,v="",h=new Date,E=h.getFullYear(),R=cityssm.dateToString(h),L=R;h.setMonth(h.getMonth()-1);var I=h.getFullYear(),T=h.getMonth()+1;if("is-add-bank-record-button"!==o.id)if(n=!0,d=o.getAttribute("data-record-index"),I=parseInt(b.value),""===d)T=parseInt(o.closest("tr").getAttribute("data-banking-month")),l=o.getAttribute("data-bank-record-type");else{var B=g[parseInt(d)];a=!0,T=B.bankingMonth,l=B.bankRecordType,m=B.recordIsNA,L=B.recordDateString,v=B.recordNote}cityssm.openHtmlModal("organization-bankRecordEdit",{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=f,document.getElementById("bankRecordEdit--recordIndex").value=d;var e=document.getElementById("bankRecordEdit--accountNumber");e.value=c;var t=document.getElementById("bankRecordEdit--bankingYear");t.value=I.toString(),t.setAttribute("max",E.toString());var i=document.getElementById("bankRecordEdit--bankingMonth");i.value=T.toString();for(var o=document.getElementById("bankRecordEdit--bankRecordType"),u=0;u<exports.config_bankRecordTypes.length;u+=1)o.insertAdjacentHTML("beforeend",'<option value="'+exports.config_bankRecordTypes[u].bankRecordType+'">'+exports.config_bankRecordTypes[u].bankRecordTypeName+"</option>");""===l&&o.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>'),o.value=l;var g=document.getElementById("bankRecordEdit--recordDateString");if(g.value=L,g.setAttribute("max",R),m&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked"),document.getElementById("bankRecordEdit--recordNote").value=v,n&&(r||(e.setAttribute("readonly","readonly"),e.classList.add("is-readonly")),t.setAttribute("readonly","readonly"),t.classList.add("is-readonly"),i.setAttribute("readonly","readonly"),i.classList.add("is-readonly"),o.setAttribute("readonly","readonly"),o.classList.add("is-readonly")),a){var b=document.getElementById("bankRecordEdit--deleteRecordButton");b.setAttribute("data-record-index",d),b.addEventListener("click",s)}else document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},onshown:function(e,a){t=a,e.getElementsByTagName("form")[0].addEventListener("submit",i)}})},E=v.getElementsByTagName("button"),R=0;R<E.length;R+=1)E[R].addEventListener("click",h);document.getElementById("is-add-bank-record-button").addEventListener("click",h)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(e){"organizationTabContent--bankRecords"!==e.id||u||(u=!0,y())}})}();