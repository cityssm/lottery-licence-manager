"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),t=document.getElementById("container--remarks");if(e){const e=parseInt(t.getAttribute("data-organization-id"),10),n=t=>{const n=parseInt(t.currentTarget.getAttribute("data-remark-index"),10);llm.organizationRemarks.openEditRemarkModal(e,n,o)},a=t=>{const n=parseInt(t.currentTarget.getAttribute("data-remark-index"),10);llm.organizationRemarks.deleteRemark(e,n,!0,o)},o=()=>{llm.organizationRemarks.getRemarksByOrganizationID(e,e=>{if(cityssm.clearElement(t),0===e.length)t.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(const n of e)t.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(n.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(n.remark)+'</p><p class="is-size-7">'+(n.recordCreate_timeMillis===n.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+n.recordUpdate_userName+" - "+n.remarkDateString+" "+n.remarkTimeString+"</p></div>"+(n.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+n.remarkIndex.toString()+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+n.remarkIndex.toString()+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>");const o=t.getElementsByClassName("is-edit-remark-button");for(const e of o)e.addEventListener("click",n);const r=t.getElementsByClassName("is-delete-remark-button");for(const e of r)e.addEventListener("click",a)}})};document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",t=>{t.preventDefault(),llm.organizationRemarks.openAddRemarkModal(e,o)});const r=t.getElementsByClassName("is-edit-remark-button");for(const e of r)e.addEventListener("click",n);const d=t.getElementsByClassName("is-delete-remark-button");for(const e of d)e.addEventListener("click",a)}const n=document.getElementById("remark--searchStr");if(n){n.value="";const e=document.getElementById("remark--displayCount"),a=t.getElementsByClassName("is-remark-block");n.addEventListener("keyup",()=>{const t=n.value.trim().toLowerCase().split(" ");let o=a.length;for(const e of a){const n=e.getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase();let a=!0;for(const e of t)if(!n.includes(e)){a=!1,o-=1;break}a?e.classList.remove("is-hidden"):e.classList.add("is-hidden")}e.innerText=o.toString()})}let a=!1;const o=new Map,r=document.getElementById("bankRecordFilter--bankingYear"),d=document.getElementById("bankRecordFilter--accountNumber"),s=document.getElementById("table--bankRecords"),i=s.getAttribute("data-organization-id"),c=()=>{(()=>{o.clear(),s.classList.remove("has-status-loaded"),s.classList.add("has-status-loading");const e=s.getElementsByClassName("is-bank-record-info");for(const t of e){t.innerHTML='<i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i><br /><strong class="is-size-7 has-text-grey-light">No Record Recorded</strong>';const e=t.closest("td");e.setAttribute("data-record-index",""),e.classList.remove("has-background-success-light"),e.classList.remove("has-background-info-light")}})();const e=e=>{for(const t of e){o.set(t.recordIndex,t);const e=s.querySelector("[data-banking-month='"+t.bankingMonth.toString()+"']").querySelector("[data-bank-record-type='"+t.bankRecordType+"']");if(!e)continue;e.setAttribute("data-record-index",t.recordIndex.toString());const n=e.getElementsByClassName("is-bank-record-info")[0];t.recordIsNA?(e.classList.add("has-background-info-light"),n.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><span class="has-text-weight-bold is-size-7">Not Applicable</span>'):(e.classList.add("has-background-success-light"),n.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><span class="has-text-weight-bold is-size-7">Recorded '+t.recordDateString+"</span>"),""!==t.recordNote&&n.insertAdjacentHTML("beforeend",'<div class="is-size-7 has-text-left"><span class="icon"><i class="fas fa-sticky-note" aria-hidden="true"></i></span> '+cityssm.escapeHTML(t.recordNote)+"</div>")}s.classList.remove("has-status-loading"),s.classList.add("has-status-loaded")};""===d.value?e([]):cityssm.postJSON("/organizations/doGetBankRecords",{organizationID:i,bankingYear:r.value,accountNumber:d.value},e)},l=()=>{cityssm.postJSON("/organizations/doGetBankRecordStats",{organizationID:i},e=>{const t=(new Date).getFullYear();let n=t-1;if(0===e.length)d.innerHTML='<option value="">(No Accounts Recorded)</option>';else{d.innerHTML="";for(const t of e){n=Math.min(t.bankingYearMin,n);const e=cityssm.escapeHTML(t.accountNumber);d.insertAdjacentHTML("beforeend",'<option value="'+e+'">'+e+" (From "+t.bankingYearMin.toString()+" to "+t.bankingYearMax.toString()+")</option>")}}r.innerHTML="";for(let e=t;e>=n;e-=1)r.insertAdjacentHTML("beforeend",'<option value="'+e.toString()+'">'+e.toString()+"</option>");c()})};if(r.addEventListener("change",c),d.addEventListener("change",c),e){const e=e=>{const t=cityssm.isNavBlockerEnabled();let n,s=!1,m=!1,u=!0;const g=e=>{e.preventDefault(),cityssm.postJSON("/organizations/"+(s?"doEditBankRecord":"doAddBankRecord"),e.currentTarget,e=>{e.success?(n(),s||m&&!u?c():(a=!1,l())):cityssm.alertModal("Record Not Saved",e.message,"OK","danger")})},b=e=>{e.preventDefault();const t=e.currentTarget.getAttribute("data-record-index");cityssm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",()=>{cityssm.postJSON("/organizations/doDeleteBankRecord",{organizationID:i,recordIndex:t},()=>{n(),c()})})},k=e.currentTarget;let y="";const h=d.value;u=""===h;let E="",p=!1,v="";const f=new Date,R=f.getFullYear(),M=cityssm.dateToString(f);let I=M;f.setMonth(f.getMonth()-1);let B=f.getFullYear(),T=f.getMonth()+1;if("is-add-bank-record-button"!==k.id){m=!0;const e=k.closest("td");if(y=e.getAttribute("data-record-index"),B=parseInt(r.value,10),""===y)T=parseInt(e.closest("tr").getAttribute("data-banking-month"),10),E=e.getAttribute("data-bank-record-type");else{const e=o.get(parseInt(y,10));s=!0,T=e.bankingMonth,E=e.bankRecordType,p=e.recordIsNA,I=e.recordDateString,v=e.recordNote}}cityssm.openHtmlModal("organization-bankRecordEdit",{onshow(){cityssm.enableNavBlocker(),document.getElementById("bankRecordEdit--organizationID").value=i,document.getElementById("bankRecordEdit--recordIndex").value=y;const e=document.getElementById("bankRecordEdit--accountNumber");e.value=h;const t=document.getElementById("bankRecordEdit--bankingYear");t.value=B.toString(),t.setAttribute("max",R.toString());const n=document.getElementById("bankRecordEdit--bankingMonth");n.value=T.toString();const a=document.getElementById("bankRecordEdit--bankRecordType");for(const e of exports.config_bankRecordTypes)a.insertAdjacentHTML("beforeend",'<option value="'+e.bankRecordType+'">'+e.bankRecordTypeName+"</option>");""===E&&a.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>'),a.value=E;const o=document.getElementById("bankRecordEdit--recordDateString");if(o.value=I,o.setAttribute("max",M),p&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked"),document.getElementById("bankRecordEdit--recordNote").value=v,m&&(u||(e.setAttribute("readonly","readonly"),e.classList.add("is-readonly")),t.setAttribute("readonly","readonly"),t.classList.add("is-readonly"),n.setAttribute("readonly","readonly"),n.classList.add("is-readonly"),a.setAttribute("readonly","readonly"),a.classList.add("is-readonly")),s){const e=document.getElementById("bankRecordEdit--deleteRecordButton");e.setAttribute("data-record-index",y),e.addEventListener("click",b)}else document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},onshown(e,t){n=t,e.getElementsByTagName("form")[0].addEventListener("submit",g)},onremoved(){t||cityssm.disableNavBlocker()}})},t=document.getElementById("is-add-bank-record-button");t&&t.addEventListener("click",e);const n=s.getElementsByClassName("is-bank-record-button");for(const t of n)t.addEventListener("click",e);const m=e=>{const t=d.value;if(""===t)return void cityssm.alertModal("No Account Number Set","Please add at least one bank record with the account number you are looking to record.","OK","warning");let n=-1;const a=e=>{const t=document.getElementById("bankRecordMonthEdit--recordDateString-"+e);t.classList.remove("is-readonly"),t.readOnly=!1},s=e=>{const t=e.currentTarget,n=t.value;t.checked?(e=>{const t=document.getElementById("bankRecordMonthEdit--recordDateString-"+e);t.classList.add("is-readonly"),t.readOnly=!0,t.value=document.getElementById("bankRecordMonthEdit--recordDateString-0").value})(n):a(n)},l=()=>{const e=document.getElementById("bankRecordMonthEdit--recordDateString-0").value;for(let t=1;t<=n;t+=1)document.getElementById("bankRecordMonthEdit--syncRecordDate-"+t.toString()).checked&&(document.getElementById("bankRecordMonthEdit--recordDateString-"+t.toString()).value=e)},m=e=>{const t=e.currentTarget.value;"0"!==t&&document.getElementById("bankRecordMonthEdit--syncRecordDate-"+t).checked?cityssm.alertModal("Date Not Changed","This date is synced with the date on the first band record type.","OK","warning"):(document.getElementById("bankRecordMonthEdit--recordDateString-"+t).value=cityssm.dateToString(new Date),"0"===t&&l())};let u;const g=e=>{e.preventDefault(),cityssm.postJSON("/organizations/doUpdateBankRecordsByMonth",e.currentTarget,e=>{e.success&&(u(),c())})},b=cityssm.isNavBlockerEnabled(),k=parseInt(r.value,10),y=e.currentTarget.closest("tr"),h=parseInt(y.getAttribute("data-banking-month"),10),E=y.getElementsByTagName("td"),p=new Map;for(const e of E){const t=e.getAttribute("data-record-index");if(""!==t){const e=o.get(parseInt(t,10));p.set(e.bankRecordType,e)}}cityssm.openHtmlModal("organization-bankRecordMonthEdit",{onshow:()=>{cityssm.enableNavBlocker(),document.getElementById("bankRecordMonthEdit--organizationID").value=i,document.getElementById("bankRecordMonthEdit--accountNumber").value=t,document.getElementById("bankRecordMonthEdit--bankingYear").value=k.toString(),document.getElementById("bankRecordMonthEdit--bankingMonth").value=h.toString(),document.getElementById("bankRecordMonthEdit--accountNumber-span").innerText=t,document.getElementById("bankRecordMonthEdit--bankingYear-span").innerText=k.toString(),document.getElementById("bankRecordMonthEdit--bankingMonth-span").innerText=h.toString();const e=document.getElementById("container--bankRecordMonthEdit-recordTypes");for(const t of exports.config_bankRecordTypes){const o=(n+=1).toString();e.insertAdjacentHTML("beforeend","<hr />"),e.insertAdjacentHTML("beforeend",'<input id="bankRecordMonthEdit--recordIndex-'+o+'" name="recordIndex-'+o+'" type="hidden" value="" />'),e.insertAdjacentHTML("beforeend",'<input name="bankRecordType-'+o+'" type="hidden" value="'+cityssm.escapeHTML(t.bankRecordType)+'" />'),e.insertAdjacentHTML("beforeend",'<div class="columns is-mobile"><div class="column"><strong>'+cityssm.escapeHTML(t.bankRecordTypeName)+'</strong></div><div class="column is-narrow has-text-right">'+(0===n?"":'<div class="facheck facheck-inline facheck-fas-checked is-info"><input id="bankRecordMonthEdit--syncRecordDate-'+o+'" name="syncRecordDate-'+o+'" type="checkbox" value="'+o+'" checked /><label for="bankRecordMonthEdit--syncRecordDate-'+o+'">Sync Record Date</label></div>')+'<div class="facheck facheck-inline facheck-fas-checked is-info"><input id="bankRecordMonthEdit--recordIsNA-'+o+'" name="recordIsNA-'+o+'" type="checkbox" value="1" /><label for="bankRecordMonthEdit--recordIsNA-'+o+'">Not Applicable</label></div></div></div>'),e.insertAdjacentHTML("beforeend",'<div class="columns"><div class="column"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input'+(0===n?"":" is-readonly")+'" id="bankRecordMonthEdit--recordDateString-'+o+'" name="recordDateString-'+o+'" type="date" aria-label="Record Date"'+(0===n?"":" readonly")+' /><span class="icon is-small is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><button class="button is-info" id="bankRecordMonthEdit--setToToday-'+o+'" data-tooltip="Set to Today" type="button" value="'+o+'"><i class="fas fa-calendar-day" aria-hidden="true"></i><span class="sr-only">Set to Today</span></button></div></div></div><div class="column"><div class="control has-icons-left"><input class="input" id="bankRecordMonthEdit--recordNote-'+o+'" name="recordNote-'+o+'" type="text" placeholder="Optional Note" aria-label="Optional Note" /><span class="icon is-small is-left"><i class="fas fa-sticky-note" aria-hidden="true"></i></span></div></div></div>');const r=p.get(t.bankRecordType);if(r&&(document.getElementById("bankRecordMonthEdit--recordIndex-"+o).value=r.recordIndex.toString(),r.recordIsNA&&(document.getElementById("bankRecordMonthEdit--recordIsNA-"+o).checked=!0),document.getElementById("bankRecordMonthEdit--recordDateString-"+o).value=r.recordDateString,document.getElementById("bankRecordMonthEdit--recordNote-"+o).value=r.recordNote),0!==n){const e=document.getElementById("bankRecordMonthEdit--syncRecordDate-"+o);e.addEventListener("change",s);const t=document.getElementById("bankRecordMonthEdit--recordDateString-0").value;(r&&r.recordDateString!==t||!r&&""!==t)&&(e.checked=!1,a(o))}document.getElementById("bankRecordMonthEdit--setToToday-"+o).addEventListener("click",m)}document.getElementById("bankRecordMonthEdit--bankRecordTypeIndex").value=n.toString(),n>=0&&document.getElementById("bankRecordMonthEdit--recordDateString-0").addEventListener("change",l)},onshown:(e,t)=>{document.getElementById("form--bankRecordMonthEdit").addEventListener("submit",g),u=t},onremoved:()=>{b||cityssm.disableNavBlocker()}})},u=s.getElementsByClassName("is-bank-record-month-button");for(const e of u)e.addEventListener("click",m)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown(e){"organizationTabContent--bankRecords"!==e.id||a||(a=!0,l())}})})();