(function(){function E(){y={};g.classList.remove("has-status-loaded");g.classList.add("has-status-loading");for(var a=g.getElementsByClassName("is-bank-record-button"),b=0;b<a.length;b+=1){var c=a[b];c.classList.remove("is-success");c.classList.remove("is-info");c.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>';c.setAttribute("data-record-index","")}}function t(){E();var a=function(a){for(var c=0;c<
a.length;c+=1){var b=a[c];y[b.recordIndex]=b;var f=g.querySelector("[data-banking-month='"+b.bankingMonth+"']").querySelector("[data-bank-record-type='"+b.bankRecordType+"']");f&&(f.setAttribute("data-record-index",b.recordIndex),b.recordIsNA?(f.classList.add("is-info"),f.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'+(""===b.recordNote?"":' <span class="has-margin-left-5" data-tooltip="'+cityssm.escapeHTML(b.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')):
(f.classList.add("is-success"),f.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+b.recordDateString+"</small>"+(""===b.recordNote?"":' <span class="has-margin-left-5" data-tooltip="'+cityssm.escapeHTML(b.recordNote)+'"><i class="fas fa-sticky-note" aria-hidden="true"></i></span>')))}g.classList.remove("has-status-loading");g.classList.add("has-status-loaded")};""===h.value?a([]):cityssm.postJSON("/organizations/doGetBankRecords",{organizationID:w,bankingYear:u.value,
accountNumber:h.value},a)}function B(){cityssm.postJSON("/organizations/doGetBankRecordStats",{organizationID:w},function(a){var b=(new Date).getFullYear(),c=b-1;if(0===a.length)h.innerHTML='<option value="">(No Accounts Recorded)</option>';else{h.innerHTML="";for(var d=0;d<a.length;d+=1){var f=a[d],c=Math.min(f.bankingYearMin,c),e=cityssm.escapeHTML(f.accountNumber);h.insertAdjacentHTML("beforeend",'<option value="'+e+'">'+e+" (From "+f.bankingYearMin+" to "+f.bankingYearMax+")</option>")}}u.innerHTML=
"";for(a=b;a>=c;--a)u.insertAdjacentHTML("beforeend",'<option value="'+a+'">'+a+"</option>");t()})}var m="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),k=document.getElementById("container--remarks");if(m){var n=k.getAttribute("data-organization-id"),p,x=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.openEditRemarkModal(n,a,p)},v=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.deleteRemark(n,
a,!0,p)};p=function(){llm.organizationRemarks.getRemarksByOrganizationID(n,function(a){cityssm.clearElement(k);if(0===a.length)k.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(var b=0;b<a.length;b+=1){var c=a[b];k.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+(c.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':
'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+cityssm.escapeHTML(c.remark)+'</p><p class="is-size-7">'+(c.recordCreate_timeMillis===c.recordUpdate_timeMillis?"":'<i class="fas fa-pencil-alt" aria-hidden="true"></i> ')+c.recordUpdate_userName+" - "+c.remarkDateString+" "+c.remarkTimeString+"</p></div>"+(c.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+
c.remarkIndex+'" data-tooltip="Edit Remark" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+c.remarkIndex+'" data-tooltip="Delete Remark" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}a=k.getElementsByClassName("is-edit-remark-button");
for(b=0;b<a.length;b+=1)a[b].addEventListener("click",x);a=k.getElementsByClassName("is-delete-remark-button");for(b=0;b<a.length;b+=1)a[b].addEventListener("click",v)}})};document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(a){a.preventDefault();llm.organizationRemarks.openAddRemarkModal(n,p)});for(var d=k.getElementsByClassName("is-edit-remark-button"),e=0;e<d.length;e+=1)d[e].addEventListener("click",x);d=k.getElementsByClassName("is-delete-remark-button");
for(e=0;e<d.length;e+=1)d[e].addEventListener("click",v)}if(d=document.getElementById("remark--searchStr")){d.value="";var F=document.getElementById("remark--displayCount"),l=k.getElementsByClassName("is-remark-block");d.addEventListener("keyup",function(a){a=a.currentTarget.value.trim().toLowerCase().split(" ");for(var b=l.length,c=0;c<l.length;c+=1){for(var d=l[c].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase(),f=!0,e=0;e<a.length;e+=1)if(-1===d.indexOf(a[e])){f=!1;--b;break}f?
l[c].classList.remove("is-hidden"):l[c].classList.add("is-hidden")}F.innerText=b})}var z=!1,y={},u=document.getElementById("bankRecordFilter--bankingYear"),h=document.getElementById("bankRecordFilter--accountNumber"),g=document.getElementById("table--bankRecords"),w=g.getAttribute("data-organization-id");u.addEventListener("change",t);h.addEventListener("change",t);if(m){m=function(a){var b,c=!1,e=!1,f=!0,d=function(a){a.preventDefault();cityssm.postJSON("/organizations/"+(c?"doEditBankRecord":"doAddBankRecord"),
a.currentTarget,function(a){a.success?(b(),c||e&&!f?t():(z=!1,B())):cityssm.alertModal("Record Not Saved",a.message,"OK","danger")})},k=function(a){a.preventDefault();var c=a.currentTarget.getAttribute("data-record-index");cityssm.confirmModal("Delete Bank Record?","Are you sure you want to delete this bank record?","Yes, Delete","warning",function(){cityssm.postJSON("/organizations/doDeleteBankRecord",{organizationID:w,recordIndex:c},function(){b();t()})})};a=a.currentTarget;var g="",m=h.value,f=
""===m,l="",n=!1,p="",r=new Date,x=r.getFullYear(),v=cityssm.dateToString(r),C=v;r.setMonth(r.getMonth()-1);var D=r.getFullYear(),A=r.getMonth()+1;"is-add-bank-record-button"!==a.id&&(e=!0,g=a.getAttribute("data-record-index"),D=u.value,""===g?(A=a.closest("tr").getAttribute("data-banking-month"),l=a.getAttribute("data-bank-record-type")):(a=y[parseInt(g)],c=!0,A=a.bankingMonth,l=a.bankRecordType,n=a.recordIsNA,C=a.recordDateString,p=a.recordNote));cityssm.openHtmlModal("organization-bankRecordEdit",
{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=w;document.getElementById("bankRecordEdit--recordIndex").value=g;var a=document.getElementById("bankRecordEdit--accountNumber");a.value=m;var b=document.getElementById("bankRecordEdit--bankingYear");b.value=D;b.setAttribute("max",x);var d=document.getElementById("bankRecordEdit--bankingMonth");d.value=A;for(var h=document.getElementById("bankRecordEdit--bankRecordType"),q=0;q<llm.config_bankRecordTypes.length;q+=1)h.insertAdjacentHTML("beforeend",
'<option value="'+llm.config_bankRecordTypes[q].bankRecordType+'">'+llm.config_bankRecordTypes[q].bankRecordTypeName+"</option>");""===l&&h.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>');h.value=l;q=document.getElementById("bankRecordEdit--recordDateString");q.value=C;q.setAttribute("max",v);n&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked");document.getElementById("bankRecordEdit--recordNote").value=p;e&&(f||(a.setAttribute("readonly",
"readonly"),a.classList.add("is-readonly")),b.setAttribute("readonly","readonly"),b.classList.add("is-readonly"),d.setAttribute("readonly","readonly"),d.classList.add("is-readonly"),h.setAttribute("readonly","readonly"),h.classList.add("is-readonly"));c?(a=document.getElementById("bankRecordEdit--deleteRecordButton"),a.setAttribute("data-record-index",g),a.addEventListener("click",k)):document.getElementById("bankRecordEdit--moreOptionsDropdown").remove()},onshown:function(a,c){b=c;a.getElementsByTagName("form")[0].addEventListener("submit",
d)}})};d=g.getElementsByTagName("button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",m);document.getElementById("is-add-bank-record-button").addEventListener("click",m)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(a){"organizationTabContent--bankRecords"!==a.id||z||(z=!0,B())}})})();
