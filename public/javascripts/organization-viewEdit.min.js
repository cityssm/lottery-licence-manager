(function(){function D(){x={};g.classList.remove("has-status-loaded");g.classList.add("has-status-loading");for(var a=g.getElementsByTagName("button"),c=0;c<a.length;c+=1){var b=a[c];b.classList.remove("is-success");b.classList.remove("is-info");b.innerHTML='<span class="icon"><i class="fas fa-minus has-text-grey-lighter" aria-hidden="true"></i></span><br /><small>No Record Recorded</small>';b.setAttribute("data-record-index","")}}function w(){D();llm.postJSON("/organizations/doGetBankRecords",{organizationID:y,
bankingYear:t.value,accountNumber:p.value},function(a){for(var c=0;c<a.length;c+=1){var b=a[c];x[b.recordIndex]=b;var f=g.querySelector("[data-banking-month='"+b.bankingMonth+"']").querySelector("[data-bank-record-type='"+b.bankRecordType+"']");f&&(f.setAttribute("data-record-index",b.recordIndex),b.recordIsNA?(f.classList.add("is-info"),f.innerHTML='<i class="fas fa-times" aria-hidden="true"></i><br /><small>Not Applicable</small>'):(f.classList.add("is-success"),f.innerHTML='<i class="fas fa-check" aria-hidden="true"></i><br /><small>Recorded '+
b.recordDateString+"</small>"))}g.classList.remove("has-status-loading");g.classList.add("has-status-loaded")})}function B(){llm.postJSON("/organizations/doGetBankRecordStats",{organizationID:y},function(a){var c=(new Date).getFullYear(),b=c-1;if(0===a.length)p.innerHTML='<option value="">(No Accounts Recorded)</option>';else{p.innerHTML="";for(var f=0;f<a.length;f+=1){var m=a[f],b=Math.min(m.bankingYearMin,b),d=llm.escapeHTML(m.accountNumber);p.insertAdjacentHTML("beforeend",'<option value="'+d+
'">'+d+" (From "+m.bankingYearMin+" to "+m.bankingYearMax+")</option>")}}t.innerHTML="";for(a=c;a>=b;--a)t.insertAdjacentHTML("beforeend",'<option value="'+a+'">'+a+"</option>");w()})}var k="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create"),h=document.getElementById("container--remarks");if(k){var q=h.getAttribute("data-organization-id"),n,u=function(a){a=a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.openEditRemarkModal(q,a,n)},v=function(a){a=
a.currentTarget.getAttribute("data-remark-index");llm.organizationRemarks.deleteRemark(q,a,!0,n)};n=function(){llm.organizationRemarks.getRemarksByOrganizationID(q,function(a){llm.clearElement(h);if(0===a.length)h.innerHTML='<div class="panel-block"><div class="message is-info"><p class="message-body">There are no remarks associated with this organization.</p></div></div>';else{for(var c=0;c<a.length;c+=1){var b=a[c];h.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="columns is-mobile"><div class="column is-narrow">'+
(b.isImportant?'<i class="fas fa-fw fa-star" aria-hidden="true"></i>':'<i class="far fa-fw fa-comment" aria-hidden="true"></i>')+'</div><div class="column"><p class="has-newline-chars">'+llm.escapeHTML(b.remark)+'</p><p class="is-size-7">'+b.recordUpdate_userName+" - "+b.remarkDateString+" "+b.remarkTimeString+"</p></div>"+(b.canUpdate?'<div class="column is-narrow"><div class="buttons is-right has-addons"><button class="button is-small is-edit-remark-button" data-remark-index="'+b.remarkIndex+'" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-remark-button" data-remark-index="'+
b.remarkIndex+'" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div>':"")+"</div></div>")}a=h.getElementsByClassName("is-edit-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",u);a=h.getElementsByClassName("is-delete-remark-button");for(c=0;c<a.length;c+=1)a[c].addEventListener("click",v)}})};document.getElementsByClassName("is-add-remark-button")[0].addEventListener("click",function(a){a.preventDefault();llm.organizationRemarks.openAddRemarkModal(q,
n)});for(var d=h.getElementsByClassName("is-edit-remark-button"),e=0;e<d.length;e+=1)d[e].addEventListener("click",u);d=h.getElementsByClassName("is-delete-remark-button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",v)}if(d=document.getElementById("remark--searchStr")){d.value="";var E=document.getElementById("remark--displayCount"),l=h.getElementsByClassName("is-remark-block");d.addEventListener("keyup",function(a){a=a.currentTarget.value.trim().toLowerCase().split(" ");for(var c=l.length,
b=0;b<l.length;b+=1){for(var d=l[b].getElementsByClassName("is-remark")[0].innerText.trim().toLowerCase(),m=!0,e=0;e<a.length;e+=1)if(-1===d.indexOf(a[e])){m=!1;--c;break}m?l[b].classList.remove("is-hidden"):l[b].classList.add("is-hidden")}E.innerText=c})}var z=!1,x={},t=document.getElementById("bankRecordFilter--bankingYear"),p=document.getElementById("bankRecordFilter--accountNumber"),g=document.getElementById("table--bankRecords"),y=g.getAttribute("data-organization-id");t.addEventListener("change",
w);p.addEventListener("change",w);if(k){k=function(a){var c,b=!1,d=function(a){a.preventDefault();llm.postJSON("/organizations/"+(b?"doEditBankRecord":"doAddBankRecord"),a.currentTarget,function(a){a.success?(c(),b?w():(z=!1,B())):llm.alertModal("Record Not Saved",a.message,"OK","danger")})};a=a.currentTarget;var e="",h=p.value,g="",k=!1,l="",r=new Date,q=r.getFullYear(),n=llm.dateToString(r),u=n;r.setMonth(r.getMonth()-1);var v=r.getFullYear(),A=r.getMonth()+1,C=!1;"is-add-bank-record-button"!==
a.id&&(C=!0,e=a.getAttribute("data-record-index"),v=t.value,""===e?(A=a.closest("tr").getAttribute("data-banking-month"),g=a.getAttribute("data-bank-record-type")):(a=x[parseInt(e)],b=!0,A=a.bankingMonth,g=a.bankRecordType,k=a.recordIsNA,u=a.recordDateString,l=a.recordNote));llm.openHtmlModal("organization-bankRecordEdit",{onshow:function(){document.getElementById("bankRecordEdit--organizationID").value=y;document.getElementById("bankRecordEdit--recordIndex").value=e;var a=document.getElementById("bankRecordEdit--accountNumber");
a.value=h;var b=document.getElementById("bankRecordEdit--bankingYear");b.value=v;b.setAttribute("max",q);var c=document.getElementById("bankRecordEdit--bankingMonth");c.value=A;for(var d=document.getElementById("bankRecordEdit--bankRecordType"),f=0;f<llm.config_bankRecordTypes.length;f+=1)d.insertAdjacentHTML("beforeend",'<option value="'+llm.config_bankRecordTypes[f].bankRecordType+'">'+llm.config_bankRecordTypes[f].bankRecordTypeName+"</option>");""===g&&d.insertAdjacentHTML("afterbegin",'<option value="">(Select One)</option>');
d.value=g;f=document.getElementById("bankRecordEdit--recordDateString");f.value=u;f.setAttribute("max",n);k&&document.getElementById("bankRecordEdit--recordIsNA").setAttribute("checked","checked");document.getElementById("bankRecordEdit--recordNote").value=l;C&&(a.setAttribute("readonly","readonly"),b.setAttribute("readonly","readonly"),c.setAttribute("readonly","readonly"),d.setAttribute("readonly","readonly"),a.classList.add("is-readonly"),b.classList.add("is-readonly"),c.classList.add("is-readonly"),
d.classList.add("is-readonly"))},onshown:function(a,b){c=b;a.getElementsByTagName("form")[0].addEventListener("submit",d)}})};d=g.getElementsByTagName("button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",k);document.getElementById("is-add-bank-record-button").addEventListener("click",k)}llm.initializeTabs(document.getElementById("tabs--organization"),{onshown:function(a){"organizationTab--bankRecords"!==a.id||z||(z=!0,B())}})})();
