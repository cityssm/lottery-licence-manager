"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=document.getElementById("eventNav--eventDate"),n=document.getElementById("form--event"),s=document.getElementById("container--form-message"),a=document.getElementById("event--licenceID").value,i=document.getElementById("event--eventDate").value;n.addEventListener("submit",a=>{a.preventDefault(),s.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(e+"/events/doSave",n,e=>{e.success&&(cityssm.disableNavBlocker(),t&&t.removeAttribute("disabled")),s.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger")})}),document.getElementById("is-delete-event-button").addEventListener("click",t=>{t.preventDefault(),cityssm.confirmModal("Delete Event?","Are you sure you want to delete this event?","Yes, Delete","danger",()=>{cityssm.postJSON(e+"/events/doDelete",{licenceID:a,eventDate:i},e=>{e.success&&(cityssm.disableNavBlocker(),window.location.href="/licences/"+a)})})});const c=()=>{cityssm.enableNavBlocker(),t&&t.setAttribute("disabled","disabled"),s.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},d=n.querySelectorAll("input, select, textarea");for(const e of d)""!==e.name&&e.addEventListener("change",c);document.getElementById("is-bank-information-lookup-button").addEventListener("click",t=>{let n,s;t.preventDefault();const i=e=>{e.preventDefault();const t=parseInt(e.currentTarget.getAttribute("data-list-index"),10),a=s[t];document.getElementById("event--bank_name").value=a.bank_name,document.getElementById("event--bank_address").value=a.bank_address,document.getElementById("event--bank_accountNumber").value=a.bank_accountNumber,c(),n()};cityssm.openHtmlModal("event-bankInformationLookup",{onshow:()=>{const t=document.getElementById("container--bankInformationLookup");cityssm.postJSON(e+"/events/doGetPastBankInformation",{licenceID:a},e=>{if(s=e,0===e.length)return void(t.innerHTML='<div class="message is-info"><p class="message-body">There is no previously used banking information available.</p></div>');const n=document.createElement("div");n.className="panel mb-3",s.forEach((e,t)=>{const s=document.createElement("a");s.className="panel-block is-block",s.setAttribute("data-list-index",t.toString()),s.innerHTML=`<div class="columns">\n            <div class="column">${cityssm.escapeHTML(e.bank_name)}</div>\n            <div class="column">${cityssm.escapeHTML(e.bank_address)}</div>\n            <div class="column">${cityssm.escapeHTML(e.bank_accountNumber)}</div>\n            </div>\n            <div class="has-text-right">\n            <span class="tag is-info" data-tooltip="Last Used Event Date">\n            ${e.eventDateMaxString}\n            </span>\n            </div>`,s.addEventListener("click",i),n.insertAdjacentElement("beforeend",s)}),cityssm.clearElement(t),t.insertAdjacentElement("beforeend",n)})},onshown(e,t){n=t}})});const o={receipts:0,admin:0,prizesAwarded:0},l=document.getElementById("event--costs"),r=e=>{let t=0;const n=e.currentTarget.closest("tr"),s=n.getElementsByTagName("input");for(let e=0;e<s.length;e+=1){const n=parseFloat(s[e].value||"0");t+=("receipts"===s[e].getAttribute("data-cost")?1:-1)*n}document.getElementById("event--costs_netProceeds-"+n.getAttribute("data-ticket-type")).innerHTML=llm.formatDollarsAsHTML(t)},m=e=>{o[e]=0,l.querySelectorAll("input[data-cost='"+e+"']").forEach(t=>{o[e]+=parseFloat(t.value||"0")}),document.getElementById("event--costs_"+e+"Sum").innerHTML=llm.formatDollarsAsHTML(o[e]),document.getElementById("event--costs_netProceedsSum").innerHTML=llm.formatDollarsAsHTML(o.receipts-o.admin-o.prizesAwarded)},u=()=>{m("receipts")},v=()=>{m("admin")},p=()=>{m("prizesAwarded")},g=l.getElementsByTagName("input");for(let e=0;e<g.length;e+=1){const t=g[e];switch(t.addEventListener("keyup",r),t.getAttribute("data-cost")){case"receipts":t.addEventListener("keyup",u);break;case"admin":t.addEventListener("keyup",v);break;case"prizesAwarded":t.addEventListener("keyup",p)}}m("receipts"),m("admin"),m("prizesAwarded")})();