"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=cityssm.escapeHTML(e),s=cityssm.dateToString(new Date),a=document.querySelector("#filter--eventDate"),i=document.querySelector("#filter--showLicences"),n=document.querySelector("#container--events"),c=exports.config_days;delete exports.config_days;const r=exports.config_licenceTypes;delete exports.config_licenceTypes;const d=()=>{cityssm.clearElement(n),""===a.value&&(a.value=cityssm.dateToString(new Date)),cityssm.postJSON(e+"/events/doGetEventsByWeek",{eventDate:a.value},e=>{if(0===e.licences.length&&0===e.events.length)return void(n.innerHTML=`<div class="message is-info">\n            <p class="message-body">\n            There are no licences or events with activity between\n            ${e.startDateString} and ${e.endDateString}.\n            </p>\n            </div>`);const a=document.createElement("table");a.className="table is-fixed is-fullwidth is-bordered has-sticky-header";let d="<thead><tr>";const l=cityssm.dateStringToDate(e.startDateString);for(let e=0;e<=6;e+=1){const t=cityssm.dateToString(l);d+='<th class="has-text-centered'+(t===s?" has-background-primary has-text-white":" has-background-white-ter")+'">'+c[e]+"<br />"+t+"</th>",l.setDate(l.getDate()+1)}d+="</tr></thead>",a.innerHTML=d;const o=document.createElement("tbody");o.id="tbody--licences",i.checked||(o.className="is-hidden");for(const s of e.licences){let a=0,i="";if(s.startDateString>e.startDateString){a=cityssm.dateStringDifferenceInDays(e.startDateString,s.startDateString);for(let e=0;e<a;e+=1)i+="<td></td>"}let n=1;s.startDateString!==s.endDateString&&(n=Math.min(7-a,cityssm.dateStringDifferenceInDays(0===a?e.startDateString:s.startDateString,s.endDateString)+1));let c="";for(let e=a+n;e<7;e+=1)c+="<td></td>";const d=r[s.licenceTypeKey];o.insertAdjacentHTML("beforeend","<tr>"+i+'<td colspan="'+n.toString()+'"><a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light" data-tooltip="View Licence" href="'+t+"/licences/"+s.licenceID.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+s.externalLicenceNumber+"<br />"+(d||s.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+(""===s.locationName?s.locationAddress1:s.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+s.organizationName+'</div></div><div class="columns is-variable is-1"><div class="column is-narrow"><i class="fas fa-fw fa-calendar" aria-hidden="true"></i></div><div class="column">'+s.startDateString+(s.startDateString===s.endDateString?"":" to "+s.endDateString)+"</div></div></a></td>"+c+"</tr>")}a.append(o);const m=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(const s of e.events){const e=r[s.licenceTypeKey];m[cityssm.dateStringToDate(s.eventDateString).getDay()].insertAdjacentHTML("beforeend",'<a class="button mb-2 has-text-left is-small is-block has-height-auto is-wrap is-link is-light" data-tooltip="View Event" href="'+t+"/events/"+s.licenceID.toString()+"/"+s.eventDate.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-clock" aria-hidden="true"></i></div><div class="column pb-2">'+s.startTimeString+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+cityssm.escapeHTML(s.externalLicenceNumber)+"<br />"+(e||s.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(""===s.locationName?s.locationAddress1:s.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(s.organizationName)+"</div></div></a>")}const v=document.createElement("tr");for(const e of m)v.append(e);const u=document.createElement("tbody");u.append(v),a.append(u),n.append(a)})};a.addEventListener("change",d),d(),i.addEventListener("change",()=>{i.checked?document.querySelector("#tbody--licences").classList.remove("is-hidden"):document.querySelector("#tbody--licences").classList.add("is-hidden")})})();