"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t;const n=null!==(t=null===(e=document.querySelector("main"))||void 0===e?void 0:e.dataset.urlPrefix)&&void 0!==t?t:"",s=cityssm.escapeHTML(n),i=cityssm.dateToString(new Date),a=document.querySelector("#filter--eventDate"),c=document.querySelector("#filter--showLicences"),r=document.querySelector("#container--events"),d=exports.config_days,l=exports.config_licenceTypes;function o(){cityssm.clearElement(r),""===a.value&&(a.value=cityssm.dateToString(new Date)),cityssm.postJSON(`${n}/events/doGetEventsByWeek`,{eventDate:a.value},e=>{var t,n;const a=e;if(0===a.licences.length&&0===a.events.length)return void(r.innerHTML=`<div class="message is-info">\n            <p class="message-body">\n            There are no licences or events with activity between\n            ${cityssm.escapeHTML(a.startDateString)} and ${cityssm.escapeHTML(a.endDateString)}.\n            </p>\n            </div>`);const o=document.createElement("table");o.className="table is-fixed is-fullwidth is-bordered has-sticky-header";let m="<thead><tr>";const v=cityssm.dateStringToDate(a.startDateString);for(let e=0;e<=6;e+=1){const t=cityssm.dateToString(v);m+=`<th class="has-text-centered\n            ${t===i?" has-background-primary has-text-white":" has-background-white-ter"}">\n              ${d[e]}<br />\n              ${t}\n            </th>`,v.setDate(v.getDate()+1)}m+="</tr></thead>",o.innerHTML=m;const u=document.createElement("tbody");u.id="tbody--licences",c.checked||(u.className="is-hidden");for(const e of a.licences){let n=0,i="";if(e.startDateString>a.startDateString){n=cityssm.dateStringDifferenceInDays(a.startDateString,e.startDateString);for(let e=0;e<n;e+=1)i+="<td></td>"}let c=1;e.startDateString!==e.endDateString&&(c=Math.min(7-n,cityssm.dateStringDifferenceInDays(0===n?a.startDateString:e.startDateString,e.endDateString)+1));let r="";for(let e=n+c;e<7;e+=1)r+="<td></td>";const d=l[e.licenceTypeKey];u.insertAdjacentHTML("beforeend",`<tr>\n              ${i}\n              <td colspan="${c.toString()}">\n                <a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light"\n                  data-tooltip="View Licence" href="${s}/licences/${e.licenceID.toString()}">\n                  <div class="columns mb-0 is-variable is-1">\n                    <div class="column pb-2 is-narrow">\n                      <i class="fas fa-fw fa-certificate" aria-hidden="true"></i>\n                    </div>\n                    <div class="column pb-2 has-text-weight-semibold">\n                      ${cityssm.escapeHTML(e.externalLicenceNumber)}<br />\n                      ${cityssm.escapeHTML(null!=d?d:e.licenceTypeKey)}\n                    </div>\n                  </div>\n                  <div class="columns mb-0 is-variable is-1">\n                    <div class="column pb-2 is-narrow">\n                      <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i>\n                    </div>\n                    <div class="column pb-2">\n                      ${cityssm.escapeHTML(""===e.locationName?e.locationAddress1:e.locationName)}\n                    </div>\n                  </div>\n                  <div class="columns mb-0 is-variable is-1">\n                    <div class="column pb-2 is-narrow">\n                      <i class="fas fa-fw fa-users" aria-hidden="true"></i>\n                    </div>\n                    <div class="column pb-2">\n                      ${cityssm.escapeHTML(null!==(t=e.organizationName)&&void 0!==t?t:"")}\n                    </div>\n                  </div>\n                  <div class="columns is-variable is-1">\n                    <div class="column is-narrow">\n                      <i class="fas fa-fw fa-calendar" aria-hidden="true"></i>\n                    </div>\n                    <div class="column">\n                      ${cityssm.escapeHTML(e.startDateString)}\n                      ${cityssm.escapeHTML(e.startDateString===e.endDateString?"":` to ${e.endDateString}`)}\n                    </div>\n                  </div>\n                </a>\n              </td>\n              ${r}\n            </tr>`)}o.append(u);const f=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(const e of a.events){const t=l[e.licenceTypeKey];f[cityssm.dateStringToDate(e.eventDateString).getDay()].insertAdjacentHTML("beforeend",`<a class="button mb-2 has-text-left is-small is-block has-height-auto is-wrap is-link is-light"\n              data-tooltip="View Event"\n              href="${s}/events/${e.licenceID.toString()}/${e.eventDate.toString()}">\n              <div class="columns mb-0 is-variable is-1">\n                <div class="column pb-2 is-narrow">\n                  <i class="fas fa-fw fa-clock" aria-hidden="true"></i>\n                </div>\n                <div class="column pb-2">\n                  ${cityssm.escapeHTML(e.startTimeString)}\n                </div>\n              </div>\n              <div class="columns mb-0 is-variable is-1">\n                <div class="column pb-2 is-narrow">\n                  <i class="fas fa-fw fa-certificate" aria-hidden="true"></i>\n                </div>\n                <div class="column pb-2 has-text-weight-semibold">\n                  ${cityssm.escapeHTML(e.externalLicenceNumber)}<br />\n                  ${cityssm.escapeHTML(null!=t?t:e.licenceTypeKey)}\n                </div>\n              </div>\n              <div class="columns mb-0 is-variable is-1">\n                <div class="column pb-2 is-narrow">\n                  <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i>\n                </div>\n                <div class="column pb-2">\n                  ${cityssm.escapeHTML(""===e.locationName?e.locationAddress1:e.locationName)}\n                </div>\n              </div>\n              <div class="columns mb-0 is-variable is-1">\n                <div class="column pb-2 is-narrow">\n                  <i class="fas fa-fw fa-users" aria-hidden="true"></i>\n                </div>\n                <div class="column pb-2">\n                  ${cityssm.escapeHTML(null!==(n=e.organizationName)&&void 0!==n?n:"")}\n                </div>\n              </div>\n            </a>`)}const p=document.createElement("tr");for(const e of f)p.append(e);const b=document.createElement("tbody");b.append(p),o.append(b),r.append(o)})}a.addEventListener("change",o),o(),c.addEventListener("change",()=>{var e,t;c.checked?null===(e=document.querySelector("#tbody--licences"))||void 0===e||e.classList.remove("is-hidden"):null===(t=document.querySelector("#tbody--licences"))||void 0===t||t.classList.add("is-hidden")})})();