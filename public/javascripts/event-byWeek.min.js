"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=cityssm.dateToString(new Date),i=document.getElementById("filter--eventDate"),a=document.getElementById("filter--showLicences"),s=document.getElementById("container--events"),n=exports.config_days;delete exports.config_days;const c=exports.config_licenceTypes;delete exports.config_licenceTypes;const d=()=>{cityssm.clearElement(s),""===i.value&&(i.value=cityssm.dateToString(new Date)),cityssm.postJSON(e+"/events/doGetEventsByWeek",{eventDate:i.value},e=>{if(0===e.licences.length&&0===e.events.length)return void(s.innerHTML=`<div class="message is-info">\n            <p class="message-body">\n            There are no licences or events with activity between\n            ${e.startDateString} and ${e.endDateString}.\n            </p>\n            </div>`);const i=document.createElement("table");i.className="table is-fixed is-fullwidth is-bordered";let d="<thead><tr>";const r=cityssm.dateStringToDate(e.startDateString);for(let e=0;e<=6;e+=1){const i=cityssm.dateToString(r);d+='<th class="has-text-centered'+(i===t?" has-background-primary has-text-white":" has-background-white-ter")+'">'+n[e]+"<br />"+i+"</th>",r.setDate(r.getDate()+1)}d+="</tr></thead>",i.innerHTML=d;const l=document.createElement("tbody");l.id="tbody--licences",a.checked||(l.className="is-hidden");for(const t of e.licences){let i=0,a="";if(t.startDateString>e.startDateString){i=cityssm.dateStringDifferenceInDays(e.startDateString,t.startDateString);for(let e=0;e<i;e+=1)a+="<td></td>"}let s=1;t.startDateString!==t.endDateString&&(s=Math.min(7-i,cityssm.dateStringDifferenceInDays(0===i?e.startDateString:t.startDateString,t.endDateString)+1));let n="";for(let e=i+s;e<7;e+=1)n+="<td></td>";const d=c[t.licenceTypeKey];l.insertAdjacentHTML("beforeend","<tr>"+a+'<td colspan="'+s.toString()+'"><a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light" data-tooltip="View Licence" href="/licences/'+t.licenceID.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+t.externalLicenceNumber+"<br />"+(d||t.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+(""===t.locationName?t.locationAddress1:t.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+t.organizationName+'</div></div><div class="columns is-variable is-1"><div class="column is-narrow"><i class="fas fa-fw fa-calendar" aria-hidden="true"></i></div><div class="column">'+t.startDateString+(t.startDateString===t.endDateString?"":" to "+t.endDateString)+"</div></div></a></td>"+n+"</tr>")}i.appendChild(l);const o=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(const t of e.events){const e=c[t.licenceTypeKey];o[cityssm.dateStringToDate(t.eventDateString).getDay()].insertAdjacentHTML("beforeend",'<a class="button mb-2 has-text-left is-small is-block has-height-auto is-wrap is-link is-light" data-tooltip="View Event" href="/events/'+t.licenceID.toString()+"/"+t.eventDate.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-clock" aria-hidden="true"></i></div><div class="column pb-2">'+t.startTimeString+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+cityssm.escapeHTML(t.externalLicenceNumber)+"<br />"+(e||t.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(""===t.locationName?t.locationAddress1:t.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(t.organizationName)+"</div></div></a>")}const m=document.createElement("tr");for(const e of o)m.appendChild(e);const v=document.createElement("tbody");v.appendChild(m),i.appendChild(v),s.appendChild(i)})};i.addEventListener("change",d),d(),a.addEventListener("change",()=>{a.checked?document.getElementById("tbody--licences").classList.remove("is-hidden"):document.getElementById("tbody--licences").classList.add("is-hidden")})})();