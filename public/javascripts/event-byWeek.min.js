"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=cityssm.escapeHTML(e),i=cityssm.dateToString(new Date),a=document.getElementById("filter--eventDate"),s=document.getElementById("filter--showLicences"),n=document.getElementById("container--events"),c=exports.config_days;delete exports.config_days;const d=exports.config_licenceTypes;delete exports.config_licenceTypes;const r=()=>{cityssm.clearElement(n),""===a.value&&(a.value=cityssm.dateToString(new Date)),cityssm.postJSON(e+"/events/doGetEventsByWeek",{eventDate:a.value},e=>{if(0===e.licences.length&&0===e.events.length)return void(n.innerHTML=`<div class="message is-info">\n            <p class="message-body">\n            There are no licences or events with activity between\n            ${e.startDateString} and ${e.endDateString}.\n            </p>\n            </div>`);const a=document.createElement("table");a.className="table is-fixed is-fullwidth is-bordered";let r="<thead><tr>";const l=cityssm.dateStringToDate(e.startDateString);for(let e=0;e<=6;e+=1){const t=cityssm.dateToString(l);r+='<th class="has-text-centered'+(t===i?" has-background-primary has-text-white":" has-background-white-ter")+'">'+c[e]+"<br />"+t+"</th>",l.setDate(l.getDate()+1)}r+="</tr></thead>",a.innerHTML=r;const o=document.createElement("tbody");o.id="tbody--licences",s.checked||(o.className="is-hidden");for(const i of e.licences){let a=0,s="";if(i.startDateString>e.startDateString){a=cityssm.dateStringDifferenceInDays(e.startDateString,i.startDateString);for(let e=0;e<a;e+=1)s+="<td></td>"}let n=1;i.startDateString!==i.endDateString&&(n=Math.min(7-a,cityssm.dateStringDifferenceInDays(0===a?e.startDateString:i.startDateString,i.endDateString)+1));let c="";for(let e=a+n;e<7;e+=1)c+="<td></td>";const r=d[i.licenceTypeKey];o.insertAdjacentHTML("beforeend","<tr>"+s+'<td colspan="'+n.toString()+'"><a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light" data-tooltip="View Licence" href="'+t+"/licences/"+i.licenceID.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+i.externalLicenceNumber+"<br />"+(r||i.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+(""===i.locationName?i.locationAddress1:i.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+i.organizationName+'</div></div><div class="columns is-variable is-1"><div class="column is-narrow"><i class="fas fa-fw fa-calendar" aria-hidden="true"></i></div><div class="column">'+i.startDateString+(i.startDateString===i.endDateString?"":" to "+i.endDateString)+"</div></div></a></td>"+c+"</tr>")}a.appendChild(o);const m=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(const i of e.events){const e=d[i.licenceTypeKey];m[cityssm.dateStringToDate(i.eventDateString).getDay()].insertAdjacentHTML("beforeend",'<a class="button mb-2 has-text-left is-small is-block has-height-auto is-wrap is-link is-light" data-tooltip="View Event" href="'+t+"/events/"+i.licenceID.toString()+"/"+i.eventDate.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-clock" aria-hidden="true"></i></div><div class="column pb-2">'+i.startTimeString+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+cityssm.escapeHTML(i.externalLicenceNumber)+"<br />"+(e||i.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(""===i.locationName?i.locationAddress1:i.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(i.organizationName)+"</div></div></a>")}const v=document.createElement("tr");for(const e of m)v.appendChild(e);const u=document.createElement("tbody");u.appendChild(v),a.appendChild(u),n.appendChild(a)})};a.addEventListener("change",r),r(),s.addEventListener("change",()=>{s.checked?document.getElementById("tbody--licences").classList.remove("is-hidden"):document.getElementById("tbody--licences").classList.add("is-hidden")})})();