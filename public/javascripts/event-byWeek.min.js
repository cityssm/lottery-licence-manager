"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=cityssm.dateToString(new Date),i=document.getElementById("filter--eventDate"),a=document.getElementById("filter--showLicences"),s=document.getElementById("container--events"),n=exports.config_days;delete exports.config_days;const c=exports.config_licenceTypes;delete exports.config_licenceTypes;const d=()=>{cityssm.clearElement(s),""===i.value&&(i.value=cityssm.dateToString(new Date)),cityssm.postJSON(e+"/events/doGetEventsByWeek",{eventDate:i.value},i=>{if(0===i.licences.length&&0===i.events.length)return void(s.innerHTML=`<div class="message is-info">\n            <p class="message-body">\n            There are no licences or events with activity between\n            ${i.startDateString} and ${i.endDateString}.\n            </p>\n            </div>`);const d=document.createElement("table");d.className="table is-fixed is-fullwidth is-bordered";let r="<thead><tr>";const l=cityssm.dateStringToDate(i.startDateString);for(let e=0;e<=6;e+=1){const i=cityssm.dateToString(l);r+='<th class="has-text-centered'+(i===t?" has-background-primary has-text-white":" has-background-white-ter")+'">'+n[e]+"<br />"+i+"</th>",l.setDate(l.getDate()+1)}r+="</tr></thead>",d.innerHTML=r;const o=document.createElement("tbody");o.id="tbody--licences",a.checked||(o.className="is-hidden");for(const t of i.licences){let a=0,s="";if(t.startDateString>i.startDateString){a=cityssm.dateStringDifferenceInDays(i.startDateString,t.startDateString);for(let e=0;e<a;e+=1)s+="<td></td>"}let n=1;t.startDateString!==t.endDateString&&(n=Math.min(7-a,cityssm.dateStringDifferenceInDays(0===a?i.startDateString:t.startDateString,t.endDateString)+1));let d="";for(let e=a+n;e<7;e+=1)d+="<td></td>";const r=c[t.licenceTypeKey];o.insertAdjacentHTML("beforeend","<tr>"+s+'<td colspan="'+n.toString()+'"><a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light" data-tooltip="View Licence" href="'+e+"/licences/"+t.licenceID.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+t.externalLicenceNumber+"<br />"+(r||t.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+(""===t.locationName?t.locationAddress1:t.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+t.organizationName+'</div></div><div class="columns is-variable is-1"><div class="column is-narrow"><i class="fas fa-fw fa-calendar" aria-hidden="true"></i></div><div class="column">'+t.startDateString+(t.startDateString===t.endDateString?"":" to "+t.endDateString)+"</div></div></a></td>"+d+"</tr>")}d.appendChild(o);const m=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(const t of i.events){const i=c[t.licenceTypeKey];m[cityssm.dateStringToDate(t.eventDateString).getDay()].insertAdjacentHTML("beforeend",'<a class="button mb-2 has-text-left is-small is-block has-height-auto is-wrap is-link is-light" data-tooltip="View Event" href="'+e+"/events/"+t.licenceID.toString()+"/"+t.eventDate.toString()+'"><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-clock" aria-hidden="true"></i></div><div class="column pb-2">'+t.startTimeString+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column pb-2 has-text-weight-semibold">'+cityssm.escapeHTML(t.externalLicenceNumber)+"<br />"+(i||t.licenceTypeKey)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(""===t.locationName?t.locationAddress1:t.locationName)+'</div></div><div class="columns mb-0 is-variable is-1"><div class="column pb-2 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column pb-2">'+cityssm.escapeHTML(t.organizationName)+"</div></div></a>")}const v=document.createElement("tr");for(const e of m)v.appendChild(e);const u=document.createElement("tbody");u.appendChild(v),d.appendChild(u),s.appendChild(d)})};i.addEventListener("change",d),d(),a.addEventListener("change",()=>{a.checked?document.getElementById("tbody--licences").classList.remove("is-hidden"):document.getElementById("tbody--licences").classList.add("is-hidden")})})();