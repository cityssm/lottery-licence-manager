(function(){function n(){cityssm.clearElement(l);""===h.value&&(h.value=cityssm.dateToString(new Date));cityssm.postJSON("/events/doGetEventsByWeek",{eventDate:h.value},function(b){if(0===b.licences.length&&0===b.events.length)l.innerHTML='<div class="message is-info"><p class="message-body">There are no licences or events with activity between '+b.startDateString+" and "+b.endDateString+".</p></div>";else{var k=document.createElement("table");k.className="table is-fixed is-fullwidth is-bordered";
for(var c="<thead><tr>",d=cityssm.dateStringToDate(b.startDateString),a=0;6>=a;a+=1){var f=cityssm.dateToString(d),c=c+('<th class="has-text-centered'+(f===q?" has-background-primary has-text-white":" has-background-white-ter")+'">'+r[a]+"<br />"+f+"</th>");d.setDate(d.getDate()+1)}k.innerHTML=c+"</tr></thead>";c=document.createElement("tbody");c.id="tbody--licences";m.checked||(c.className="is-hidden");for(d=0;d<b.licences.length;d+=1){var a=b.licences[d],e=0,f="";if(a.startDateString>b.startDateString)for(var e=
cityssm.dateStringDifferenceInDays(b.startDateString,a.startDateString),g=0;g<e;g+=1)f+="<td></td>";g=1;a.startDateString!==a.endDateString&&(g=Math.min(7-e,cityssm.dateStringDifferenceInDays(0===e?b.startDateString:a.startDateString,a.endDateString)+1));for(var h="",e=e+g;7>e;e+=1)h+="<td></td>";e=p[a.licenceTypeKey];c.insertAdjacentHTML("beforeend","<tr>"+f+'<td colspan="'+g+'"><a class="button has-text-left is-small is-block has-height-auto is-wrap is-primary is-light" data-tooltip="View Licence" href="/licences/'+
a.licenceID+'">'+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column has-padding-bottom-5 has-text-weight-semibold">'+a.externalLicenceNumber+"<br />"+(e?e:a.licenceTypeKey)+"</div></div>")+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column has-padding-bottom-5">'+
(""===a.locationName?a.locationAddress1:a.locationName)+"</div></div>")+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column has-padding-bottom-5">'+a.organizationName+"</div></div>")+('<div class="columns is-variable is-1"><div class="column is-narrow"><i class="fas fa-fw fa-calendar" aria-hidden="true"></i></div><div class="column">'+a.startDateString+(a.startDateString===
a.endDateString?"":" to "+a.endDateString)+"</div></div>")+"</a></td>"+h+"</tr>")}k.appendChild(c);c=[document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td"),document.createElement("td")];for(d=0;d<b.events.length;d+=1)a=b.events[d],f=p[a.licenceTypeKey],g=cityssm.dateStringToDate(a.eventDateString).getDay(),c[g].insertAdjacentHTML("beforeend",'<a class="button has-margin-bottom-5 has-text-left is-small is-block has-height-auto is-wrap is-link is-light" data-tooltip="View Event" href="/events/'+
a.licenceID+"/"+a.eventDate+'">'+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-clock" aria-hidden="true"></i></div><div class="column has-padding-bottom-5">'+a.startTimeString+"</div></div>")+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-certificate" aria-hidden="true"></i></div><div class="column has-padding-bottom-5 has-text-weight-semibold">'+
a.externalLicenceNumber+"<br />"+(f?f:a.licenceTypeKey)+"</div></div>")+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i></div><div class="column has-padding-bottom-5">'+(""===a.locationName?a.locationAddress1:a.locationName)+"</div></div>")+('<div class="columns has-margin-bottom-0 is-variable is-1"><div class="column has-padding-bottom-5 is-narrow"><i class="fas fa-fw fa-users" aria-hidden="true"></i></div><div class="column has-padding-bottom-5">'+
a.organizationName+"</div></div>")+"</a>");b=document.createElement("tr");for(d=0;d<c.length;d+=1)b.appendChild(c[d]);c=document.createElement("tbody");c.appendChild(b);k.appendChild(c);l.appendChild(k)}})}var q=cityssm.dateToString(new Date),h=document.getElementById("filter--eventDate"),m=document.getElementById("filter--showLicences"),l=document.getElementById("container--events"),r=llm.config_days;delete llm.config_days;var p=llm.config_licenceTypes;delete llm.config_licenceTypes;h.addEventListener("change",
n);n();m.addEventListener("change",function(){m.checked?document.getElementById("tbody--licences").classList.remove("is-hidden"):document.getElementById("tbody--licences").classList.add("is-hidden")})})();
