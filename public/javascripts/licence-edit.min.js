(function(){function n(){window.llm.enableNavBlocker();t.innerHTML='<div class="is-size-7 has-text-info"><i class="fas fa-exclamation-triangle"></i> Unsaved Changes</div>'}function y(a){a.preventDefault();a=a.currentTarget;document.getElementById("licence--organizationID").value=a.getAttribute("data-organization-id");document.getElementById("licence--organizationName").value=a.getAttribute("data-organization-name");window.llm.hideModal(a)}function u(){var a=document.createElement("div");a.className=
"list is-hoverable";for(var c=p.value.trim().toLowerCase().split(" "),b=10,d=0;d<l.length&&0<b;d+=1){for(var g=!0,e=l[d],h=e.OrganizationName.toLowerCase(),f=0;f<c.length;f+=1)if(-1===h.indexOf(c[f])){g=!1;break}g&&(--b,g=document.createElement("a"),g.className="list-item",g.setAttribute("data-organization-id",e.OrganizationID),g.setAttribute("data-organization-name",e.OrganizationName),g.innerText=e.OrganizationName,g.addEventListener("click",y),a.insertAdjacentElement("beforeend",g))}window.llm.clearElement(v);
v.insertAdjacentElement("beforeend",a)}function z(a){a.currentTarget.closest(".field").remove();q=!0;n()}function w(a){var c="";a&&a instanceof Date&&(c=a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2));m.insertAdjacentHTML("beforeend",'<div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+c+'" min="'+k.value+'" max="'+h.value+'" required /><span class="icon is-left"><i class="fas fa-calendar"></i></span></div><div class="control"><a class="button is-small is-danger" role="button" title="Remove Event"><i class="fas fa-trash"></i></a></div></div>');
a=m.getElementsByTagName("a");a[a.length-1].addEventListener("click",z);q=!0;n()}var r=document.getElementById("form--licence"),t=document.getElementById("container--form-message"),A=""===document.getElementById("licence--licenceID").value,q=!1;r.addEventListener("submit",function(a){a.preventDefault();window.fetch("/licences/doSave",{method:"post",credentials:"include",body:new URLSearchParams(new FormData(r))}).then(function(a){return a.json()}).then(function(a){a.success&&window.llm.disableNavBlocker();
a.success&&A?window.location.href="/licences/"+a.licenceID+"/edit":a.success&&q?window.location.reload(!0):t.innerHTML='<div class="is-size-7 '+(a.success?"has-text-success":"has-text-danger")+'">'+a.message+"</div>"})});for(var d=r.querySelectorAll("input, select, textarea"),e=0;e<d.length;e+=1)""!==d[e].name&&d[e].addEventListener("change",n);var l=[],x=document.getElementsByClassName("is-organization-lookup-modal")[0],p=document.getElementById("organizationLookup--searchStr"),v=document.getElementById("container--organizationLookup");
p.addEventListener("keyup",u);document.getElementsByClassName("is-organization-lookup-button")[0].addEventListener("click",function(){0===l.length&&window.fetch("/organizations/doGetAll",{method:"get",credentials:"include"}).then(function(a){return a.json()}).then(function(a){l=a;p.removeAttribute("disabled");u()});window.llm.showModal(x)});d=x.getElementsByClassName("is-cancel-button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",window.llm.hideModal);var d=document.getElementById("licence--licenceTypeKey"),
f=document.getElementsByClassName("container-licenceTypeFields");d.addEventListener("change",function(a){a="container-licenceTypeFields--"+a.currentTarget.value;for(var c=0;c<f.length;c+=1)f[c].id===a?(f[c].removeAttribute("disabled"),f[c].classList.remove("is-hidden")):(f[c].classList.add("is-hidden"),f[c].setAttribute("disabled","disabled"))});var k=document.getElementById("licence--startDateString"),h=document.getElementById("licence--endDateString"),m=document.getElementById("container--events");
document.getElementById("licence--applicationDateString").addEventListener("change",function(a){k.setAttribute("min",a.currentTarget.value)});k.addEventListener("change",function(){var a=k.value;h.setAttribute("min",a);h.value<a&&(h.value=a);for(var c=m.getElementsByTagName("input"),b=0;b<c.length;b+=1)c[b].setAttribute("min",a)});h.addEventListener("change",function(){for(var a=h.value,c=m.getElementsByTagName("input"),b=0;b<c.length;b+=1)c[b].setAttribute("max",a)});document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",
function(){for(var a=parseInt(document.getElementById("eventCalc--eventCount").value),c=parseInt(document.getElementById("eventCalc--dayInterval").value),b=h.value.split("-"),e=new Date(b[0],parseInt(b[1])-1,b[2]),b=k.value.split("-"),b=new Date(b[0],parseInt(b[1])-1,b[2]),d=0;d<a&&b.getTime()<=e.getTime();d+=1)w(b),b.setDate(b.getDate()+c)});document.getElementsByClassName("is-add-event-button")[0].addEventListener("click",w)})();
