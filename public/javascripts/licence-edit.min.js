"use strict";var _a,_b,_c;if(Object.defineProperty(exports,"__esModule",{value:!0}),llm.licenceEdit={},(()=>{var e;const t=null===(e=document.querySelector("main"))||void 0===e?void 0:e.dataset.urlPrefix,n=document.querySelector("#form--licence"),o=document.querySelector("#container--form-message"),a=document.querySelector("#licence--licenceID").value,i=""===a,c="true"===n.getAttribute("data-licence-is-issued"),s=new Set(["number","date","time"]);let l=!1,r=!1;const d=document.querySelector("#container--events");n.addEventListener("submit",e=>{e.preventDefault(),0!==d.querySelectorAll("input").length?(o.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(t+"/licences/doSave",n,e=>{if(e.success&&(cityssm.disableNavBlocker(),r=!1),e.success&&i)window.location.href=t+"/licences/"+e.licenceID.toString()+"/edit";else if(e.success&&l)window.location.reload();else{o.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger");const t=document.querySelectorAll(".is-removed-after-save");for(const e of t)e.remove()}})):cityssm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning")}),i||document.querySelector("#is-delete-licence-button").addEventListener("click",e=>{e.preventDefault();cityssm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",()=>{cityssm.postJSON(t+"/licences/doDelete",{licenceID:a},e=>{e.success&&(cityssm.disableNavBlocker(),window.location.href=t+"/licences")})})}),llm.licenceEdit.setDoRefreshAfterSaveFunction=(()=>{l=!0}),llm.licenceEdit.setUnsavedChangesFunction=(e=>{if(cityssm.enableNavBlocker(),r=!0,o.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>',i||(document.querySelector("#is-add-transaction-button").setAttribute("disabled","disabled"),document.querySelector("#is-disabled-transaction-message").classList.remove("is-hidden")),e){const t=e.currentTarget instanceof HTMLInputElement?e.currentTarget.type:"";s.has(t)&&llm.licenceEdit.setDoRefreshAfterSaveFunction()}});const u=n.querySelectorAll("input, select, textarea");for(const e of u)""!==e.name&&e.addEventListener("change",llm.licenceEdit.setUnsavedChangesFunction);const m=document.querySelector("#is-external-licence-number-unlock-button");m&&m.addEventListener("click",()=>{const e=document.querySelector("#licence--externalLicenceNumber");e.classList.remove("is-readonly"),e.removeAttribute("readonly"),e.focus()});{let e,n,o,a=[];const i=t=>{t.preventDefault();const n=t.currentTarget;document.querySelector("#licence--organizationID").value=n.getAttribute("data-organization-id"),document.querySelector("#licence--organizationName").value=n.getAttribute("data-organization-name"),e(),llm.licenceEdit.setUnsavedChangesFunction()},c=()=>{const e=document.createElement("div");e.className="panel";const t=n.value.trim().toLowerCase().split(" ");let c=10;for(const n of a){if(c<0)break;let o=!0;if(!n.isEligibleForLicences)continue;const a=n.organizationName.toLowerCase();for(const e of t)if(!a.includes(e)){o=!1;break}if(o){c-=1;const t=document.createElement("a");t.className="panel-block is-block",t.dataset.organizationId=n.organizationID.toString(),t.dataset.organizationName=n.organizationName,t.setAttribute("href","#"),t.innerHTML=cityssm.escapeHTML(n.organizationName)+'<br /><span class="is-size-7"><span class="icon"><i class="fas fa-user" aria-hidden="true"></i></span> '+(n.representativeName?cityssm.escapeHTML(n.representativeName):'<span class="has-text-grey">(No Representative)</span>')+"</span>",t.addEventListener("click",i),e.append(t)}}cityssm.clearElement(o),o.append(e)},s=()=>{cityssm.openHtmlModal("licence-organizationLookup",{onshow(){(n=document.querySelector("#organizationLookup--searchStr")).addEventListener("keyup",c),o=document.querySelector("#container--organizationLookup"),0===a.length?cityssm.postJSON(t+"/organizations/doGetAll",void 0,e=>{a=e,n.removeAttribute("disabled"),c(),n.focus()}):(n.removeAttribute("disabled"),c(),n.focus())},onshown(t,o){e=o,n.focus()},onremoved(){document.querySelector("#is-organization-lookup-button").focus()}})};document.querySelector("#is-organization-lookup-button").addEventListener("click",s),document.querySelector("#licence--organizationName").addEventListener("dblclick",s)}let p=[];llm.licenceEdit.loadLocationListFunction=(e=>{0===p.length?cityssm.postJSON(t+"/locations/doGetLocations",{},t=>{p=t.locations,e(p)}):e(p)});{let e,n,o;const a=(e,t)=>{document.querySelector("#licence--locationID").value=e.toString(),document.querySelector("#licence--locationDisplayName").value=t},i=t=>{t.preventDefault();const n=t.currentTarget;a(Number.parseInt(n.getAttribute("data-location-id"),10),n.getAttribute("data-location-display-name")),e(),llm.licenceEdit.setUnsavedChangesFunction()},c=()=>{const e=document.createElement("div");e.className="panel";const t=n.value.trim().toLowerCase().split(" ");let a=10;for(const n of p){if(a<=0)break;let o=!0;const c=n.locationName.toLowerCase();for(const e of t)if(!c.includes(e)){o=!1;break}if(o){a-=1;const t=document.createElement("a");t.className="panel-block is-block",t.dataset.locationId=n.locationID.toString(),t.dataset.locationDisplayName=n.locationDisplayName,t.setAttribute("href","#"),t.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(n.locationDisplayName)+"</div>"+(""===n.locationName?"":'<div class="column">'+cityssm.escapeHTML(n.locationAddress1)+"</div>")+"</div>",t.addEventListener("click",i),e.append(t)}}cityssm.clearElement(o),o.append(e)},s=()=>{cityssm.openHtmlModal("licence-locationLookup",{onshow(i){(n=document.querySelector("#locationLookup--searchStr")).addEventListener("keyup",c),o=document.querySelector("#container--locationLookup"),llm.licenceEdit.loadLocationListFunction(()=>{n.removeAttribute("disabled"),c(),n.focus()}),llm.getDefaultConfigProperty("city",e=>{e&&(document.querySelector("#newLocation--locationCity").value=e)}),llm.getDefaultConfigProperty("province",e=>{e&&(document.querySelector("#newLocation--locationProvince").value=e)}),document.querySelector("#form--newLocation").addEventListener("submit",n=>{n.preventDefault(),cityssm.postJSON(t+"/locations/doCreate",n.currentTarget,t=>{t.success&&(p=[],a(t.locationID,t.locationDisplayName),e())})}),llm.initializeTabs(i.querySelector(".tabs ul"))},onshown(t,o){e=o,n.focus()},onremoved(){document.querySelector("#is-location-lookup-button").focus()}})};document.querySelector("#is-location-lookup-button").addEventListener("click",s),document.querySelector("#licence--locationDisplayName").addEventListener("dblclick",s)}document.querySelector("#is-endDateString-year-button").addEventListener("click",()=>{const e=document.querySelector("#licence--endDateString"),t=e.valueAsDate;t.setFullYear(t.getFullYear()+1),e.valueAsDate=t,llm.licenceEdit.setUnsavedChangesFunction(),llm.licenceEdit.setDoRefreshAfterSaveFunction()});{let e=[];const n=document.querySelector("#is-termsConditions-lookup-modal"),o=document.querySelector("#container--termsConditionsPrevious"),a=t=>{t.preventDefault();const o=Number.parseInt(t.currentTarget.getAttribute("data-terms-conditions-index"),10),a=document.querySelector("#licence--termsConditions");a.value=e[o].termsConditions,cityssm.hideModal(n),a.focus(),llm.licenceEdit.setUnsavedChangesFunction()};document.querySelector("#is-termsConditions-lookup-button").addEventListener("click",()=>{e=[],cityssm.clearElement(o);const i=document.querySelector("#licence--organizationID").value;""!==i?(o.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Loading previously used terms and conditions...</p>',cityssm.postJSON(t+"/licences/doGetDistinctTermsConditions",{organizationID:i},t=>{if(0===(e=t).length)o.innerHTML='<p class="has-text-centered">No previously used terms and conditions found for this organization.</p>';else{const t=document.createElement("div");t.className="panel mb-3";for(const[n,o]of e.entries()){const e=document.createElement("a");e.className="panel-block is-block",e.dataset.termsConditionsIndex=n.toString(),e.innerHTML='<p class="has-newline-chars">'+cityssm.escapeHTML(o.termsConditions)+'</p><p class="has-text-right">'+(o.termsConditionsCount>1?'<span class="tag is-light has-tooltip-left" data-tooltip="Included on Multiple Licences"><span class="icon"><i class="fas fa-star" aria-hidden="true"></i></span> <span>Used '+o.termsConditionsCount.toString()+" times</span></span>":"")+(o.isIssued>=1?'<span class="tag is-info has-tooltip-left" data-tooltip="Included on an Issued Licence"><span class="icon"><i class="fas fa-stamp" aria-hidden="true"></i></span> <span>Issued</span></span>':"")+' <span class="tag is-info has-tooltip-left" data-tooltip="Most Recent Licence Start Date"><span class="icon"><i class="fas fa-calendar" aria-hidden="true"></i></span> <span>'+o.startDateMaxString+"</span></span></p>",e.addEventListener("click",a),t.append(e)}cityssm.clearElement(o),o.append(t)}}),cityssm.showModal(n)):cityssm.alertModal("No Organization Selected","An organization must be selected before the previously used terms and conditions can be retrieved.","OK","warning")});const i=n.querySelectorAll(".is-close-modal-button");for(const e of i)e.addEventListener("click",cityssm.hideModal)}const y=document.querySelector("#licence--licenceTypeKey");if(i){const e=document.querySelectorAll(".container-licenceTypeFields"),t=()=>{const t=y.selectedOptions[0],n=t.dataset.totalPrizeValueMax;document.querySelector("#licence--totalPrizeValue").setAttribute("max",n);const o="true"===t.dataset.hasTicketTypes,a=document.querySelector("#licence--totalPrizeValue");if(o)document.querySelector("#is-ticket-types-panel").classList.remove("is-hidden"),a.setAttribute("readonly","readonly"),a.classList.add("is-readonly");else{const e=document.querySelector("#is-ticket-types-panel");e.classList.add("is-hidden"),cityssm.clearElement(e.querySelector("tbody")),cityssm.clearElement(e.querySelector("tfoot")),a.removeAttribute("readonly"),a.classList.remove("is-readonly")}const i="container-licenceTypeFields--"+y.value;for(const t of e)t.id===i?(t.removeAttribute("disabled"),t.classList.remove("is-hidden")):(t.classList.add("is-hidden"),t.setAttribute("disabled","disabled"))};y.addEventListener("change",t)}{const e=document.querySelector("#licence--startDateString"),t=document.querySelector("#licence--endDateString"),n=()=>{const n=e.value;t.setAttribute("min",n),t.value<n&&(t.value=n);const o=d.querySelectorAll("input");for(const e of o)e.setAttribute("min",n)},o=()=>{const e=t.value,n=d.querySelectorAll("input");for(const t of n)t.setAttribute("max",e)};document.querySelector("#licence--applicationDateString").addEventListener("change",t=>{e.setAttribute("min",t.currentTarget.value)}),e.addEventListener("change",n),t.addEventListener("change",o);const a=e=>{e.currentTarget.closest(".panel-block").remove(),l=!0,llm.licenceEdit.setUnsavedChangesFunction()},i=n=>{let o="";if(n)if(n instanceof Date)o=n.getFullYear().toString()+"-"+("00"+(n.getMonth()+1).toString()).slice(-2)+"-"+("00"+n.getDate().toString()).slice(-2);else if(n.constructor===String)o=n;else if(n instanceof Event)try{n.preventDefault();const e=n.currentTarget.dataset.source;o=document.querySelector("#"+e).value}catch(e){}d.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small input--eventDateString" name="eventDateString" type="date" value="'+cityssm.escapeHTML(o)+'" min="'+cityssm.escapeHTML(e.value)+'" max="'+cityssm.escapeHTML(t.value)+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');const i=d.querySelectorAll("a");i[i.length-1].addEventListener("click",a),l=!0,llm.licenceEdit.setUnsavedChangesFunction()},c=document.querySelector("#is-event-calculator-modal");document.querySelectorAll(".is-calculate-events-button")[0].addEventListener("click",()=>{const n=Number.parseInt(document.querySelector("#eventCalc--eventCount").value,10),o=Number.parseInt(document.querySelector("#eventCalc--dayInterval").value,10);let a=t.value.split("-");const s=new Date(Number.parseInt(a[0],10),Number.parseInt(a[1],10)-1,Number.parseInt(a[2],10));a=e.value.split("-");const l=new Date(Number.parseInt(a[0],10),Number.parseInt(a[1],10)-1,Number.parseInt(a[2],10));for(let e=0;e<n&&l.getTime()<=s.getTime();e+=1)i(l),l.setDate(l.getDate()+o);cityssm.hideModal(c)}),document.querySelector("#is-event-calculator-button").addEventListener("click",()=>{cityssm.showModal(c)});const s=c.querySelectorAll(".is-close-modal-button");for(const e of s)e.addEventListener("click",cityssm.hideModal);const r=document.querySelectorAll(".is-add-event-button");for(const e of r)e.addEventListener("click",i)}if(!i){const e=document.querySelector("#is-update-expected-licence-fee-button");e&&e.addEventListener("click",()=>{const t=document.querySelector("#licence--licenceFee");t.value=e.getAttribute("data-licence-fee-expected"),t.classList.remove("is-danger"),t.closest(".field").querySelector(".help").remove(),e.remove(),llm.licenceEdit.setUnsavedChangesFunction(),llm.licenceEdit.setDoRefreshAfterSaveFunction()}),document.querySelector("#is-add-transaction-button").addEventListener("click",()=>{let e;const n=n=>{n&&n.preventDefault(),cityssm.postJSON(t+"/licences/doAddTransaction",e,e=>{e.success&&window.location.reload()})};cityssm.openHtmlModal("licence-transactionAdd",{onshow(t){llm.getDefaultConfigProperty("externalReceiptNumber_fieldLabel",e=>{t.querySelector("label[for='transactionAdd--externalReceiptNumber']").textContent=e}),document.querySelector("#transactionAdd--licenceID").value=a;const o=Number.parseFloat(document.querySelector("#licence--licenceFee").value),i=document.querySelector("#licence--transactionTotal"),s=Number.parseFloat(i?i.textContent:"0");document.querySelector("#transactionAdd--licenceFee").textContent=o.toFixed(2),document.querySelector("#transactionAdd--transactionTotal").textContent=s.toFixed(2);const l=(o-s).toFixed(2);if(document.querySelector("#transactionAdd--discrepancy").textContent=l,document.querySelector("#transactionAdd--transactionAmount").value=l,(e=t.querySelector("form")).addEventListener("submit",n),!c){const e=document.querySelector("#is-add-transaction-issue-licence-button");e.classList.remove("is-hidden"),e.addEventListener("click",()=>{document.querySelector("#transactionAdd--issueLicence").value="true",n()})}}})});const n=document.querySelector("#is-void-transaction-button");n&&n.addEventListener("click",()=>{if(r)return void cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning");const e=(-1*Number.parseFloat(n.dataset.transactionAmount)).toFixed(2);cityssm.confirmModal("Void Transaction?","<strong>Are you sure you want to void this transaction?</strong><br />If the history of this transaction should be maintained, it may be preferred to create a new transaction for $ "+e+".","Void Transaction","warning",()=>{cityssm.postJSON(t+"/licences/doVoidTransaction",{licenceID:a,transactionIndex:n.dataset.transactionIndex},e=>{e.success&&window.location.reload()})})})}if(!i){const e=document.querySelector("#is-unissue-licence-button");if(e)e.addEventListener("click",()=>{cityssm.confirmModal("Unissue Licence?","Are you sure you want to unissue this lottery licence?","Yes, Unissue","danger",()=>{cityssm.postJSON(t+"/licences/doUnissueLicence",{licenceID:a},e=>{e.success&&window.location.reload()})})});else{const e=()=>{cityssm.postJSON(t+"/licences/doIssueLicence",{licenceID:a},e=>{e.success&&window.location.reload()})},n=()=>{r?cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning"):cityssm.confirmModal("Issue Licence?","Are you sure you want to issue this lottery licence?","Yes, Issue","success",e)};document.querySelector("#is-issue-licence-button").addEventListener("click",n),document.querySelector("#is-not-issued-tag").addEventListener("dblclick",n)}}})(),Object.defineProperty(exports,"__esModule",{value:!0}),null!==document.querySelector("#is-ticket-types-panel")){const e=null!==(_b=null===(_a=document.querySelector("main"))||void 0===_a?void 0:_a.dataset.urlPrefix)&&void 0!==_b?_b:"",t=document.querySelector("#form--licence"),n=""===document.querySelector("#licence--licenceID").value,o=document.querySelector("#is-ticket-types-panel"),a=document.querySelector("#licence--licenceTypeKey"),i=new Map;function loadTicketTypesCache(t){const n=a.value;i.has(n)?t(i.get(n)):cityssm.postJSON(`${e}/licences/doGetTicketTypes`,{licenceTypeKey:n},e=>{const o=e;i.set(n,o),t(o)})}const c=[];let s;const l=[];let r;function loadDistributorLocationsCache(e){0===c.length?llm.licenceEdit.loadLocationListFunction(t=>{s=new Map;for(const e of t)e.locationIsDistributor&&(c.push(e),s.set(e.locationID,e.locationDisplayName));e(c)}):e(c)}function loadManufacturerLocationsCache(e){0===l.length?llm.licenceEdit.loadLocationListFunction(t=>{r=new Map;for(const e of t)e.locationIsManufacturer&&(l.push(e),r.set(e.locationID,e.locationDisplayName));e(l)}):e(l)}const d=document.querySelector("#ticketTypesTabPanel--summary"),u=d.querySelector("tbody"),m=d.querySelector("tfoot"),p=document.querySelector("#ticketTypesTabPanel--log"),y=p.querySelector("tbody"),v=p.querySelector("tfoot");let f="",g="";if(y.querySelectorAll("tr").length>0){const e=y.querySelectorAll("tr").at(-1);f=e.dataset.distributorId,g=e.dataset.manufacturerId}function renderSummaryTable(){var e,t,n,o,a,i,c,s,l,r,d,p,f,g,h,S;const b=new Map,T=y.querySelectorAll("tr");for(const r of T){const d=null!==(e=r.dataset.ticketType)&&void 0!==e?e:"";let u=Number.parseInt(r.dataset.unitCount,10),m=Number.parseFloat(r.dataset.totalValue),p=Number.parseFloat(r.dataset.totalPrizes),y=Number.parseFloat(r.dataset.licenceFee);b.has(d)&&(u+=null!==(n=null===(t=b.get(d))||void 0===t?void 0:t.totalUnits)&&void 0!==n?n:0,m+=null!==(a=null===(o=b.get(d))||void 0===o?void 0:o.totalValue)&&void 0!==a?a:0,p+=null!==(c=null===(i=b.get(d))||void 0===i?void 0:i.totalPrizes)&&void 0!==c?c:0,y+=null!==(l=null===(s=b.get(d))||void 0===s?void 0:s.totalLicenceFee)&&void 0!==l?l:0),b.set(d,{totalUnits:u,totalValue:m,totalPrizes:p,totalLicenceFee:y})}const L=[];for(const e of b.keys())L.push(e);L.sort(),cityssm.clearElement(u);const k={totalUnits:0,totalValue:0,totalPrizes:0,totalLicenceFee:0};for(const e of L){const t=b.get(e);k.totalUnits+=null!==(r=null==t?void 0:t.totalUnits)&&void 0!==r?r:0,k.totalValue+=null!==(d=null==t?void 0:t.totalValue)&&void 0!==d?d:0,k.totalPrizes+=null!==(p=null==t?void 0:t.totalPrizes)&&void 0!==p?p:0,k.totalLicenceFee+=null!==(f=null==t?void 0:t.totalLicenceFee)&&void 0!==f?f:0;const n=document.createElement("tr");n.innerHTML=`<td>${cityssm.escapeHTML(e)}</td>\n        <td class="has-text-right">${null==t?void 0:t.totalUnits.toString()}</td>\n        <td class="has-text-right">${llm.formatDollarsAsHTML(null!==(g=null==t?void 0:t.totalValue)&&void 0!==g?g:0)}</td>\n        <td class="has-text-right">${llm.formatDollarsAsHTML(null!==(h=null==t?void 0:t.totalPrizes)&&void 0!==h?h:0)}</td>\n        <td class="has-text-right">${llm.formatDollarsAsHTML(null!==(S=null==t?void 0:t.totalLicenceFee)&&void 0!==S?S:0)}</td>`,u.append(n)}m.innerHTML=`<td></td>\n      <th class="has-text-right">${k.totalUnits.toString()}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalValue)}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalPrizes)}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalLicenceFee)}</th>`,v.innerHTML=`<td></td>\n      <td></td>\n      <th class="has-text-right">${k.totalUnits.toString()}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalValue)}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalPrizes)}</th>\n      <th class="has-text-right">${llm.formatDollarsAsHTML(k.totalLicenceFee)}</th>\n      <td></td>\n      <td class="is-hidden-print"></td>`,document.querySelector("#licence--totalPrizeValue").value=k.totalPrizes.toFixed(2)}function addLogTableRow(e){var t;const n=e.ticketType,o=e.unitCount,a=e.valuePerDeal,i=(a*o).toFixed(2),c=e.prizesPerDeal,l=(c*o).toFixed(2),d=e.licenceFee,u=document.createElement("tr");u.className="has-background-success-light",u.dataset.ticketTypeIndex="",u.dataset.ticketType=n,u.dataset.unitCount=o.toString(),u.dataset.totalValue=i.toString(),u.dataset.totalPrizes=l.toString(),u.dataset.licenceFee=e.licenceFee.toString(),u.insertAdjacentHTML("beforeend",'<td>\n        <input name="ticketType_ticketTypeIndex" type="hidden" value="" />\n        <input name="ticketType_amendmentDate" type="hidden" value="" />\n        <span>(New Record)</span>\n        </td>'),u.insertAdjacentHTML("beforeend",`<td>\n        <input name="ticketType_ticketType" type="hidden" value="${cityssm.escapeHTML(n)}" />\n        <span>${cityssm.escapeHTML(n)}</span>\n        </td>`),u.insertAdjacentHTML("beforeend",`<td class="has-text-right">\n        <input name="ticketType_unitCount" type="hidden" value="${o.toString()}" />\n        <span>${o.toString()}</span>\n        </td>`),u.insertAdjacentHTML("beforeend",`<td class="has-text-right is-nowrap">\n        <input class="is-total-value-per-deal" type="hidden" value="${i.toString()}" />\n        <span data-tooltip="$${a.toFixed(2)} value per deal">\n          $ ${i}\n        </span>\n        </td>`),u.insertAdjacentHTML("beforeend",`<td class="has-text-right is-nowrap">\n        <input class="is-total-prizes-per-deal" type="hidden" value="${l.toString()}" />\n        <span data-tooltip="$${c.toFixed(2)} prizes per deal">\n          $ ${l}\n        </span>\n        </td>`),u.insertAdjacentHTML("beforeend",`<td class="has-text-right is-nowrap">\n        <input class="is-licence-fee" name="ticketType_licenceFee" type="hidden" value="${d.toString()}" />\n        <span>$${d.toFixed(2)}</span>\n        </td>`);const m=r.get(e.manufacturerLocationID),p=s.get(e.distributorLocationID);f=e.distributorLocationID.toString(),g=e.manufacturerLocationID.toString(),u.insertAdjacentHTML("beforeend",`<td class="is-size-7">\n        <input name="ticketType_manufacturerLocationID" type="hidden"\n          value="${e.manufacturerLocationID.toString()}" />\n        <input name="ticketType_distributorLocationID" type="hidden"\n          value="${e.distributorLocationID.toString()}" />\n        <span>${cityssm.escapeHTML(m)}<span><br />\n        <span>${cityssm.escapeHTML(p)}<span></td>`),u.insertAdjacentHTML("beforeend",'<td class="is-hidden-print">\n        <button class="button is-small is-danger has-tooltip-left is-delete-ticket-type-button" data-tooltip="Delete Ticket Type" type="button">\n          <i class="fas fa-trash" aria-hidden="true"></i>\n          <span class="sr-only">Delete</span>\n        </button>\n        </td>'),null===(t=u.querySelector(".is-delete-ticket-type-button"))||void 0===t||t.addEventListener("click",deleteTicketTypeFunction_openConfirm),y.prepend(u),renderSummaryTable(),llm.licenceEdit.setUnsavedChangesFunction(),llm.licenceEdit.setDoRefreshAfterSaveFunction()}function deleteTicketTypeFunction_doDeleteTicketType(e){const o=e.dataset.ticketTypeIndex;e.remove(),n||t.insertAdjacentHTML("beforeend",`<input class="is-removed-after-save" name="ticketTypeIndex_toDelete" type="hidden"\n          value="${cityssm.escapeHTML(o)}" />`),renderSummaryTable(),llm.licenceEdit.setUnsavedChangesFunction(),llm.licenceEdit.setDoRefreshAfterSaveFunction()}function deleteTicketTypeFunction_openConfirm(e){const t=e.currentTarget.closest("tr"),n=t.dataset.ticketType;cityssm.confirmModal("Delete Ticket Type?",`Are you sure you want to remove the ${n} ticket type for this licence?`,"Yes, Delete","danger",()=>{deleteTicketTypeFunction_doDeleteTicketType(t)})}function addTicketType_openModal(e){const t={manufacturerLocationId:g,distributorLocationId:f,ticketType:"",unitCount:"1"};let n,o,a,i;"is-add-ticket-type-button"!==e.currentTarget.id&&(n=e.currentTarget.closest("tr"),t.manufacturerLocationId=n.dataset.manufacturerId,t.distributorLocationId=n.dataset.distributorId,t.ticketType=n.dataset.ticketType,t.unitCount=n.dataset.unitCount);const c=e=>{e.preventDefault(),addLogTableRow({ticketType:document.querySelector("#ticketTypeAdd--ticketType").value,unitCount:Number.parseInt(document.querySelector("#ticketTypeAdd--unitCount").value,10),valuePerDeal:Number.parseFloat(document.querySelector("#ticketTypeAdd--valuePerDeal").value),prizesPerDeal:Number.parseFloat(document.querySelector("#ticketTypeAdd--prizesPerDeal").value),licenceFee:Number.parseFloat(document.querySelector("#ticketTypeAdd--licenceFee").value),distributorLocationID:Number.parseInt(document.querySelector("#ticketTypeAdd--distributorLocationID").value,10),manufacturerLocationID:Number.parseInt(document.querySelector("#ticketTypeAdd--manufacturerLocationID").value,10)}),n&&deleteTicketTypeFunction_doDeleteTicketType(n),o()},s=()=>{const e=Number.parseInt(i.value,10);document.querySelector("#ticketTypeAdd--prizesTotal").value=(Number.parseFloat(document.querySelector("#ticketTypeAdd--prizesPerDeal").value)*e).toFixed(2),document.querySelector("#ticketTypeAdd--licenceFee").value=(Number.parseFloat(document.querySelector("#ticketTypeAdd--feePerUnit").value)*e).toFixed(2)},l=()=>{const e=a.selectedOptions[0];document.querySelector("#ticketTypeAdd--ticketPrice").value=e.dataset.ticketPrice,document.querySelector("#ticketTypeAdd--ticketCount").value=e.dataset.ticketCount,document.querySelector("#ticketTypeAdd--valuePerDeal").value=(Number.parseFloat(e.dataset.ticketPrice)*Number.parseInt(e.dataset.ticketCount,10)).toFixed(2),document.querySelector("#ticketTypeAdd--prizesPerDeal").value=e.dataset.prizesPerDeal,document.querySelector("#ticketTypeAdd--feePerUnit").value=e.dataset.feePerUnit,s()};cityssm.openHtmlModal("licence-ticketTypeAdd",{onshow(e){var r,d;a=e.querySelector("#ticketTypeAdd--ticketType"),i=e.querySelector("#ticketTypeAdd--unitCount"),loadDistributorLocationsCache(e=>{const n=document.querySelector("#ticketTypeAdd--distributorLocationID");n.innerHTML='<option value="">(No Distributor)</option>';for(const t of e)n.insertAdjacentHTML("beforeend",`<option value="${cityssm.escapeHTML(t.locationID.toString())}">\n              ${cityssm.escapeHTML(t.locationDisplayName)}\n              </option>`);""!==t.distributorLocationId&&null!==n.querySelector(`[value='${f}']`)&&(n.value=t.distributorLocationId)}),loadManufacturerLocationsCache(e=>{const n=document.querySelector("#ticketTypeAdd--manufacturerLocationID");n.innerHTML='<option value="">(No Manufacturer)</option>';for(const t of e)n.insertAdjacentHTML("beforeend",`<option value="${cityssm.escapeHTML(t.locationID.toString())}">\n              ${cityssm.escapeHTML(t.locationDisplayName)}\n              </option>`);""!==t.manufacturerLocationId&&null!==n.querySelector(`[value='${g}']`)&&(n.value=t.manufacturerLocationId)}),loadTicketTypesCache(e=>{if(!e||0===e.length)return o(),void cityssm.alertModal("No ticket types available","","OK","danger");a.innerHTML="";for(const t of e){const e=document.createElement("option");e.dataset.ticketPrice=t.ticketPrice.toFixed(2),e.dataset.ticketCount=t.ticketCount.toString(),e.dataset.prizesPerDeal=t.prizesPerDeal.toFixed(2),e.dataset.feePerUnit=(t.feePerUnit||0).toFixed(2),e.value=t.ticketType,e.textContent=t.ticketType+" ("+t.ticketCount.toString()+" tickets, $"+t.ticketPrice.toFixed(2)+" each)",a.append(e)}""!==t.ticketType&&(a.value=t.ticketType),l()}),""!==t.unitCount&&(i.value=t.unitCount,s()),n&&(e.querySelector(".modal-card-title").textContent="Edit a Ticket Type",null===(r=e.querySelector(".modal-card-body"))||void 0===r||r.insertAdjacentHTML("afterbegin",'<div class="message is-warning">\n              <p class="message-body">\n                Note that editing ticket type records can negatively impact your historical reporting.\n              </p>\n              </div>'),e.querySelector(".modal-card-foot .button[type='submit']").innerHTML='<span class="icon"><i class="fas fa-save" aria-hidden="true"></i></span>\n              <span>Edit Ticket Type</span>'),a.addEventListener("change",l),i.addEventListener("change",s),null===(d=e.querySelector("form"))||void 0===d||d.addEventListener("submit",c)},onshown(e,t){bulmaJS.toggleHtmlClipped(),o=t},onremoved(){bulmaJS.toggleHtmlClipped()}})}renderSummaryTable(),null===(_c=document.querySelector("#is-add-ticket-type-button"))||void 0===_c||_c.addEventListener("click",addTicketType_openModal);const h=o.querySelectorAll(".is-edit-ticket-type-button");for(const e of h)e.addEventListener("click",addTicketType_openModal);const S=o.querySelectorAll(".is-delete-ticket-type-button");for(const e of S)e.addEventListener("click",deleteTicketTypeFunction_openConfirm)}