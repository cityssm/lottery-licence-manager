(function(){function n(a){window.llm.enableNavBlocker();r.innerHTML='<div class="has-text-info"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Unsaved Changes</div>';k&&a&&"number"===a.currentTarget.type&&(k.getElementsByTagName("fieldset")[0].setAttribute("disabled","disabled"),p=!0)}function C(a){a.preventDefault();a=a.currentTarget;document.getElementById("licence--organizationID").value=a.getAttribute("data-organization-id");document.getElementById("licence--organizationName").value=
a.getAttribute("data-organization-name");window.llm.hideModal(a);n()}function y(){var a=document.createElement("div");a.className="list is-hoverable";for(var c=t.value.trim().toLowerCase().split(" "),b=10,e=0;e<q.length&&0<b;e+=1){for(var g=!0,d=q[e],h=d.OrganizationName.toLowerCase(),f=0;f<c.length;f+=1)if(-1===h.indexOf(c[f])){g=!1;break}g&&(--b,g=document.createElement("a"),g.className="list-item",g.setAttribute("data-organization-id",d.OrganizationID),g.setAttribute("data-organization-name",d.OrganizationName),
g.innerText=d.OrganizationName,g.addEventListener("click",C),a.insertAdjacentElement("beforeend",g))}window.llm.clearElement(z);z.insertAdjacentElement("beforeend",a)}function D(a){a.currentTarget.closest(".field").remove();p=!0;n()}function A(a){var c="";a&&a instanceof Date&&(c=a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2));l.insertAdjacentHTML("beforeend",'<div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+
c+'" min="'+m.value+'" max="'+h.value+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div>');a=l.getElementsByTagName("a");a[a.length-1].addEventListener("click",D);p=!0;n()}var u=document.getElementById("form--licence"),r=document.getElementById("container--form-message"),
v=document.getElementById("licence--licenceID").value,w=""===v,k=document.getElementById("form--licenceFee"),p=!1,l=document.getElementById("container--events");u.addEventListener("submit",function(a){a.preventDefault();0===l.getElementsByTagName("input").length?window.llm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning"):(r.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',window.fetch("/licences/doSave",{method:"post",
credentials:"include",body:new URLSearchParams(new FormData(u))}).then(function(a){return a.json()}).then(function(a){a.success&&window.llm.disableNavBlocker();a.success&&w?window.location.href="/licences/"+a.licenceID+"/edit":a.success&&p?window.location.reload(!0):(r.innerHTML="",window.llm.alertModal(a.message,"","OK",a.success?"success":"danger"))}))});w||document.getElementsByClassName("is-delete-button")[0].addEventListener("click",function(a){a.preventDefault();window.llm.confirmModal("Delete Licence?",
"Are you sure you want to delete this licence?","Yes, Delete","danger",function(){window.fetch("/licences/doDelete",{method:"post",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenceID:v})}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.href="/licences")})})});for(var d=u.querySelectorAll("input, select, textarea"),e=0;e<d.length;e+=1)""!==d[e].name&&d[e].addEventListener("change",n);var q=
[],B=document.getElementsByClassName("is-organization-lookup-modal")[0],t=document.getElementById("organizationLookup--searchStr"),z=document.getElementById("container--organizationLookup");t.addEventListener("keyup",y);document.getElementsByClassName("is-organization-lookup-button")[0].addEventListener("click",function(){0===q.length&&window.fetch("/organizations/doGetAll",{method:"get",credentials:"include"}).then(function(a){return a.json()}).then(function(a){q=a;t.removeAttribute("disabled");
y()});window.llm.showModal(B)});d=B.getElementsByClassName("is-cancel-button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",window.llm.hideModal);document.getElementById("licence--municipality").addEventListener("change",function(a){window.fetch("/licences/doGetDistinctLocations",{method:"POST",credentials:"include",body:JSON.stringify({municipality:a.currentTarget.value}),headers:{"Content-Type":"application/json"}}).then(function(a){return a.json()}).then(function(a){var b=document.getElementById("datalist--licence--location");
b.innerHTML="";for(var c=0;c<a.length;c+=1){var d=document.createElement("option");d.value=a[c];b.insertAdjacentElement("beforeend",d)}})});var d=document.getElementById("licence--licenceTypeKey"),f=document.getElementsByClassName("container-licenceTypeFields");d.addEventListener("change",function(a){a="container-licenceTypeFields--"+a.currentTarget.value;for(var c=0;c<f.length;c+=1)f[c].id===a?(f[c].removeAttribute("disabled"),f[c].classList.remove("is-hidden")):(f[c].classList.add("is-hidden"),
f[c].setAttribute("disabled","disabled"))});var m=document.getElementById("licence--startDateString"),h=document.getElementById("licence--endDateString");document.getElementById("licence--applicationDateString").addEventListener("change",function(a){m.setAttribute("min",a.currentTarget.value)});m.addEventListener("change",function(){var a=m.value;h.setAttribute("min",a);h.value<a&&(h.value=a);for(var c=l.getElementsByTagName("input"),b=0;b<c.length;b+=1)c[b].setAttribute("min",a)});h.addEventListener("change",
function(){for(var a=h.value,c=l.getElementsByTagName("input"),b=0;b<c.length;b+=1)c[b].setAttribute("max",a)});var x=document.getElementsByClassName("is-event-calculator-modal")[0];document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",function(){for(var a=parseInt(document.getElementById("eventCalc--eventCount").value),c=parseInt(document.getElementById("eventCalc--dayInterval").value),b=h.value.split("-"),d=new Date(b[0],parseInt(b[1])-1,b[2]),b=m.value.split("-"),
b=new Date(b[0],parseInt(b[1])-1,b[2]),e=0;e<a&&b.getTime()<=d.getTime();e+=1)A(b),b.setDate(b.getDate()+c);window.llm.hideModal(x)});document.getElementsByClassName("is-event-calculator-button")[0].addEventListener("click",function(){window.llm.showModal(x)});d=x.getElementsByClassName("is-cancel-button");for(e=0;e<d.length;e+=1)d[e].addEventListener("click",window.llm.hideModal);document.getElementsByClassName("is-add-event-button")[0].addEventListener("click",A);if(!w)if(k){var E=function(){window.fetch("/licences/doMarkLicenceFeePaid",
{method:"POST",credentials:"include",body:new URLSearchParams(new FormData(k))}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.reload(!0))})};k.addEventListener("submit",function(a){a.preventDefault();window.llm.confirmModal("Mark Fee as Paid?","Are you sure you want to mark the licence fee as paid?","Yes, Paid","info",E)})}else{var F=function(){window.fetch("/licences/doRemoveLicenceFee",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},
body:JSON.stringify({licenceID:v})}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.reload(!0))})};document.getElementsByClassName("is-remove-licence-fee-button")[0].addEventListener("click",function(){window.llm.confirmModal("Remove Fee Payment?","Are you sure you want to remove the fee payment and change the licence to unpaid?","Yes, Remove Payment","danger",F)})}})();
