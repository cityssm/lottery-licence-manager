var $jscomp={scope:{},checkStringArgs:function(d,k,h){if(null==d)throw new TypeError("The 'this' value for String.prototype."+h+" must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype."+h+" must not be a regular expression");return d+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,k,h){if(h.get||h.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[k]=h.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,k,h,m){if(k){h=$jscomp.global;d=d.split(".");for(m=0;m<d.length-1;m++){var l=d[m];l in h||(h[l]={});h=h[l]}d=d[d.length-1];m=h[d];k=k(m);k!=m&&null!=k&&$jscomp.defineProperty(h,d,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("String.prototype.includes",function(d){return d?d:function(d,h){return-1!==$jscomp.checkStringArgs(this,d,"includes").indexOf(d,h||0)}},"es6-impl","es3");
$jscomp.findInternal=function(d,k,h){d instanceof String&&(d=String(d));for(var m=d.length,l=0;l<m;l++){var n=d[l];if(k.call(h,n,l,d))return{i:l,v:n}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,h){return $jscomp.findInternal(this,d,h).v}},"es6-impl","es3");
(function(){function d(a){cityssm.enableNavBlocker();C=!0;m.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>';n||(document.getElementById("is-add-transaction-button").setAttribute("disabled","disabled"),document.getElementById("is-disabled-transaction-message").classList.remove("is-hidden"));a&&aa.includes(a.currentTarget.type)&&(r=!0)}function k(a){0===q.length?cityssm.postJSON("/locations/doGetLocations",
null,function(b){q=b.locations;a()}):a()}var h=document.getElementById("form--licence"),m=document.getElementById("container--form-message"),l=document.getElementById("licence--licenceID").value,n=""===l,ba="true"===h.getAttribute("data-licence-is-issued"),aa=["number","date","time"],r=!1,C=!1,z=document.getElementById("container--events");h.addEventListener("submit",function(a){a.preventDefault();0===z.getElementsByTagName("input").length?cityssm.alertModal("Event Date Error","Please ensure there is at least one event date.",
"OK","warning"):(m.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON("/licences/doSave",h,function(a){a.success&&(cityssm.disableNavBlocker(),C=!1);if(a.success&&n)window.location.href="/licences/"+a.licenceID+"/edit";else if(a.success&&r)window.location.reload(!0);else{m.innerHTML="";cityssm.alertModal(a.message,"","OK",a.success?"success":"danger");a=document.getElementsByClassName("is-removed-after-save");for(var b=0;b<a.length;b+=1)a[b].remove()}}))});
n||document.getElementById("is-delete-licence-button").addEventListener("click",function(a){a.preventDefault();cityssm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",function(){cityssm.postJSON("/licences/doDelete",{licenceID:l},function(a){a.success&&(cityssm.disableNavBlocker(),window.location.href="/licences")})})});for(var e=h.querySelectorAll("input, select, textarea"),g=0;g<e.length;g+=1)""!==e[g].name&&
e[g].addEventListener("change",d);(e=document.getElementById("is-external-licence-number-unlock-button"))&&e.addEventListener("click",function(){var a=document.getElementById("licence--externalLicenceNumber");a.classList.remove("is-readonly");a.removeAttribute("readonly");a.focus()});var D=[],P,t,I,ca=function(a){a.preventDefault();a=a.currentTarget;document.getElementById("licence--organizationID").value=a.getAttribute("data-organization-id");document.getElementById("licence--organizationName").value=
a.getAttribute("data-organization-name");P();d()},J=function(){var a=document.createElement("div");a.className="list is-hoverable";for(var b=t.value.trim().toLowerCase().split(" "),c=10,E=0;E<D.length&&0<c;E+=1){var f=!0,d=D[E];if(d.isEligibleForLicences){for(var e=d.organizationName.toLowerCase(),u=0;u<b.length;u+=1)if(-1===e.indexOf(b[u])){f=!1;break}f&&(--c,f=document.createElement("a"),f.className="list-item",f.setAttribute("data-organization-id",d.organizationID),f.setAttribute("data-organization-name",
d.organizationName),f.setAttribute("href","#"),f.innerHTML=d.organizationName+'<br /><span class="is-size-7"><span class="icon"><i class="fas fa-user" aria-hidden="true"></i></span> '+d.representativeName+"</span>",f.addEventListener("click",ca),a.appendChild(f))}}cityssm.clearElement(I);I.insertAdjacentElement("beforeend",a)},e=function(){cityssm.openHtmlModal("licence-organizationLookup",{onshow:function(){t=document.getElementById("organizationLookup--searchStr");t.addEventListener("keyup",J);
I=document.getElementById("container--organizationLookup");0===D.length?cityssm.postJSON("/organizations/doGetAll",null,function(a){D=a;t.removeAttribute("disabled");J();t.focus()}):(t.removeAttribute("disabled"),J(),t.focus())},onshown:function(a,b){P=b;t.focus()},onremoved:function(){document.getElementById("is-organization-lookup-button").focus()}})};document.getElementById("is-organization-lookup-button").addEventListener("click",e);document.getElementById("licence--organizationName").addEventListener("dblclick",
e);var q=[],K,w,L,Q=function(a,b){document.getElementById("licence--locationID").value=a;document.getElementById("licence--locationDisplayName").value=b},da=function(a){a.preventDefault();a=a.currentTarget;Q(a.getAttribute("data-location-id"),a.getAttribute("data-location-display-name"));K();d()},R=function(){var a=document.createElement("div");a.className="list is-hoverable";for(var b=w.value.trim().toLowerCase().split(" "),c=10,d=0;d<q.length&&0<c;d+=1){for(var f=!0,e=q[d],g=e.locationName.toLowerCase(),
u=0;u<b.length;u+=1)if(-1===g.indexOf(b[u])){f=!1;break}f&&(--c,f=document.createElement("a"),f.className="list-item",f.setAttribute("data-location-id",e.locationID),f.setAttribute("data-location-display-name",e.locationDisplayName),f.setAttribute("href","#"),f.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(e.locationDisplayName)+"</div>"+(""===e.locationName?"":'<div class="column">'+
cityssm.escapeHTML(e.locationAddress1)+"</div>")+"</div>",f.addEventListener("click",da),a.insertAdjacentElement("beforeend",f))}cityssm.clearElement(L);L.insertAdjacentElement("beforeend",a)},e=function(){cityssm.openHtmlModal("licence-locationLookup",{onshow:function(a){w=document.getElementById("locationLookup--searchStr");w.addEventListener("keyup",R);L=document.getElementById("container--locationLookup");k(function(){w.removeAttribute("disabled");R();w.focus()});llm.getDefaultConfigProperty("city",
function(a){a&&(document.getElementById("newLocation--locationCity").value=a)});llm.getDefaultConfigProperty("province",function(a){a&&(document.getElementById("newLocation--locationProvince").value=a)});document.getElementById("form--newLocation").addEventListener("submit",function(a){a.preventDefault();cityssm.postJSON("/locations/doCreate",a.currentTarget,function(a){a.success&&(q=[],Q(a.locationID,a.locationDisplayName),K())})});llm.initializeTabs(a.querySelector(".tabs ul"))},onshown:function(a,
b){K=b;w.focus()},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",e);document.getElementById("licence--locationDisplayName").addEventListener("dblclick",e);var x=[],M=document.getElementById("is-termsConditions-lookup-modal"),A=document.getElementById("container--termsConditionsPrevious"),ea=function(a){a.preventDefault();a=parseInt(a.currentTarget.getAttribute("data-terms-conditions-index"));
var b=document.getElementById("licence--termsConditions");b.value=x[a].termsConditions;cityssm.hideModal(M);b.focus();d()};document.getElementById("is-termsConditions-lookup-button").addEventListener("click",function(){x=[];cityssm.clearElement(A);var a=document.getElementById("licence--organizationID").value;""===a?cityssm.alertModal("No Organization Selected","An organization must be selected before the previously used terms and conditions can be retrieved.","OK","warning"):(A.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Loading previously used terms and conditions...</p>',
cityssm.postJSON("/licences/doGetDistinctTermsConditions",{organizationID:a},function(a){x=a;if(0===x.length)A.innerHTML='<p class="has-text-centered">No previously used terms and conditions found for this organization.</p>';else{a=document.createElement("div");a.className="list is-hoverable has-margin-bottom-10";for(var b=0;b<x.length;b+=1){var d=x[b],f=document.createElement("a");f.className="list-item";f.setAttribute("data-terms-conditions-index",b);f.innerHTML='<p class="has-newline-chars">'+
cityssm.escapeHTML(d.termsConditions)+'</p><p class="has-text-right">'+(1<d.termsConditionsCount?'<span class="tag is-light">Used '+d.termsConditionsCount+" times</span>":"")+'<span class="tag is-info has-tooltip-left" data-tooltip="Most Recent Licence Start Date">'+d.startDateMaxString+"</span></p>";f.addEventListener("click",ea);a.insertAdjacentElement("beforeend",f)}cityssm.clearElement(A);A.insertAdjacentElement("beforeend",a)}}),cityssm.showModal(M))});e=M.getElementsByClassName("is-close-modal-button");
for(g=0;g<e.length;g+=1)e[g].addEventListener("click",cityssm.hideModal);var S=document.getElementById("licence--licenceTypeKey");if(n){var y=document.getElementsByClassName("container-licenceTypeFields");S.addEventListener("change",function(a){var b=a.currentTarget.selectedOptions[0],c=b.getAttribute("data-total-prize-value-max");document.getElementById("licence--totalPrizeValue").setAttribute("max",c);c="true"===b.getAttribute("data-has-ticket-types");b=document.getElementById("licence--totalPrizeValue");
c?(document.getElementById("is-ticket-types-panel").classList.remove("is-hidden"),b.setAttribute("readonly","readonly"),b.classList.add("is-readonly")):(c=document.getElementById("is-ticket-types-panel"),c.classList.add("is-hidden"),cityssm.clearElement(c.getElementsByTagName("tbody")[0]),cityssm.clearElement(c.getElementsByTagName("tfoot")[0]),b.removeAttribute("readonly"),b.classList.remove("is-readonly"));a="container-licenceTypeFields--"+a.currentTarget.value;for(b=0;b<y.length;b+=1)y[b].id===
a?(y[b].removeAttribute("disabled"),y[b].classList.remove("is-hidden")):(y[b].classList.add("is-hidden"),y[b].setAttribute("disabled","disabled"))})}var B=document.getElementById("licence--startDateString"),v=document.getElementById("licence--endDateString");document.getElementById("licence--applicationDateString").addEventListener("change",function(a){B.setAttribute("min",a.currentTarget.value)});B.addEventListener("change",function(){var a=B.value;v.setAttribute("min",a);v.value<a&&(v.value=a);
for(var b=z.getElementsByTagName("input"),c=0;c<b.length;c+=1)b[c].setAttribute("min",a)});v.addEventListener("change",function(){for(var a=v.value,b=z.getElementsByTagName("input"),c=0;c<b.length;c+=1)b[c].setAttribute("max",a)});var fa=function(a){a.currentTarget.closest(".panel-block").remove();r=!0;d()},T=function(a){var b="";if(a)if(a instanceof Date)b=a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2);else if(a.constructor===String)b=a;else if(a instanceof
Object)try{a.preventDefault();var c=a.currentTarget.getAttribute("data-source"),b=document.getElementById(c).value}catch(E){}z.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons">'+('<div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+b+'" min="'+B.value+'" max="'+v.value+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div>')+'<div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');
a=z.getElementsByTagName("a");a[a.length-1].addEventListener("click",fa);r=!0;d()},N=document.getElementById("is-event-calculator-modal");document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",function(){for(var a=parseInt(document.getElementById("eventCalc--eventCount").value),b=parseInt(document.getElementById("eventCalc--dayInterval").value),c=v.value.split("-"),d=new Date(c[0],parseInt(c[1])-1,c[2]),c=B.value.split("-"),c=new Date(c[0],parseInt(c[1])-1,c[2]),
f=0;f<a&&c.getTime()<=d.getTime();f+=1)T(c),c.setDate(c.getDate()+b);cityssm.hideModal(N)});document.getElementById("is-event-calculator-button").addEventListener("click",function(){cityssm.showModal(N)});e=N.getElementsByClassName("is-close-modal-button");for(g=0;g<e.length;g+=1)e[g].addEventListener("click",cityssm.hideModal);e=document.getElementsByClassName("is-add-event-button");for(g=0;g<e.length;g+=1)e[g].addEventListener("click",T);var p=document.getElementById("is-ticket-types-panel");if(p){var O=
{},U=function(a){var b=S.value;b in O?a(O[b]):cityssm.postJSON("/licences/doGetTicketTypes",{licenceTypeKey:b},function(c){O[b]=c;a(c)})},F=function(){for(var a=0,b=p.getElementsByClassName("is-total-prizes-per-deal"),c=0;c<b.length;c+=1)a+=parseFloat(b[c].value);for(var b=0,c=p.getElementsByClassName("is-licence-fee"),d=0;d<c.length;d+=1)b+=parseFloat(c[d].value);p.getElementsByTagName("tfoot")[0].innerHTML='<tr><td></td><td></td><td></td><th class="has-text-right is-nowrap">$ '+a.toFixed(2)+'</th><td class="is-hidden-print"></td><th class="has-text-right is-nowrap">$ '+
b.toFixed(2)+'</th><td></td><td class="is-hidden-print"></td><td></td><td class="is-hidden-print"></td></tr>';document.getElementById("licence--totalPrizeValue").value=a},V,W=function(a){var b=a.currentTarget.closest("tr"),c=b.getAttribute("data-ticket-type");cityssm.confirmModal("Delete Ticket Type?","Are you sure you want to remove the "+c+" ticket type for this licence?","Yes, Delete","danger",function(){b.remove();if(!n){var a=h.querySelector("input[name='ticketType_toAdd'][value='"+c+"']");a?
a.remove():h.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketType_toDelete" type="hidden" value="'+c+'" />')}F();d();r=!0})},X=function(a){var b=a.currentTarget.closest("tr"),c=b.getAttribute("data-ticket-type"),e,f,g=function(a){a.preventDefault();a=document.getElementById("amendUnit_unitCount").value;var c=b.querySelector("input[name='ticketType_unitCount']");c.value=a;c.nextElementSibling.innerText=a;c=b.getElementsByClassName("is-total-value-per-deal")[0];c.value=
(e.ticketPrice*e.ticketCount*a).toFixed(2);c.nextElementSibling.innerText="$ "+(e.ticketPrice*e.ticketCount*a).toFixed(2);c=b.getElementsByClassName("is-total-prizes-per-deal")[0];c.value=(e.prizesPerDeal*a).toFixed(2);c.nextElementSibling.innerText="$ "+(e.prizesPerDeal*a).toFixed(2);a=document.getElementById("amendUnit_licenceFee").value;c=b.querySelector("input[name='ticketType_licenceFee']");c.value=a;c.nextElementSibling.innerText="$ "+a;f();F();d();r=!0},h=function(){document.getElementById("amendUnit_licenceFee").value=
(e.feePerUnit*document.getElementById("amendUnit_unitCount").value).toFixed(2)};cityssm.openHtmlModal("licence-ticketTypeUnitAmend",{onshow:function(a){document.getElementById("amendUnit_ticketType").value=c;var d=b.querySelector("input[name='ticketType_unitCount']").value;document.getElementById("amendUnit_unitCountCurrent").value=d;var f=document.getElementById("amendUnit_unitCount");f.value=d;U(function(a){e=a.find(function(a){return a.ticketType===c});f.addEventListener("change",h);h()});a.getElementsByTagName("form")[0].addEventListener("submit",
g)},onshown:function(a,b){f=b}})},Y=function(a){var b,c=a.currentTarget.closest("td").previousElementSibling,e=function(a){c.getElementsByTagName("input")[0].value=a.currentTarget.getAttribute("data-location-id");c.getElementsByTagName("span")[0].innerText=a.currentTarget.getAttribute("data-location-display-name");b();d()};cityssm.openHtmlModal("licence-distributorLookup",{onshow:function(){k(function(){var a=document.createElement("div");a.className="list is-hoverable";for(var b=0;b<q.length;b+=
1){var c=q[b];if(c.locationIsDistributor){var d=document.createElement("a");d.className="list-item";d.setAttribute("data-location-id",c.locationID);d.setAttribute("data-location-display-name",c.locationDisplayName);d.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(c.locationDisplayName)+"</div>"+(""===c.locationName?"":'<div class="column">'+cityssm.escapeHTML(c.locationAddress1)+"</div>")+
"</div>";d.addEventListener("click",e);a.insertAdjacentElement("beforeend",d)}}b=document.getElementById("container--distributorLookup");cityssm.clearElement(b);b.insertAdjacentElement("beforeend",a)})},onshown:function(a,c){b=c}})},Z=function(a){var b,c=a.currentTarget.closest("td").previousElementSibling,e=function(a){c.getElementsByTagName("input")[0].value=a.currentTarget.getAttribute("data-location-id");c.getElementsByTagName("span")[0].innerText=a.currentTarget.getAttribute("data-location-display-name");
b();d()};cityssm.openHtmlModal("licence-manufacturerLookup",{onshow:function(){k(function(){var a=document.createElement("div");a.className="list is-hoverable";for(var b=0;b<q.length;b+=1){var c=q[b];if(c.locationIsManufacturer){var d=document.createElement("a");d.className="list-item";d.setAttribute("data-location-id",c.locationID);d.setAttribute("data-location-display-name",c.locationDisplayName);d.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+
cityssm.escapeHTML(c.locationDisplayName)+"</div>"+(""===c.locationName?"":'<div class="column">'+cityssm.escapeHTML(c.locationAddress1)+"</div>")+"</div>";d.addEventListener("click",e);a.insertAdjacentElement("beforeend",d)}}b=document.getElementById("container--manufacturerLookup");cityssm.clearElement(b);b.insertAdjacentElement("beforeend",a)})},onshown:function(a,c){b=c}})};V=function(a){var b=a.ticketType,c=document.createElement("tr");c.setAttribute("data-ticket-type",b);c.insertAdjacentHTML("beforeend",
'<td><input name="ticketType_ticketType" type="hidden" value="'+b+'" /><span>'+b+"</span></td>");b=a.unitCount;c.insertAdjacentHTML("beforeend",'<td class="has-text-right"><input name="ticketType_unitCount" type="hidden" value="'+b+'" /><span>'+b+"</span></td>");var e=a.valuePerDeal,f=(e*b).toFixed(2);c.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><span data-tooltip="$'+e+' value per deal">$ '+f+"</span></td>");e=a.prizesPerDeal;b=(e*b).toFixed(2);c.insertAdjacentHTML("beforeend",
'<td class="has-text-right is-nowrap"><input class="is-total-prizes-per-deal" type="hidden" value="'+b+'" /><span data-tooltip="$'+e+' prizes per deal">$ '+b+"</span></td>");c.insertAdjacentHTML("beforeend",'<td class="is-hidden-print"><div class="field has-addons"><div class="control"><button class="button is-small is-amend-ticket-type-unit-count-button" data-tooltip="Amend Units" type="button">Amend</button></div><div class="control"><button class="button is-small is-danger is-delete-ticket-type-button" data-tooltip="Delete Ticket Type" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div></td>');
c.getElementsByClassName("is-amend-ticket-type-unit-count-button")[0].addEventListener("click",X);c.getElementsByClassName("is-delete-ticket-type-button")[0].addEventListener("click",W);a=a.licenceFee;c.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-licence-fee" name="ticketType_licenceFee" type="hidden" value="'+a+'" /><span>$ '+a+"</span></td>");c.insertAdjacentHTML("beforeend",'<td><input name="ticketType_manufacturerLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>');
c.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-manufacturer-button" data-tooltip="Change Manufacturer" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Manufacturer</span></button></td>');c.getElementsByClassName("is-amend-ticket-type-manufacturer-button")[0].addEventListener("click",Z);c.insertAdjacentHTML("beforeend",'<td><input name="ticketType_distributorLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>');
c.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-distributor-button" data-tooltip="Change Distributor" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Distributor</span></button></td>');c.getElementsByClassName("is-amend-ticket-type-distributor-button")[0].addEventListener("click",Y);p.getElementsByTagName("tbody")[0].insertAdjacentElement("afterbegin",c);F();d();r=!0};F();
document.getElementById("is-add-ticket-type-button").addEventListener("click",function(){var a,b,c,d=function(b){b.preventDefault();V({ticketType:document.getElementById("ticketTypeAdd--ticketType").value,unitCount:document.getElementById("ticketTypeAdd--unitCount").value,valuePerDeal:document.getElementById("ticketTypeAdd--valuePerDeal").value,prizesPerDeal:document.getElementById("ticketTypeAdd--prizesPerDeal").value,licenceFee:document.getElementById("ticketTypeAdd--licenceFee").value});n||h.insertAdjacentHTML("beforeend",
'<input class="is-removed-after-save" name="ticketType_toAdd" type="hidden" value="'+document.getElementById("ticketTypeAdd--ticketType").value+'" />');a()},e=function(){var a=c.value;document.getElementById("ticketTypeAdd--prizesTotal").value=(document.getElementById("ticketTypeAdd--prizesPerDeal").value*a).toFixed(2);document.getElementById("ticketTypeAdd--licenceFee").value=(document.getElementById("ticketTypeAdd--feePerUnit").value*a).toFixed(2)},g=function(){var a=b.selectedOptions[0];document.getElementById("ticketTypeAdd--ticketPrice").value=
a.getAttribute("data-ticket-price");document.getElementById("ticketTypeAdd--ticketCount").value=a.getAttribute("data-ticket-count");document.getElementById("ticketTypeAdd--valuePerDeal").value=(a.getAttribute("data-ticket-price")*a.getAttribute("data-ticket-count")).toFixed(2);document.getElementById("ticketTypeAdd--prizesPerDeal").value=a.getAttribute("data-prizes-per-deal");document.getElementById("ticketTypeAdd--feePerUnit").value=a.getAttribute("data-fee-per-unit");e()},k=function(c){if(c&&0!==
c.length){for(var d=0;d<c.length;d+=1){var e=c[d];if(!p.querySelector("tr[data-ticket-type='"+e.ticketType+"']")){var f=document.createElement("option");f.setAttribute("data-ticket-price",e.ticketPrice.toFixed(2));f.setAttribute("data-ticket-count",e.ticketCount);f.setAttribute("data-prizes-per-deal",e.prizesPerDeal.toFixed(2));f.setAttribute("data-fee-per-unit",(e.feePerUnit||0).toFixed(2));f.value=e.ticketType;f.innerText=e.ticketType+" ("+e.ticketCount+" tickets, $"+e.ticketPrice.toFixed(2)+" each)";
b.insertAdjacentElement("beforeend",f)}}g()}else a(),cityssm.alertModal("No ticket types available","","OK","danger")};cityssm.openHtmlModal("licence-ticketTypeAdd",{onshow:function(a){b=document.getElementById("ticketTypeAdd--ticketType");b.addEventListener("change",g);c=document.getElementById("ticketTypeAdd--unitCount");c.addEventListener("change",e);a.getElementsByTagName("form")[0].addEventListener("submit",d)},onshown:function(b,c){a=c;U(k)}})});e=p.getElementsByClassName("is-amend-ticket-type-unit-count-button");
for(g=0;g<e.length;g+=1)e[g].addEventListener("click",X);e=p.getElementsByClassName("is-delete-ticket-type-button");for(g=0;g<e.length;g+=1)e[g].addEventListener("click",W);e=p.getElementsByClassName("is-amend-ticket-type-distributor-button");for(g=0;g<e.length;g+=1)e[g].addEventListener("click",Y);e=p.getElementsByClassName("is-amend-ticket-type-manufacturer-button");for(g=0;g<e.length;g+=1)e[g].addEventListener("click",Z)}if(!n){var G=document.getElementById("is-update-expected-licence-fee-button");
G&&G.addEventListener("click",function(){var a=document.getElementById("licence--licenceFee");a.value=G.getAttribute("data-licence-fee-expected");a.classList.remove("is-danger");a.closest(".field").getElementsByClassName("help")[0].remove();G.remove();d();r=!0});document.getElementById("is-add-transaction-button").addEventListener("click",function(){var a,b=function(b){b&&b.preventDefault();cityssm.postJSON("/licences/doAddTransaction",a,function(a){a.success&&window.location.reload(!0)})};cityssm.openHtmlModal("licence-transactionAdd",
{onshow:function(c){llm.getDefaultConfigProperty("externalReceiptNumber_fieldLabel",function(a){c.querySelector("label[for='transactionAdd--externalReceiptNumber']").innerText=a});document.getElementById("transactionAdd--licenceID").value=l;var d=document.getElementById("licence--licenceFee").value,e=document.getElementById("licence--transactionTotal"),e=e?e.innerText:0;document.getElementById("transactionAdd--licenceFee").innerText=d;document.getElementById("transactionAdd--transactionTotal").innerText=
e;d=(d-e).toFixed(2);document.getElementById("transactionAdd--discrepancy").innerText=d;document.getElementById("transactionAdd--transactionAmount").value=d;a=c.getElementsByTagName("form")[0];a.addEventListener("submit",b);ba||(d=document.getElementById("is-add-transaction-issue-licence-button"),d.classList.remove("is-hidden"),d.addEventListener("click",function(){document.getElementById("transactionAdd--issueLicence").value="true";b()}))}})});var H=document.getElementById("is-void-transaction-button");
H&&H.addEventListener("click",function(){if(C)cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning");else{var a=(-1*H.getAttribute("data-transaction-amount")).toFixed(2);cityssm.confirmModal("Void Transaction?","<strong>Are you sure you want to void this transaction?</strong><br />If the history of this transaction should be maintained, it may be preferred to create a new transaction for $ "+a+".","Void Transaction","warning",function(){cityssm.postJSON("/licences/doVoidTransaction",
{licenceID:l,transactionIndex:H.getAttribute("data-transaction-index")},function(a){a.success&&window.location.reload(!0)})})}})}n||((e=document.getElementById("is-unissue-licence-button"))?e.addEventListener("click",function(){cityssm.confirmModal("Unissue Licence?","Are you sure you want to unissue this lottery licence?","Yes, Unissue","danger",function(){cityssm.postJSON("/licences/doUnissueLicence",{licenceID:l},function(a){a.success&&window.location.reload(!0)})})}):(e=function(){var a=function(){cityssm.postJSON("/licences/doIssueLicence",
{licenceID:l},function(a){a.success&&window.location.reload(!0)})};C?cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning"):cityssm.confirmModal("Issue Licence?","Are you sure you want to issue this lottery licence?","Yes, Issue","success",a)},document.getElementById("is-issue-licence-button").addEventListener("click",e),document.getElementById("is-not-issued-tag").addEventListener("dblclick",e)))})();
