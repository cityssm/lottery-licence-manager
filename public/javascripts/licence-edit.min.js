"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=document.getElementById("form--licence"),n=document.getElementById("container--form-message"),a=document.getElementById("licence--licenceID").value,s=""===a,i="true"===t.getAttribute("data-licence-is-issued"),c=["number","date","time"];let o=!1,l=!1;const d=document.getElementById("container--events");t.addEventListener("submit",a=>{a.preventDefault(),0!==d.getElementsByTagName("input").length?(n.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(e+"/licences/doSave",t,t=>{if(t.success&&(cityssm.disableNavBlocker(),l=!1),t.success&&s)window.location.href=e+"/licences/"+t.licenceID.toString()+"/edit";else if(t.success&&o)window.location.reload();else{n.innerHTML="",cityssm.alertModal(t.message,"","OK",t.success?"success":"danger");const e=document.getElementsByClassName("is-removed-after-save");for(const t of e)t.remove()}})):cityssm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning")}),s||document.getElementById("is-delete-licence-button").addEventListener("click",t=>{t.preventDefault();cityssm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",()=>{cityssm.postJSON(e+"/licences/doDelete",{licenceID:a},e=>{e.success&&(cityssm.disableNavBlocker(),window.location.href="/licences")})})});const r=()=>{o=!0},u=e=>{if(cityssm.enableNavBlocker(),l=!0,n.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>',s||(document.getElementById("is-add-transaction-button").setAttribute("disabled","disabled"),document.getElementById("is-disabled-transaction-message").classList.remove("is-hidden")),e){const t=e.currentTarget instanceof HTMLInputElement?e.currentTarget.type:"";c.includes(t)&&r()}},m=t.querySelectorAll("input, select, textarea");for(const e of m)""!==e.name&&e.addEventListener("change",u);const p=document.getElementById("is-external-licence-number-unlock-button");p&&p.addEventListener("click",()=>{const e=document.getElementById("licence--externalLicenceNumber");e.classList.remove("is-readonly"),e.removeAttribute("readonly"),e.focus()});{let t,n,a,s=[];const i=e=>{e.preventDefault();const n=e.currentTarget;document.getElementById("licence--organizationID").value=n.getAttribute("data-organization-id"),document.getElementById("licence--organizationName").value=n.getAttribute("data-organization-name"),t(),u()},c=()=>{const e=document.createElement("div");e.className="panel";const t=n.value.trim().toLowerCase().split(" ");let c=10;for(const n of s){if(c<0)break;let a=!0;if(!n.isEligibleForLicences)continue;const s=n.organizationName.toLowerCase();for(const e of t)if(!s.includes(e)){a=!1;break}if(a){c-=1;const t=document.createElement("a");t.className="panel-block is-block",t.setAttribute("data-organization-id",n.organizationID.toString()),t.setAttribute("data-organization-name",n.organizationName),t.setAttribute("href","#"),t.innerHTML=n.organizationName+'<br /><span class="is-size-7"><span class="icon"><i class="fas fa-user" aria-hidden="true"></i></span> '+n.representativeName+"</span>",t.addEventListener("click",i),e.appendChild(t)}}cityssm.clearElement(a),a.insertAdjacentElement("beforeend",e)},o=()=>{cityssm.openHtmlModal("licence-organizationLookup",{onshow(){(n=document.getElementById("organizationLookup--searchStr")).addEventListener("keyup",c),a=document.getElementById("container--organizationLookup"),0===s.length?cityssm.postJSON(e+"/organizations/doGetAll",null,e=>{s=e,n.removeAttribute("disabled"),c(),n.focus()}):(n.removeAttribute("disabled"),c(),n.focus())},onshown(e,a){t=a,n.focus()},onremoved(){document.getElementById("is-organization-lookup-button").focus()}})};document.getElementById("is-organization-lookup-button").addEventListener("click",o),document.getElementById("licence--organizationName").addEventListener("dblclick",o)}let y=[];const g=t=>{0===y.length?cityssm.postJSON(e+"/locations/doGetLocations",null,e=>{y=e.locations,t()}):t()};{let t,n,a;const s=(e,t)=>{document.getElementById("licence--locationID").value=e.toString(),document.getElementById("licence--locationDisplayName").value=t},i=e=>{e.preventDefault();const n=e.currentTarget;s(parseInt(n.getAttribute("data-location-id"),10),n.getAttribute("data-location-display-name")),t(),u()},c=()=>{const e=document.createElement("div");e.className="panel";const t=n.value.trim().toLowerCase().split(" ");let s=10;for(const n of y){if(s<=0)break;let a=!0;const c=n.locationName.toLowerCase();for(const e of t)if(!c.includes(e)){a=!1;break}if(a){s-=1;const t=document.createElement("a");t.className="panel-block is-block",t.setAttribute("data-location-id",n.locationID.toString()),t.setAttribute("data-location-display-name",n.locationDisplayName),t.setAttribute("href","#"),t.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(n.locationDisplayName)+"</div>"+(""===n.locationName?"":'<div class="column">'+cityssm.escapeHTML(n.locationAddress1)+"</div>")+"</div>",t.addEventListener("click",i),e.insertAdjacentElement("beforeend",t)}}cityssm.clearElement(a),a.insertAdjacentElement("beforeend",e)},o=()=>{cityssm.openHtmlModal("licence-locationLookup",{onshow(i){(n=document.getElementById("locationLookup--searchStr")).addEventListener("keyup",c),a=document.getElementById("container--locationLookup"),g(()=>{n.removeAttribute("disabled"),c(),n.focus()}),llm.getDefaultConfigProperty("city",e=>{e&&(document.getElementById("newLocation--locationCity").value=e)}),llm.getDefaultConfigProperty("province",e=>{e&&(document.getElementById("newLocation--locationProvince").value=e)}),document.getElementById("form--newLocation").addEventListener("submit",n=>{n.preventDefault(),cityssm.postJSON(e+"/locations/doCreate",n.currentTarget,e=>{e.success&&(y=[],s(e.locationID,e.locationDisplayName),t())})}),llm.initializeTabs(i.querySelector(".tabs ul"))},onshown(e,a){t=a,n.focus()},onremoved(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",o),document.getElementById("licence--locationDisplayName").addEventListener("dblclick",o)}document.getElementById("is-endDateString-year-button").addEventListener("click",()=>{const e=document.getElementById("licence--startDateString").value.split("-"),t=new Date(parseInt(e[0],10)+1,parseInt(e[1],10)-1,parseInt(e[2])),n=t.getFullYear().toString()+"-"+("00"+(t.getMonth()+1).toString()).slice(-2)+"-"+("00"+t.getDate().toString()).slice(-2);document.getElementById("licence--endDateString").value=n,u(),r()});{let t=[];const n=document.getElementById("is-termsConditions-lookup-modal"),a=document.getElementById("container--termsConditionsPrevious"),s=e=>{e.preventDefault();const a=parseInt(e.currentTarget.getAttribute("data-terms-conditions-index"),10),s=document.getElementById("licence--termsConditions");s.value=t[a].termsConditions,cityssm.hideModal(n),s.focus(),u()};document.getElementById("is-termsConditions-lookup-button").addEventListener("click",()=>{t=[],cityssm.clearElement(a);const i=document.getElementById("licence--organizationID").value;""!==i?(a.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Loading previously used terms and conditions...</p>',cityssm.postJSON(e+"/licences/doGetDistinctTermsConditions",{organizationID:i},e=>{if(0===(t=e).length)a.innerHTML='<p class="has-text-centered">No previously used terms and conditions found for this organization.</p>';else{const e=document.createElement("div");e.className="panel mb-3",t.forEach((t,n)=>{const a=document.createElement("a");a.className="panel-block is-block",a.setAttribute("data-terms-conditions-index",n.toString()),a.innerHTML='<p class="has-newline-chars">'+cityssm.escapeHTML(t.termsConditions)+'</p><p class="has-text-right">'+(t.termsConditionsCount>1?'<span class="tag is-light has-tooltip-left" data-tooltip="Included on Multiple Licences"><span class="icon"><i class="fas fa-star" aria-hidden="true"></i></span> <span>Used '+t.termsConditionsCount.toString()+" times</span></span>":"")+(t.isIssued>=1?'<span class="tag is-info has-tooltip-left" data-tooltip="Included on an Issued Licence"><span class="icon"><i class="fas fa-stamp" aria-hidden="true"></i></span> <span>Issued</span></span>':"")+' <span class="tag is-info has-tooltip-left" data-tooltip="Most Recent Licence Start Date"><span class="icon"><i class="fas fa-calendar" aria-hidden="true"></i></span> <span>'+t.startDateMaxString+"</span></span></p>",a.addEventListener("click",s),e.insertAdjacentElement("beforeend",a)}),cityssm.clearElement(a),a.insertAdjacentElement("beforeend",e)}}),cityssm.showModal(n)):cityssm.alertModal("No Organization Selected","An organization must be selected before the previously used terms and conditions can be retrieved.","OK","warning")});const i=n.getElementsByClassName("is-close-modal-button");for(const e of i)e.addEventListener("click",cityssm.hideModal)}const v=document.getElementById("licence--licenceTypeKey");if(s){const e=document.getElementsByClassName("container-licenceTypeFields"),t=()=>{const t=v.selectedOptions[0],n=t.getAttribute("data-total-prize-value-max");document.getElementById("licence--totalPrizeValue").setAttribute("max",n);const a="true"===t.getAttribute("data-has-ticket-types"),s=document.getElementById("licence--totalPrizeValue");if(a)document.getElementById("is-ticket-types-panel").classList.remove("is-hidden"),s.setAttribute("readonly","readonly"),s.classList.add("is-readonly");else{const e=document.getElementById("is-ticket-types-panel");e.classList.add("is-hidden"),cityssm.clearElement(e.getElementsByTagName("tbody")[0]),cityssm.clearElement(e.getElementsByTagName("tfoot")[0]),s.removeAttribute("readonly"),s.classList.remove("is-readonly")}const i="container-licenceTypeFields--"+v.value;for(const t of e)t.id===i?(t.removeAttribute("disabled"),t.classList.remove("is-hidden")):(t.classList.add("is-hidden"),t.setAttribute("disabled","disabled"))};v.addEventListener("change",t)}{const e=document.getElementById("licence--startDateString"),t=document.getElementById("licence--endDateString"),n=()=>{const n=e.value;t.setAttribute("min",n),t.value<n&&(t.value=n);const a=d.getElementsByTagName("input");for(const e of a)e.setAttribute("min",n)},a=()=>{const e=t.value,n=d.getElementsByTagName("input");for(const t of n)t.setAttribute("max",e)};document.getElementById("licence--applicationDateString").addEventListener("change",t=>{e.setAttribute("min",t.currentTarget.value)}),e.addEventListener("change",n),t.addEventListener("change",a);const s=e=>{e.currentTarget.closest(".panel-block").remove(),o=!0,u()},i=n=>{let a="";if(n)if(n instanceof Date)a=n.getFullYear().toString()+"-"+("00"+(n.getMonth()+1).toString()).slice(-2)+"-"+("00"+n.getDate().toString()).slice(-2);else if(n.constructor===String)a=n;else if(n instanceof Event)try{n.preventDefault();const e=n.currentTarget.getAttribute("data-source");a=document.getElementById(e).value}catch(e){}d.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small input--eventDateString" name="eventDateString" type="date" value="'+cityssm.escapeHTML(a)+'" min="'+cityssm.escapeHTML(e.value)+'" max="'+cityssm.escapeHTML(t.value)+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');const i=d.getElementsByTagName("a");i[i.length-1].addEventListener("click",s),o=!0,u()},c=document.getElementById("is-event-calculator-modal");document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",()=>{const n=parseInt(document.getElementById("eventCalc--eventCount").value,10),a=parseInt(document.getElementById("eventCalc--dayInterval").value,10);let s=t.value.split("-");const o=new Date(parseInt(s[0],10),parseInt(s[1],10)-1,parseInt(s[2],10));s=e.value.split("-");const l=new Date(parseInt(s[0],10),parseInt(s[1],10)-1,parseInt(s[2],10));for(let e=0;e<n&&l.getTime()<=o.getTime();e+=1)i(l),l.setDate(l.getDate()+a);cityssm.hideModal(c)}),document.getElementById("is-event-calculator-button").addEventListener("click",()=>{cityssm.showModal(c)});const l=c.getElementsByClassName("is-close-modal-button");for(const e of l)e.addEventListener("click",cityssm.hideModal);const r=document.getElementsByClassName("is-add-event-button");for(const e of r)e.addEventListener("click",i)}const f=document.getElementById("is-ticket-types-panel");if(f){const n=new Map,a=t=>{const a=v.value;n.has(a)?t(n.get(a)):cityssm.postJSON(e+"/licences/doGetTicketTypes",{licenceTypeKey:a},e=>{n.set(a,e),t(e)})},i=()=>{let e=0;const t=f.getElementsByClassName("is-total-prizes-per-deal");for(const n of t)e+=parseFloat(n.value);let n=0;const a=f.getElementsByClassName("is-licence-fee");for(const e of a)n+=parseFloat(e.value);f.getElementsByTagName("tfoot")[0].innerHTML='<tr><td></td><td></td><td></td><td></td><th class="has-text-right is-nowrap">$ '+e.toFixed(2)+'</th><td class="is-hidden-print"></td><th class="has-text-right is-nowrap">$ '+n.toFixed(2)+'</th><td></td><td class="is-hidden-print"></td><td></td><td class="is-hidden-print"></td></tr>',document.getElementById("licence--totalPrizeValue").value=e.toFixed(2)},c=e=>{const n=e.currentTarget.closest("tr"),a=n.getAttribute("data-event-date-string"),c=n.getAttribute("data-ticket-type"),o=a+":"+c;cityssm.confirmModal("Delete Ticket Type?","Are you sure you want to remove the "+c+" ticket type for this licence?","Yes, Delete","danger",()=>{if(n.remove(),!s){const e=t.querySelector("input[name='ticketTypeKey_toAdd'][value='"+o+"']");e?e.remove():t.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketTypeKey_toDelete" type="hidden" value="'+cityssm.escapeHTML(o)+'" />')}i(),u(),r()})},o=e=>{const t=e.currentTarget.closest("tr"),n=t.getAttribute("data-event-date-string"),s=t.getAttribute("data-ticket-type");let c,o;const l=e=>{e.preventDefault();const n=parseInt(document.getElementById("amendUnit_unitCount").value,10),a=t.querySelector("input[name='ticketType_unitCount']");a.value=n.toString(),a.nextElementSibling.innerText=n.toString();const s=t.getElementsByClassName("is-total-value-per-deal")[0];s.value=(c.ticketPrice*c.ticketCount*n).toFixed(2),s.nextElementSibling.innerText="$"+(c.ticketPrice*c.ticketCount*n).toFixed(2);const l=t.getElementsByClassName("is-total-prizes-per-deal")[0];l.value=(c.prizesPerDeal*n).toFixed(2),l.nextElementSibling.innerText="$"+(c.prizesPerDeal*n).toFixed(2);const d=document.getElementById("amendUnit_licenceFee").value,m=t.querySelector("input[name='ticketType_licenceFee']");m.value=d,m.nextElementSibling.innerText="$ "+d,o(),i(),u(),r()},d=()=>{document.getElementById("amendUnit_licenceFee").value=(c.feePerUnit*parseInt(document.getElementById("amendUnit_unitCount").value,10)).toFixed(2)};cityssm.openHtmlModal("licence-ticketTypeUnitAmend",{onshow(e){document.getElementById("amendUnit_eventDateString").value=n,document.getElementById("amendUnit_ticketType").value=s;const i=t.querySelector("input[name='ticketType_unitCount']").value;document.getElementById("amendUnit_unitCountCurrent").value=i;const o=document.getElementById("amendUnit_unitCount");o.value=i,a(e=>{c=e.find(e=>e.ticketType===s),o.addEventListener("change",d),d()}),e.getElementsByTagName("form")[0].addEventListener("submit",l)},onshown(e,t){o=t}})},l=e=>{let t;const n=e.currentTarget.closest("td").previousElementSibling,a=e=>{const a=e.currentTarget;n.getElementsByTagName("input")[0].value=a.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=a.getAttribute("data-location-display-name"),t(),u()};cityssm.openHtmlModal("licence-distributorLookup",{onshow(){g(()=>{const e=document.createElement("div");e.className="panel";for(const t of y){if(!t.locationIsDistributor)continue;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-id",t.locationID.toString()),n.setAttribute("data-location-display-name",t.locationDisplayName),n.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(t.locationDisplayName)+"</div>"+(""===t.locationName?"":'<div class="column">'+cityssm.escapeHTML(t.locationAddress1)+"</div>")+"</div>",n.addEventListener("click",a),e.insertAdjacentElement("beforeend",n)}const t=document.getElementById("container--distributorLookup");cityssm.clearElement(t),t.insertAdjacentElement("beforeend",e)})},onshown(e,n){t=n}})},d=e=>{let t;const n=e.currentTarget.closest("td").previousElementSibling,a=e=>{const a=e.currentTarget;n.getElementsByTagName("input")[0].value=a.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=a.getAttribute("data-location-display-name"),t(),u()};cityssm.openHtmlModal("licence-manufacturerLookup",{onshow(){g(()=>{const e=document.createElement("div");e.className="panel";for(const t of y){if(!t.locationIsManufacturer)continue;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-id",t.locationID.toString()),n.setAttribute("data-location-display-name",t.locationDisplayName),n.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(t.locationDisplayName)+"</div>"+(""===t.locationName?"":'<div class="column">'+cityssm.escapeHTML(t.locationAddress1)+"</div>")+"</div>",n.addEventListener("click",a),e.insertAdjacentElement("beforeend",n)}const t=document.getElementById("container--manufacturerLookup");cityssm.clearElement(t),t.insertAdjacentElement("beforeend",e)})},onshown(e,n){t=n}})},m=()=>{let e,n,i,c;const o=n=>{n.preventDefault(),p({eventDateString:document.getElementById("ticketTypeAdd--eventDateString").value,ticketType:document.getElementById("ticketTypeAdd--ticketType").value,unitCount:parseInt(document.getElementById("ticketTypeAdd--unitCount").value,10),valuePerDeal:parseFloat(document.getElementById("ticketTypeAdd--valuePerDeal").value),prizesPerDeal:parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value),licenceFee:parseFloat(document.getElementById("ticketTypeAdd--licenceFee").value)}),s||t.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketTypeKey_toAdd" type="hidden" value="'+cityssm.escapeHTML(document.getElementById("ticketTypeAdd--eventDateString").value+":"+document.getElementById("ticketTypeAdd--ticketType").value)+'" />'),e()},l=()=>{const e=parseInt(c.value,10);document.getElementById("ticketTypeAdd--prizesTotal").value=(parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value)*e).toFixed(2),document.getElementById("ticketTypeAdd--licenceFee").value=(parseFloat(document.getElementById("ticketTypeAdd--feePerUnit").value)*e).toFixed(2)},d=()=>{const e=i.selectedOptions[0];document.getElementById("ticketTypeAdd--ticketPrice").value=e.getAttribute("data-ticket-price"),document.getElementById("ticketTypeAdd--ticketCount").value=e.getAttribute("data-ticket-count"),document.getElementById("ticketTypeAdd--valuePerDeal").value=(parseFloat(e.getAttribute("data-ticket-price"))*parseInt(e.getAttribute("data-ticket-count"),10)).toFixed(2),document.getElementById("ticketTypeAdd--prizesPerDeal").value=e.getAttribute("data-prizes-per-deal"),document.getElementById("ticketTypeAdd--feePerUnit").value=e.getAttribute("data-fee-per-unit"),l()},r=t=>{if(!t||0===t.length)return e(),void cityssm.alertModal("No ticket types available","","OK","danger");i.innerHTML="";for(const e of t){if(f.querySelector("tr[data-event-date-string='"+n.value+"'][data-ticket-type='"+e.ticketType+"']"))continue;const t=document.createElement("option");t.setAttribute("data-ticket-price",e.ticketPrice.toFixed(2)),t.setAttribute("data-ticket-count",e.ticketCount.toString()),t.setAttribute("data-prizes-per-deal",e.prizesPerDeal.toFixed(2)),t.setAttribute("data-fee-per-unit",(e.feePerUnit||0).toFixed(2)),t.value=e.ticketType,t.innerText=e.ticketType+" ("+e.ticketCount.toString()+" tickets, $"+e.ticketPrice.toFixed(2)+" each)",i.insertAdjacentElement("beforeend",t)}d()},u=(()=>{const e=[],t=document.getElementsByClassName("input--eventDateString");for(const n of t)e.push(n.value);return e.sort()})();0!==u.length?a(t=>{cityssm.openHtmlModal("licence-ticketTypeAdd",{onshow(e){n=document.getElementById("ticketTypeAdd--eventDateString");for(const e of u)n.insertAdjacentHTML("beforeend","<option>"+cityssm.escapeHTML(e)+"</option>");n.addEventListener("change",()=>{r(t)}),(i=document.getElementById("ticketTypeAdd--ticketType")).addEventListener("change",d),(c=document.getElementById("ticketTypeAdd--unitCount")).addEventListener("change",l),e.getElementsByTagName("form")[0].addEventListener("submit",o)},onshown(n,a){e=a,r(t)}})}):cityssm.alertModal("No Event Dates Available","You must add at least one event date before adding ticket types to the licence.","OK","warning")},p=e=>{const t=e.ticketType,n=document.createElement("tr");n.setAttribute("data-ticket-type",t),n.setAttribute("data-event-date-string",e.eventDateString),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_eventDateString" type="hidden" value="'+cityssm.escapeHTML(e.eventDateString)+'" /><span>'+cityssm.escapeHTML(e.eventDateString)+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_ticketType" type="hidden" value="'+cityssm.escapeHTML(t)+'" /><span>'+cityssm.escapeHTML(t)+"</span></td>");const a=e.unitCount;n.insertAdjacentHTML("beforeend",'<td class="has-text-right"><input name="ticketType_unitCount" type="hidden" value="'+a.toString()+'" /><span>'+a.toString()+"</span></td>");const s=e.valuePerDeal,m=(s*a).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-total-value-per-deal" type="hidden" value="'+m.toString()+'" /><span data-tooltip="$'+s.toFixed(2)+' value per deal">$ '+m+"</span></td>");const p=e.prizesPerDeal,y=(p*a).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-total-prizes-per-deal" type="hidden" value="'+y.toString()+'" /><span data-tooltip="$'+p.toFixed(2)+' prizes per deal">$'+y+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td class="is-hidden-print"><div class="field has-addons"><div class="control"><button class="button is-small is-amend-ticket-type-unit-count-button" data-tooltip="Amend Units" type="button">Amend</button></div><div class="control"><button class="button is-small is-danger is-delete-ticket-type-button" data-tooltip="Delete Ticket Type" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div></td>'),n.getElementsByClassName("is-amend-ticket-type-unit-count-button")[0].addEventListener("click",o),n.getElementsByClassName("is-delete-ticket-type-button")[0].addEventListener("click",c);const g=e.licenceFee;n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-licence-fee" name="ticketType_licenceFee" type="hidden" value="'+g.toString()+'" /><span>$'+g.toFixed(2)+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_manufacturerLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-manufacturer-button" data-tooltip="Change Manufacturer" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Manufacturer</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-manufacturer-button")[0].addEventListener("click",d),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_distributorLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-distributor-button" data-tooltip="Change Distributor" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Distributor</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-distributor-button")[0].addEventListener("click",l),f.getElementsByTagName("tbody")[0].insertAdjacentElement("afterbegin",n),i(),u(),r()};i(),document.getElementById("is-add-ticket-type-button").addEventListener("click",m);const E=f.getElementsByClassName("is-amend-ticket-type-unit-count-button");for(const e of E)e.addEventListener("click",o);const b=f.getElementsByClassName("is-delete-ticket-type-button");for(const e of b)e.addEventListener("click",c);const k=f.getElementsByClassName("is-amend-ticket-type-distributor-button");for(const e of k)e.addEventListener("click",l);const h=f.getElementsByClassName("is-amend-ticket-type-manufacturer-button");for(const e of h)e.addEventListener("click",d)}if(!s){const t=document.getElementById("is-update-expected-licence-fee-button");t&&t.addEventListener("click",()=>{const e=document.getElementById("licence--licenceFee");e.value=t.getAttribute("data-licence-fee-expected"),e.classList.remove("is-danger"),e.closest(".field").getElementsByClassName("help")[0].remove(),t.remove(),u(),r()}),document.getElementById("is-add-transaction-button").addEventListener("click",()=>{let t;const n=n=>{n&&n.preventDefault(),cityssm.postJSON(e+"/licences/doAddTransaction",t,e=>{e.success&&window.location.reload()})};cityssm.openHtmlModal("licence-transactionAdd",{onshow(e){llm.getDefaultConfigProperty("externalReceiptNumber_fieldLabel",t=>{e.querySelector("label[for='transactionAdd--externalReceiptNumber']").innerText=t}),document.getElementById("transactionAdd--licenceID").value=a;const s=parseFloat(document.getElementById("licence--licenceFee").value),c=document.getElementById("licence--transactionTotal"),o=parseFloat(c?c.innerText:"0");document.getElementById("transactionAdd--licenceFee").innerText=s.toFixed(2),document.getElementById("transactionAdd--transactionTotal").innerText=o.toFixed(2);const l=(s-o).toFixed(2);if(document.getElementById("transactionAdd--discrepancy").innerText=l,document.getElementById("transactionAdd--transactionAmount").value=l,(t=e.getElementsByTagName("form")[0]).addEventListener("submit",n),!i){const e=document.getElementById("is-add-transaction-issue-licence-button");e.classList.remove("is-hidden"),e.addEventListener("click",()=>{document.getElementById("transactionAdd--issueLicence").value="true",n()})}}})});const n=document.getElementById("is-void-transaction-button");n&&n.addEventListener("click",()=>{if(l)return void cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning");const t=(-1*parseFloat(n.getAttribute("data-transaction-amount"))).toFixed(2);cityssm.confirmModal("Void Transaction?","<strong>Are you sure you want to void this transaction?</strong><br />If the history of this transaction should be maintained, it may be preferred to create a new transaction for $ "+t+".","Void Transaction","warning",()=>{cityssm.postJSON(e+"/licences/doVoidTransaction",{licenceID:a,transactionIndex:n.getAttribute("data-transaction-index")},e=>{e.success&&window.location.reload()})})})}if(!s){const t=document.getElementById("is-unissue-licence-button");if(t)t.addEventListener("click",()=>{cityssm.confirmModal("Unissue Licence?","Are you sure you want to unissue this lottery licence?","Yes, Unissue","danger",()=>{cityssm.postJSON(e+"/licences/doUnissueLicence",{licenceID:a},e=>{e.success&&window.location.reload()})})});else{const t=()=>{const t=()=>{cityssm.postJSON(e+"/licences/doIssueLicence",{licenceID:a},e=>{e.success&&window.location.reload()})};l?cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning"):cityssm.confirmModal("Issue Licence?","Are you sure you want to issue this lottery licence?","Yes, Issue","success",t)};document.getElementById("is-issue-licence-button").addEventListener("click",t),document.getElementById("is-not-issued-tag").addEventListener("dblclick",t)}}})();