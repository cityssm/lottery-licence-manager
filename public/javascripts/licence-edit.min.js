(function(){function k(a){window.llm.enableNavBlocker();u.innerHTML='<div class="has-text-info"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i> Unsaved Changes</div>';l&&a&&"number"===a.currentTarget.type&&(l.getElementsByTagName("fieldset")[0].setAttribute("disabled","disabled"),q=!0)}function I(a){a.preventDefault();a=a.currentTarget;document.getElementById("licence--organizationID").value=a.getAttribute("data-organization-id");document.getElementById("licence--organizationName").value=
a.getAttribute("data-organization-name");window.llm.hideModal(a);k()}function C(){var a=document.createElement("div");a.className="list is-hoverable";for(var h=v.value.trim().toLowerCase().split(" "),m=10,c=0;c<r.length&&0<m;c+=1){var e=!0,b=r[c];if(b.isEligibleForLicences){for(var g=b.organizationName.toLowerCase(),d=0;d<h.length;d+=1)if(-1===g.indexOf(h[d])){e=!1;break}e&&(--m,e=document.createElement("a"),e.className="list-item",e.setAttribute("data-organization-id",b.organizationID),e.setAttribute("data-organization-name",
b.organizationName),e.innerText=b.organizationName,e.addEventListener("click",I),a.insertAdjacentElement("beforeend",e))}}window.llm.clearElement(D);D.insertAdjacentElement("beforeend",a)}function J(a){a.preventDefault();a=a.currentTarget;document.getElementById("licence--locationID").value=a.getAttribute("data-location-id");document.getElementById("licence--locationDisplayName").value=a.getAttribute("data-location-display-name");window.llm.hideModal(a);k()}function E(){var a=document.createElement("div");
a.className="list is-hoverable";for(var h=w.value.trim().toLowerCase().split(" "),m=10,b=0;b<t.length&&0<m;b+=1){for(var c=!0,d=t[b],g=d.locationName.toLowerCase(),f=0;f<h.length;f+=1)if(-1===g.indexOf(h[f])){c=!1;break}c&&(--m,c=""===d.locationName?d.locationAddress1:d.locationName,g=document.createElement("a"),g.className="list-item",g.setAttribute("data-location-id",d.locationID),g.setAttribute("data-location-display-name",c),g.innerHTML=c+(""===d.locationName?"":"<br /><small>"+d.locationAddress1+
"</small>"),g.addEventListener("click",J),a.insertAdjacentElement("beforeend",g))}window.llm.clearElement(F);F.insertAdjacentElement("beforeend",a)}function K(a){a.currentTarget.closest(".panel-block").remove();q=!0;k()}function G(a){var h="";a&&a instanceof Date&&(h=a.getFullYear()+"-"+("00"+(a.getMonth()+1)).slice(-2)+"-"+("00"+a.getDate()).slice(-2));n.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons">'+('<div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+
h+'" min="'+p.value+'" max="'+d.value+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div>')+'<div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');a=n.getElementsByTagName("a");a[a.length-1].addEventListener("click",K);q=!0;k()}var x=document.getElementById("form--licence"),
u=document.getElementById("container--form-message"),y=document.getElementById("licence--licenceID").value,z=""===y,l=document.getElementById("form--licenceFee"),q=!1,n=document.getElementById("container--events");x.addEventListener("submit",function(a){a.preventDefault();0===n.getElementsByTagName("input").length?window.llm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning"):(u.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',
window.fetch("/licences/doSave",{method:"POST",credentials:"include",body:new URLSearchParams(new FormData(x))}).then(function(a){return a.json()}).then(function(a){a.success&&window.llm.disableNavBlocker();a.success&&z?window.location.href="/licences/"+a.licenceID+"/edit":a.success&&q?window.location.reload(!0):(u.innerHTML="",window.llm.alertModal(a.message,"","OK",a.success?"success":"danger"))}))});z||document.getElementsByClassName("is-delete-button")[0].addEventListener("click",function(a){a.preventDefault();
window.llm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",function(){window.fetch("/licences/doDelete",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenceID:y})}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.href="/licences")})})});for(var c=x.querySelectorAll("input, select, textarea"),
b=0;b<c.length;b+=1)""!==c[b].name&&c[b].addEventListener("change",k);c=document.getElementsByClassName("is-external-licence-number-unlock-button");c.length&&c[0].addEventListener("click",function(){var a=document.getElementById("licence--externalLicenceNumber");a.classList.remove("has-background-light");a.classList.remove("has-cursor-not-allowed");a.removeAttribute("readonly");a.focus()});var r=[],H=document.getElementsByClassName("is-organization-lookup-modal")[0],v=document.getElementById("organizationLookup--searchStr"),
D=document.getElementById("container--organizationLookup");v.addEventListener("keyup",C);document.getElementsByClassName("is-organization-lookup-button")[0].addEventListener("click",function(){0===r.length&&window.fetch("/organizations/doGetAll",{method:"get",credentials:"include"}).then(function(a){return a.json()}).then(function(a){r=a;v.removeAttribute("disabled");C()});window.llm.showModal(H)});c=H.getElementsByClassName("is-cancel-button");for(b=0;b<c.length;b+=1)c[b].addEventListener("click",
window.llm.hideModal);var t=[],A=document.getElementsByClassName("is-location-lookup-modal")[0],w=document.getElementById("locationLookup--searchStr"),F=document.getElementById("container--locationLookup");w.addEventListener("keyup",E);document.getElementsByClassName("is-location-lookup-button")[0].addEventListener("click",function(){0===t.length&&window.fetch("/licences/doGetLocations",{method:"get",credentials:"include"}).then(function(a){return a.json()}).then(function(a){t=a;w.removeAttribute("disabled");
E()});window.llm.showModal(A)});c=A.getElementsByClassName("is-cancel-button");for(b=0;b<c.length;b+=1)c[b].addEventListener("click",window.llm.hideModal);window.llm.initializeTabs(A.querySelector(".tabs ul"));var c=document.getElementById("licence--licenceTypeKey"),f=document.getElementsByClassName("container-licenceTypeFields");c.addEventListener("change",function(a){a="container-licenceTypeFields--"+a.currentTarget.value;for(var c=0;c<f.length;c+=1)f[c].id===a?(f[c].removeAttribute("disabled"),
f[c].classList.remove("is-hidden")):(f[c].classList.add("is-hidden"),f[c].setAttribute("disabled","disabled"))});var p=document.getElementById("licence--startDateString"),d=document.getElementById("licence--endDateString");document.getElementById("licence--applicationDateString").addEventListener("change",function(a){p.setAttribute("min",a.currentTarget.value)});p.addEventListener("change",function(){var a=p.value;d.setAttribute("min",a);d.value<a&&(d.value=a);for(var c=n.getElementsByTagName("input"),
b=0;b<c.length;b+=1)c[b].setAttribute("min",a)});d.addEventListener("change",function(){for(var a=d.value,c=n.getElementsByTagName("input"),b=0;b<c.length;b+=1)c[b].setAttribute("max",a)});var B=document.getElementsByClassName("is-event-calculator-modal")[0];document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",function(){for(var a=parseInt(document.getElementById("eventCalc--eventCount").value),c=parseInt(document.getElementById("eventCalc--dayInterval").value),
b=d.value.split("-"),f=new Date(b[0],parseInt(b[1])-1,b[2]),b=p.value.split("-"),b=new Date(b[0],parseInt(b[1])-1,b[2]),e=0;e<a&&b.getTime()<=f.getTime();e+=1)G(b),b.setDate(b.getDate()+c);window.llm.hideModal(B)});document.getElementsByClassName("is-event-calculator-button")[0].addEventListener("click",function(){window.llm.showModal(B)});c=B.getElementsByClassName("is-cancel-button");for(b=0;b<c.length;b+=1)c[b].addEventListener("click",window.llm.hideModal);document.getElementsByClassName("is-add-event-button")[0].addEventListener("click",
G);if(!z)if(l){var L=function(){window.fetch("/licences/doMarkLicenceFeePaid",{method:"POST",credentials:"include",body:new URLSearchParams(new FormData(l))}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.reload(!0))})};l.addEventListener("submit",function(a){a.preventDefault();window.llm.confirmModal("Mark Fee as Paid?","Are you sure you want to mark the licence fee as paid?","Yes, Paid","info",L)})}else{var M=function(){window.fetch("/licences/doRemoveLicenceFee",
{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({licenceID:y})}).then(function(a){return a.json()}).then(function(a){a.success&&(window.llm.disableNavBlocker(),window.location.reload(!0))})};document.getElementsByClassName("is-remove-licence-fee-button")[0].addEventListener("click",function(){window.llm.confirmModal("Remove Fee Payment?","Are you sure you want to remove the fee payment and change the licence to unpaid?","Yes, Remove Payment","danger",
M)})}})();
