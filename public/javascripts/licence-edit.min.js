"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=document.getElementById("form--licence"),t=document.getElementById("container--form-message"),n=document.getElementById("licence--licenceID").value,a=""===n,i="true"===e.getAttribute("data-licence-is-issued"),s=["number","date","time"],c=!1,o=!1,l=document.getElementById("container--events");function d(){c=!0}function r(e){if(cityssm.enableNavBlocker(),o=!0,t.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>',a||(document.getElementById("is-add-transaction-button").setAttribute("disabled","disabled"),document.getElementById("is-disabled-transaction-message").classList.remove("is-hidden")),e){var n=e.currentTarget instanceof HTMLInputElement?e.currentTarget.type:"";s.includes(n)&&d()}}e.addEventListener("submit",function(n){n.preventDefault(),0!==l.getElementsByTagName("input").length?(t.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON("/licences/doSave",e,function(e){if(e.success&&(cityssm.disableNavBlocker(),o=!1),e.success&&a)window.location.href="/licences/"+e.licenceID+"/edit";else if(e.success&&c)window.location.reload(!0);else{t.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger");for(var n=document.getElementsByClassName("is-removed-after-save"),i=0;i<n.length;i+=1)n[i].remove()}})):cityssm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning")}),a||document.getElementById("is-delete-licence-button").addEventListener("click",function(e){e.preventDefault(),cityssm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",function(){cityssm.postJSON("/licences/doDelete",{licenceID:n},function(e){e.success&&(cityssm.disableNavBlocker(),window.location.href="/licences")})})});for(var u=e.querySelectorAll("input, select, textarea"),m=0;m<u.length;m+=1)""!==u[m].name&&u[m].addEventListener("change",r);var v=document.getElementById("is-external-licence-number-unlock-button");v&&v.addEventListener("click",function(){var e=document.getElementById("licence--externalLicenceNumber");e.classList.remove("is-readonly"),e.removeAttribute("readonly"),e.focus()});var p,y,g,f=[],E=function(e){e.preventDefault();var t=e.currentTarget;document.getElementById("licence--organizationID").value=t.getAttribute("data-organization-id"),document.getElementById("licence--organizationName").value=t.getAttribute("data-organization-name"),p(),r()},b=function(){var e=document.createElement("div");e.className="list is-hoverable";for(var t=y.value.trim().toLowerCase().split(" "),n=10,a=0;a<f.length&&n>0;a+=1){var i=!0,s=f[a];if(s.isEligibleForLicences){for(var c=s.organizationName.toLowerCase(),o=0;o<t.length;o+=1)if(-1===c.indexOf(t[o])){i=!1;break}if(i){n-=1;var l=document.createElement("a");l.className="list-item",l.setAttribute("data-organization-id",s.organizationID),l.setAttribute("data-organization-name",s.organizationName),l.setAttribute("href","#"),l.innerHTML=s.organizationName+'<br /><span class="is-size-7"><span class="icon"><i class="fas fa-user" aria-hidden="true"></i></span> '+s.representativeName+"</span>",l.addEventListener("click",E),e.appendChild(l)}}}cityssm.clearElement(g),g.insertAdjacentElement("beforeend",e)},h=function(){cityssm.openHtmlModal("licence-organizationLookup",{onshow:function(){(y=document.getElementById("organizationLookup--searchStr")).addEventListener("keyup",b),g=document.getElementById("container--organizationLookup"),0===f.length?cityssm.postJSON("/organizations/doGetAll",null,function(e){f=e,y.removeAttribute("disabled"),b(),y.focus()}):(y.removeAttribute("disabled"),b(),y.focus())},onshown:function(e,t){p=t,y.focus()},onremoved:function(){document.getElementById("is-organization-lookup-button").focus()}})};document.getElementById("is-organization-lookup-button").addEventListener("click",h),document.getElementById("licence--organizationName").addEventListener("dblclick",h);var k=[];function T(e){0===k.length?cityssm.postJSON("/locations/doGetLocations",null,function(t){k=t.locations,e()}):e()}var I,B,A,L=function(e,t){document.getElementById("licence--locationID").value=e,document.getElementById("licence--locationDisplayName").value=t},N=function(e){e.preventDefault();var t=e.currentTarget;L(t.getAttribute("data-location-id"),t.getAttribute("data-location-display-name")),I(),r()},D=function(){var e=document.createElement("div");e.className="list is-hoverable";for(var t=B.value.trim().toLowerCase().split(" "),n=10,a=0;a<k.length&&n>0;a+=1){for(var i=!0,s=k[a],c=s.locationName.toLowerCase(),o=0;o<t.length;o+=1)if(-1===c.indexOf(t[o])){i=!1;break}if(i){n-=1;var l=document.createElement("a");l.className="list-item",l.setAttribute("data-location-id",s.locationID.toString()),l.setAttribute("data-location-display-name",s.locationDisplayName),l.setAttribute("href","#"),l.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(s.locationDisplayName)+"</div>"+(""===s.locationName?"":'<div class="column">'+cityssm.escapeHTML(s.locationAddress1)+"</div>")+"</div>",l.addEventListener("click",N),e.insertAdjacentElement("beforeend",l)}}cityssm.clearElement(A),A.insertAdjacentElement("beforeend",e)},x=function(){cityssm.openHtmlModal("licence-locationLookup",{onshow:function(e){(B=document.getElementById("locationLookup--searchStr")).addEventListener("keyup",D),A=document.getElementById("container--locationLookup"),T(function(){B.removeAttribute("disabled"),D(),B.focus()}),llm.getDefaultConfigProperty("city",function(e){e&&(document.getElementById("newLocation--locationCity").value=e)}),llm.getDefaultConfigProperty("province",function(e){e&&(document.getElementById("newLocation--locationProvince").value=e)}),document.getElementById("form--newLocation").addEventListener("submit",function(e){e.preventDefault(),cityssm.postJSON("/locations/doCreate",e.currentTarget,function(e){e.success&&(k=[],L(e.locationID,e.locationDisplayName),I())})}),llm.initializeTabs(e.querySelector(".tabs ul"))},onshown:function(e,t){I=t,B.focus()},onremoved:function(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",x),document.getElementById("licence--locationDisplayName").addEventListener("dblclick",x);var C=[],M=document.getElementById("is-termsConditions-lookup-modal"),w=document.getElementById("container--termsConditionsPrevious"),F=function(e){e.preventDefault();var t=parseInt(e.currentTarget.getAttribute("data-terms-conditions-index")),n=document.getElementById("licence--termsConditions");n.value=C[t].termsConditions,cityssm.hideModal(M),n.focus(),r()};document.getElementById("is-termsConditions-lookup-button").addEventListener("click",function(){C=[],cityssm.clearElement(w);var e=document.getElementById("licence--organizationID").value;""!==e?(w.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Loading previously used terms and conditions...</p>',cityssm.postJSON("/licences/doGetDistinctTermsConditions",{organizationID:e},function(e){if(0===(C=e).length)w.innerHTML='<p class="has-text-centered">No previously used terms and conditions found for this organization.</p>';else{var t=document.createElement("div");t.className="list is-hoverable has-margin-bottom-10";for(var n=0;n<C.length;n+=1){var a=C[n],i=document.createElement("a");i.className="list-item",i.setAttribute("data-terms-conditions-index",n.toString()),i.innerHTML='<p class="has-newline-chars">'+cityssm.escapeHTML(a.termsConditions)+'</p><p class="has-text-right">'+(a.termsConditionsCount>1?'<span class="tag is-light">Used '+a.termsConditionsCount+" times</span>":"")+'<span class="tag is-info has-tooltip-left" data-tooltip="Most Recent Licence Start Date">'+a.startDateMaxString+"</span></p>",i.addEventListener("click",F),t.insertAdjacentElement("beforeend",i)}cityssm.clearElement(w),w.insertAdjacentElement("beforeend",t)}}),cityssm.showModal(M)):cityssm.alertModal("No Organization Selected","An organization must be selected before the previously used terms and conditions can be retrieved.","OK","warning")});for(var S=M.getElementsByClassName("is-close-modal-button"),z=0;z<S.length;z+=1)S[z].addEventListener("click",cityssm.hideModal);var H=document.getElementById("licence--licenceTypeKey");if(a){var P=document.getElementsByClassName("container-licenceTypeFields");H.addEventListener("change",function(){var e=H.selectedOptions[0],t=e.getAttribute("data-total-prize-value-max");document.getElementById("licence--totalPrizeValue").setAttribute("max",t);var n="true"===e.getAttribute("data-has-ticket-types"),a=document.getElementById("licence--totalPrizeValue");if(n)document.getElementById("is-ticket-types-panel").classList.remove("is-hidden"),a.setAttribute("readonly","readonly"),a.classList.add("is-readonly");else{var i=document.getElementById("is-ticket-types-panel");i.classList.add("is-hidden"),cityssm.clearElement(i.getElementsByTagName("tbody")[0]),cityssm.clearElement(i.getElementsByTagName("tfoot")[0]),a.removeAttribute("readonly"),a.classList.remove("is-readonly")}for(var s="container-licenceTypeFields--"+H.value,c=0;c<P.length;c+=1)P[c].id===s?(P[c].removeAttribute("disabled"),P[c].classList.remove("is-hidden")):(P[c].classList.add("is-hidden"),P[c].setAttribute("disabled","disabled"))})}var j=document.getElementById("licence--startDateString"),O=document.getElementById("licence--endDateString");document.getElementById("licence--applicationDateString").addEventListener("change",function(e){j.setAttribute("min",e.currentTarget.value)}),j.addEventListener("change",function(){var e=j.value;O.setAttribute("min",e),O.value<e&&(O.value=e);for(var t=l.getElementsByTagName("input"),n=0;n<t.length;n+=1)t[n].setAttribute("min",e)}),O.addEventListener("change",function(){for(var e=O.value,t=l.getElementsByTagName("input"),n=0;n<t.length;n+=1)t[n].setAttribute("max",e)});var _=function(e){e.currentTarget.closest(".panel-block").remove(),c=!0,r()},U=function(e){var t="";if(e)if(e instanceof Date)t=e.getFullYear()+"-"+("00"+(e.getMonth()+1)).slice(-2)+"-"+("00"+e.getDate()).slice(-2);else if(e.constructor===String)t=e;else if(e instanceof Event)try{e.preventDefault();var n=e.currentTarget.getAttribute("data-source");t=document.getElementById(n).value}catch(e){}l.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+t+'" min="'+j.value+'" max="'+O.value+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');var a=l.getElementsByTagName("a");a[a.length-1].addEventListener("click",_),c=!0,r()},$=document.getElementById("is-event-calculator-modal");document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",function(){var e=parseInt(document.getElementById("eventCalc--eventCount").value),t=parseInt(document.getElementById("eventCalc--dayInterval").value),n=O.value.split("-"),a=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2]));n=j.value.split("-");for(var i=new Date(parseInt(n[0]),parseInt(n[1])-1,parseInt(n[2])),s=0;s<e&&i.getTime()<=a.getTime();s+=1)U(i),i.setDate(i.getDate()+t);cityssm.hideModal($)}),document.getElementById("is-event-calculator-button").addEventListener("click",function(){cityssm.showModal($)});for(S=$.getElementsByClassName("is-close-modal-button"),z=0;z<S.length;z+=1)S[z].addEventListener("click",cityssm.hideModal);for(var J=document.getElementsByClassName("is-add-event-button"),q=0;q<J.length;q+=1)J[q].addEventListener("click",U);var K=document.getElementById("is-ticket-types-panel");if(K){var V=new Map,R=function(e){var t=H.value;V.has(t)?e(V.get(t)):cityssm.postJSON("/licences/doGetTicketTypes",{licenceTypeKey:t},function(n){V.set(t,n),e(n)})},Y=function(){for(var e=0,t=K.getElementsByClassName("is-total-prizes-per-deal"),n=0;n<t.length;n+=1)e+=parseFloat(t[n].value);var a=0,i=K.getElementsByClassName("is-licence-fee");for(n=0;n<i.length;n+=1)a+=parseFloat(i[n].value);K.getElementsByTagName("tfoot")[0].innerHTML='<tr><td></td><td></td><td></td><th class="has-text-right is-nowrap">$ '+e.toFixed(2)+'</th><td class="is-hidden-print"></td><th class="has-text-right is-nowrap">$ '+a.toFixed(2)+'</th><td></td><td class="is-hidden-print"></td><td></td><td class="is-hidden-print"></td></tr>',document.getElementById("licence--totalPrizeValue").value=e.toFixed(2)},G=function(t){var n=t.currentTarget.closest("tr"),i=n.getAttribute("data-ticket-type");cityssm.confirmModal("Delete Ticket Type?","Are you sure you want to remove the "+i+" ticket type for this licence?","Yes, Delete","danger",function(){if(n.remove(),!a){var t=e.querySelector("input[name='ticketType_toAdd'][value='"+i+"']");t?t.remove():e.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketType_toDelete" type="hidden" value="'+i+'" />')}Y(),r(),d()})},Q=function(e){var t,n,a=e.currentTarget.closest("tr"),i=a.getAttribute("data-ticket-type"),s=function(e){e.preventDefault();var i=parseInt(document.getElementById("amendUnit_unitCount").value),s=a.querySelector("input[name='ticketType_unitCount']");s.value=i.toString(),s.nextElementSibling.innerText=i.toString();var c=a.getElementsByClassName("is-total-value-per-deal")[0];c.value=(t.ticketPrice*t.ticketCount*i).toFixed(2),c.nextElementSibling.innerText="$"+(t.ticketPrice*t.ticketCount*i).toFixed(2);var o=a.getElementsByClassName("is-total-prizes-per-deal")[0];o.value=(t.prizesPerDeal*i).toFixed(2),o.nextElementSibling.innerText="$"+(t.prizesPerDeal*i).toFixed(2);var l=document.getElementById("amendUnit_licenceFee").value,u=a.querySelector("input[name='ticketType_licenceFee']");u.value=l,u.nextElementSibling.innerText="$ "+l,n(),Y(),r(),d()},c=function(){document.getElementById("amendUnit_licenceFee").value=(t.feePerUnit*parseInt(document.getElementById("amendUnit_unitCount").value)).toFixed(2)};cityssm.openHtmlModal("licence-ticketTypeUnitAmend",{onshow:function(e){document.getElementById("amendUnit_ticketType").value=i;var n=a.querySelector("input[name='ticketType_unitCount']").value;document.getElementById("amendUnit_unitCountCurrent").value=n;var o=document.getElementById("amendUnit_unitCount");o.value=n,R(function(e){t=e.find(function(e){return e.ticketType===i}),o.addEventListener("change",c),c()}),e.getElementsByTagName("form")[0].addEventListener("submit",s)},onshown:function(e,t){n=t}})},W=function(e){var t,n=e.currentTarget.closest("td").previousElementSibling,a=function(e){var a=e.currentTarget;n.getElementsByTagName("input")[0].value=a.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=a.getAttribute("data-location-display-name"),t(),r()};cityssm.openHtmlModal("licence-distributorLookup",{onshow:function(){T(function(){var e=document.createElement("div");e.className="list is-hoverable";for(var t=0;t<k.length;t+=1){var n=k[t];if(n.locationIsDistributor){var i=document.createElement("a");i.className="list-item",i.setAttribute("data-location-id",n.locationID.toString()),i.setAttribute("data-location-display-name",n.locationDisplayName),i.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(n.locationDisplayName)+"</div>"+(""===n.locationName?"":'<div class="column">'+cityssm.escapeHTML(n.locationAddress1)+"</div>")+"</div>",i.addEventListener("click",a),e.insertAdjacentElement("beforeend",i)}}var s=document.getElementById("container--distributorLookup");cityssm.clearElement(s),s.insertAdjacentElement("beforeend",e)})},onshown:function(e,n){t=n}})},X=function(e){var t,n=e.currentTarget.closest("td").previousElementSibling,a=function(e){var a=e.currentTarget;n.getElementsByTagName("input")[0].value=a.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=a.getAttribute("data-location-display-name"),t(),r()};cityssm.openHtmlModal("licence-manufacturerLookup",{onshow:function(){T(function(){var e=document.createElement("div");e.className="list is-hoverable";for(var t=0;t<k.length;t+=1){var n=k[t];if(n.locationIsManufacturer){var i=document.createElement("a");i.className="list-item",i.setAttribute("data-location-id",n.locationID.toString()),i.setAttribute("data-location-display-name",n.locationDisplayName),i.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(n.locationDisplayName)+"</div>"+(""===n.locationName?"":'<div class="column">'+cityssm.escapeHTML(n.locationAddress1)+"</div>")+"</div>",i.addEventListener("click",a),e.insertAdjacentElement("beforeend",i)}}var s=document.getElementById("container--manufacturerLookup");cityssm.clearElement(s),s.insertAdjacentElement("beforeend",e)})},onshown:function(e,n){t=n}})},Z=function(e){var t=e.ticketType,n=document.createElement("tr");n.setAttribute("data-ticket-type",t),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_ticketType" type="hidden" value="'+t+'" /><span>'+t+"</span></td>");var a=e.unitCount;n.insertAdjacentHTML("beforeend",'<td class="has-text-right"><input name="ticketType_unitCount" type="hidden" value="'+a+'" /><span>'+a+"</span></td>");var i=e.valuePerDeal,s=(i*a).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><span data-tooltip="$'+i+' value per deal">$ '+s+"</span></td>");var c=e.prizesPerDeal,o=(c*a).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-total-prizes-per-deal" type="hidden" value="'+o+'" /><span data-tooltip="$'+c+' prizes per deal">$ '+o+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td class="is-hidden-print"><div class="field has-addons"><div class="control"><button class="button is-small is-amend-ticket-type-unit-count-button" data-tooltip="Amend Units" type="button">Amend</button></div><div class="control"><button class="button is-small is-danger is-delete-ticket-type-button" data-tooltip="Delete Ticket Type" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div></td>'),n.getElementsByClassName("is-amend-ticket-type-unit-count-button")[0].addEventListener("click",Q),n.getElementsByClassName("is-delete-ticket-type-button")[0].addEventListener("click",G);var l=e.licenceFee;n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-licence-fee" name="ticketType_licenceFee" type="hidden" value="'+l+'" /><span>$ '+l+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_manufacturerLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-manufacturer-button" data-tooltip="Change Manufacturer" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Manufacturer</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-manufacturer-button")[0].addEventListener("click",X),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_distributorLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-distributor-button" data-tooltip="Change Distributor" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Distributor</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-distributor-button")[0].addEventListener("click",W),K.getElementsByTagName("tbody")[0].insertAdjacentElement("afterbegin",n),Y(),r(),d()};Y(),document.getElementById("is-add-ticket-type-button").addEventListener("click",function(){var t,n,i,s=function(n){n.preventDefault(),Z({ticketType:document.getElementById("ticketTypeAdd--ticketType").value,unitCount:parseInt(document.getElementById("ticketTypeAdd--unitCount").value),valuePerDeal:parseFloat(document.getElementById("ticketTypeAdd--valuePerDeal").value),prizesPerDeal:parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value),licenceFee:parseFloat(document.getElementById("ticketTypeAdd--licenceFee").value)}),a||e.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketType_toAdd" type="hidden" value="'+document.getElementById("ticketTypeAdd--ticketType").value+'" />'),t()},c=function(){var e=parseInt(i.value);document.getElementById("ticketTypeAdd--prizesTotal").value=(parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value)*e).toFixed(2),document.getElementById("ticketTypeAdd--licenceFee").value=(parseFloat(document.getElementById("ticketTypeAdd--feePerUnit").value)*e).toFixed(2)},o=function(){var e=n.selectedOptions[0];document.getElementById("ticketTypeAdd--ticketPrice").value=e.getAttribute("data-ticket-price"),document.getElementById("ticketTypeAdd--ticketCount").value=e.getAttribute("data-ticket-count"),document.getElementById("ticketTypeAdd--valuePerDeal").value=(parseFloat(e.getAttribute("data-ticket-price"))*parseInt(e.getAttribute("data-ticket-count"))).toFixed(2),document.getElementById("ticketTypeAdd--prizesPerDeal").value=e.getAttribute("data-prizes-per-deal"),document.getElementById("ticketTypeAdd--feePerUnit").value=e.getAttribute("data-fee-per-unit"),c()},l=function(e){if(!e||0===e.length)return t(),void cityssm.alertModal("No ticket types available","","OK","danger");for(var a=0;a<e.length;a+=1){var i=e[a];if(!K.querySelector("tr[data-ticket-type='"+i.ticketType+"']")){var s=document.createElement("option");s.setAttribute("data-ticket-price",i.ticketPrice.toFixed(2)),s.setAttribute("data-ticket-count",i.ticketCount.toString()),s.setAttribute("data-prizes-per-deal",i.prizesPerDeal.toFixed(2)),s.setAttribute("data-fee-per-unit",(i.feePerUnit||0).toFixed(2)),s.value=i.ticketType,s.innerText=i.ticketType+" ("+i.ticketCount+" tickets, $"+i.ticketPrice.toFixed(2)+" each)",n.insertAdjacentElement("beforeend",s)}}o()};cityssm.openHtmlModal("licence-ticketTypeAdd",{onshow:function(e){(n=document.getElementById("ticketTypeAdd--ticketType")).addEventListener("change",o),(i=document.getElementById("ticketTypeAdd--unitCount")).addEventListener("change",c),e.getElementsByTagName("form")[0].addEventListener("submit",s)},onshown:function(e,n){t=n,R(l)}})});var ee=K.getElementsByClassName("is-amend-ticket-type-unit-count-button");for(z=0;z<ee.length;z+=1)ee[z].addEventListener("click",Q);var te=K.getElementsByClassName("is-delete-ticket-type-button");for(z=0;z<te.length;z+=1)te[z].addEventListener("click",G);var ne=K.getElementsByClassName("is-amend-ticket-type-distributor-button");for(z=0;z<ne.length;z+=1)ne[z].addEventListener("click",W);var ae=K.getElementsByClassName("is-amend-ticket-type-manufacturer-button");for(z=0;z<ae.length;z+=1)ae[z].addEventListener("click",X)}if(!a){var ie=document.getElementById("is-update-expected-licence-fee-button");ie&&ie.addEventListener("click",function(){var e=document.getElementById("licence--licenceFee");e.value=ie.getAttribute("data-licence-fee-expected"),e.classList.remove("is-danger"),e.closest(".field").getElementsByClassName("help")[0].remove(),ie.remove(),r(),d()}),document.getElementById("is-add-transaction-button").addEventListener("click",function(){var e,t=function(t){t&&t.preventDefault(),cityssm.postJSON("/licences/doAddTransaction",e,function(e){e.success&&window.location.reload(!0)})};cityssm.openHtmlModal("licence-transactionAdd",{onshow:function(a){llm.getDefaultConfigProperty("externalReceiptNumber_fieldLabel",function(e){a.querySelector("label[for='transactionAdd--externalReceiptNumber']").innerText=e}),document.getElementById("transactionAdd--licenceID").value=n;var s=parseFloat(document.getElementById("licence--licenceFee").value),c=document.getElementById("licence--transactionTotal"),o=parseFloat(c?c.innerText:"0");document.getElementById("transactionAdd--licenceFee").innerText=s.toFixed(2),document.getElementById("transactionAdd--transactionTotal").innerText=o.toFixed(2);var l=(s-o).toFixed(2);if(document.getElementById("transactionAdd--discrepancy").innerText=l,document.getElementById("transactionAdd--transactionAmount").value=l,(e=a.getElementsByTagName("form")[0]).addEventListener("submit",t),!i){var d=document.getElementById("is-add-transaction-issue-licence-button");d.classList.remove("is-hidden"),d.addEventListener("click",function(){document.getElementById("transactionAdd--issueLicence").value="true",t()})}}})});var se=document.getElementById("is-void-transaction-button");se&&se.addEventListener("click",function(){if(o)cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning");else{var e=(-1*parseFloat(se.getAttribute("data-transaction-amount"))).toFixed(2);cityssm.confirmModal("Void Transaction?","<strong>Are you sure you want to void this transaction?</strong><br />If the history of this transaction should be maintained, it may be preferred to create a new transaction for $ "+e+".","Void Transaction","warning",function(){cityssm.postJSON("/licences/doVoidTransaction",{licenceID:n,transactionIndex:se.getAttribute("data-transaction-index")},function(e){e.success&&window.location.reload(!0)})})}})}if(!a){var ce=document.getElementById("is-unissue-licence-button");if(ce)ce.addEventListener("click",function(){cityssm.confirmModal("Unissue Licence?","Are you sure you want to unissue this lottery licence?","Yes, Unissue","danger",function(){cityssm.postJSON("/licences/doUnissueLicence",{licenceID:n},function(e){e.success&&window.location.reload(!0)})})});else{var oe=function(){o?cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning"):cityssm.confirmModal("Issue Licence?","Are you sure you want to issue this lottery licence?","Yes, Issue","success",function(){cityssm.postJSON("/licences/doIssueLicence",{licenceID:n},function(e){e.success&&window.location.reload(!0)})})};document.getElementById("is-issue-licence-button").addEventListener("click",oe),document.getElementById("is-not-issued-tag").addEventListener("dblclick",oe)}}}();