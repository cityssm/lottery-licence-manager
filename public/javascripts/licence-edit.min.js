"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementById("form--licence"),t=document.getElementById("container--form-message"),n=document.getElementById("licence--licenceID").value,i=""===n,a="true"===e.getAttribute("data-licence-is-issued"),s=["number","date","time"];let o=!1,c=!1;const l=document.getElementById("container--events");e.addEventListener("submit",n=>{n.preventDefault(),0!==l.getElementsByTagName("input").length?(t.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON("/licences/doSave",e,e=>{if(e.success&&(cityssm.disableNavBlocker(),c=!1),e.success&&i)window.location.href="/licences/"+e.licenceID.toString()+"/edit";else if(e.success&&o)window.location.reload(!0);else{t.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger");const n=document.getElementsByClassName("is-removed-after-save");for(const e of n)e.remove()}})):cityssm.alertModal("Event Date Error","Please ensure there is at least one event date.","OK","warning")}),i||document.getElementById("is-delete-licence-button").addEventListener("click",e=>{e.preventDefault();cityssm.confirmModal("Delete Licence?","Are you sure you want to delete this licence and all events associated with it?","Yes, Delete","danger",()=>{cityssm.postJSON("/licences/doDelete",{licenceID:n},e=>{e.success&&(cityssm.disableNavBlocker(),window.location.href="/licences")})})});const d=()=>{o=!0},r=e=>{if(cityssm.enableNavBlocker(),c=!0,t.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>',i||(document.getElementById("is-add-transaction-button").setAttribute("disabled","disabled"),document.getElementById("is-disabled-transaction-message").classList.remove("is-hidden")),e){const t=e.currentTarget instanceof HTMLInputElement?e.currentTarget.type:"";s.includes(t)&&d()}},u=e.querySelectorAll("input, select, textarea");for(const e of u)""!==e.name&&e.addEventListener("change",r);const m=document.getElementById("is-external-licence-number-unlock-button");m&&m.addEventListener("click",()=>{const e=document.getElementById("licence--externalLicenceNumber");e.classList.remove("is-readonly"),e.removeAttribute("readonly"),e.focus()});{let e,t,n,i=[];const a=t=>{t.preventDefault();const n=t.currentTarget;document.getElementById("licence--organizationID").value=n.getAttribute("data-organization-id"),document.getElementById("licence--organizationName").value=n.getAttribute("data-organization-name"),e(),r()},s=()=>{const e=document.createElement("div");e.className="panel";const s=t.value.trim().toLowerCase().split(" ");let o=10;for(const t of i){if(o<0)break;let n=!0;if(!t.isEligibleForLicences)continue;const i=t.organizationName.toLowerCase();for(const e of s)if(!i.includes(e)){n=!1;break}if(n){o-=1;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-organization-id",t.organizationID.toString()),n.setAttribute("data-organization-name",t.organizationName),n.setAttribute("href","#"),n.innerHTML=t.organizationName+'<br /><span class="is-size-7"><span class="icon"><i class="fas fa-user" aria-hidden="true"></i></span> '+t.representativeName+"</span>",n.addEventListener("click",a),e.appendChild(n)}}cityssm.clearElement(n),n.insertAdjacentElement("beforeend",e)},o=()=>{cityssm.openHtmlModal("licence-organizationLookup",{onshow(){(t=document.getElementById("organizationLookup--searchStr")).addEventListener("keyup",s),n=document.getElementById("container--organizationLookup"),0===i.length?cityssm.postJSON("/organizations/doGetAll",null,e=>{i=e,t.removeAttribute("disabled"),s(),t.focus()}):(t.removeAttribute("disabled"),s(),t.focus())},onshown(n,i){e=i,t.focus()},onremoved(){document.getElementById("is-organization-lookup-button").focus()}})};document.getElementById("is-organization-lookup-button").addEventListener("click",o),document.getElementById("licence--organizationName").addEventListener("dblclick",o)}let p=[];const y=e=>{0===p.length?cityssm.postJSON("/locations/doGetLocations",null,t=>{p=t.locations,e()}):e()};{let e,t,n;const i=(e,t)=>{document.getElementById("licence--locationID").value=e,document.getElementById("licence--locationDisplayName").value=t},a=t=>{t.preventDefault();const n=t.currentTarget;i(n.getAttribute("data-location-id"),n.getAttribute("data-location-display-name")),e(),r()},s=()=>{const e=document.createElement("div");e.className="panel";const i=t.value.trim().toLowerCase().split(" ");let s=10;for(const t of p){if(s<=0)break;let n=!0;const o=t.locationName.toLowerCase();for(const e of i)if(!o.includes(e)){n=!1;break}if(n){s-=1;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-id",t.locationID.toString()),n.setAttribute("data-location-display-name",t.locationDisplayName),n.setAttribute("href","#"),n.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(t.locationDisplayName)+"</div>"+(""===t.locationName?"":'<div class="column">'+cityssm.escapeHTML(t.locationAddress1)+"</div>")+"</div>",n.addEventListener("click",a),e.insertAdjacentElement("beforeend",n)}}cityssm.clearElement(n),n.insertAdjacentElement("beforeend",e)},o=()=>{cityssm.openHtmlModal("licence-locationLookup",{onshow(a){(t=document.getElementById("locationLookup--searchStr")).addEventListener("keyup",s),n=document.getElementById("container--locationLookup"),y(()=>{t.removeAttribute("disabled"),s(),t.focus()}),llm.getDefaultConfigProperty("city",e=>{e&&(document.getElementById("newLocation--locationCity").value=e)}),llm.getDefaultConfigProperty("province",e=>{e&&(document.getElementById("newLocation--locationProvince").value=e)}),document.getElementById("form--newLocation").addEventListener("submit",t=>{t.preventDefault(),cityssm.postJSON("/locations/doCreate",t.currentTarget,t=>{t.success&&(p=[],i(t.locationID,t.locationDisplayName),e())})}),llm.initializeTabs(a.querySelector(".tabs ul"))},onshown(n,i){e=i,t.focus()},onremoved(){document.getElementById("is-location-lookup-button").focus()}})};document.getElementById("is-location-lookup-button").addEventListener("click",o),document.getElementById("licence--locationDisplayName").addEventListener("dblclick",o)}{let e=[];const t=document.getElementById("is-termsConditions-lookup-modal"),n=document.getElementById("container--termsConditionsPrevious"),i=n=>{n.preventDefault();const i=parseInt(n.currentTarget.getAttribute("data-terms-conditions-index"),10),a=document.getElementById("licence--termsConditions");a.value=e[i].termsConditions,cityssm.hideModal(t),a.focus(),r()};document.getElementById("is-termsConditions-lookup-button").addEventListener("click",()=>{e=[],cityssm.clearElement(n);const a=document.getElementById("licence--organizationID").value;""!==a?(n.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br />Loading previously used terms and conditions...</p>',cityssm.postJSON("/licences/doGetDistinctTermsConditions",{organizationID:a},t=>{if(0===(e=t).length)n.innerHTML='<p class="has-text-centered">No previously used terms and conditions found for this organization.</p>';else{const t=document.createElement("div");t.className="panel mb-3",e.forEach((e,n)=>{const a=document.createElement("a");a.className="panel-block is-block",a.setAttribute("data-terms-conditions-index",n.toString()),a.innerHTML='<p class="has-newline-chars">'+cityssm.escapeHTML(e.termsConditions)+'</p><p class="has-text-right">'+(e.termsConditionsCount>1?'<span class="tag is-light">Used '+e.termsConditionsCount.toString()+" times</span>":"")+'<span class="tag is-info has-tooltip-left" data-tooltip="Most Recent Licence Start Date">'+e.startDateMaxString+"</span></p>",a.addEventListener("click",i),t.insertAdjacentElement("beforeend",a)}),cityssm.clearElement(n),n.insertAdjacentElement("beforeend",t)}}),cityssm.showModal(t)):cityssm.alertModal("No Organization Selected","An organization must be selected before the previously used terms and conditions can be retrieved.","OK","warning")});const a=t.getElementsByClassName("is-close-modal-button");for(const e of a)e.addEventListener("click",cityssm.hideModal)}const g=document.getElementById("licence--licenceTypeKey");if(i){const e=document.getElementsByClassName("container-licenceTypeFields"),t=()=>{const t=g.selectedOptions[0],n=t.getAttribute("data-total-prize-value-max");document.getElementById("licence--totalPrizeValue").setAttribute("max",n);const i="true"===t.getAttribute("data-has-ticket-types"),a=document.getElementById("licence--totalPrizeValue");if(i)document.getElementById("is-ticket-types-panel").classList.remove("is-hidden"),a.setAttribute("readonly","readonly"),a.classList.add("is-readonly");else{const e=document.getElementById("is-ticket-types-panel");e.classList.add("is-hidden"),cityssm.clearElement(e.getElementsByTagName("tbody")[0]),cityssm.clearElement(e.getElementsByTagName("tfoot")[0]),a.removeAttribute("readonly"),a.classList.remove("is-readonly")}const s="container-licenceTypeFields--"+g.value;for(const t of e)t.id===s?(t.removeAttribute("disabled"),t.classList.remove("is-hidden")):(t.classList.add("is-hidden"),t.setAttribute("disabled","disabled"))};g.addEventListener("change",t)}{const e=document.getElementById("licence--startDateString"),t=document.getElementById("licence--endDateString"),n=()=>{const n=e.value;t.setAttribute("min",n),t.value<n&&(t.value=n);const i=l.getElementsByTagName("input");for(const e of i)e.setAttribute("min",n)},i=()=>{const e=t.value,n=l.getElementsByTagName("input");for(const t of n)t.setAttribute("max",e)};document.getElementById("licence--applicationDateString").addEventListener("change",t=>{e.setAttribute("min",t.currentTarget.value)}),e.addEventListener("change",n),t.addEventListener("change",i);const a=e=>{e.currentTarget.closest(".panel-block").remove(),o=!0,r()},s=n=>{let i="";if(n)if(n instanceof Date)i=n.getFullYear().toString()+"-"+("00"+(n.getMonth()+1).toString()).slice(-2)+"-"+("00"+n.getDate().toString()).slice(-2);else if(n.constructor===String)i=n;else if(n instanceof Event)try{n.preventDefault();const e=n.currentTarget.getAttribute("data-source");i=document.getElementById(e).value}catch(e){}l.insertAdjacentHTML("beforeend",'<div class="panel-block is-block"><div class="field has-addons"><div class="control is-expanded has-icons-left"><input class="input is-small" name="eventDate" type="date" value="'+i+'" min="'+e.value+'" max="'+t.value+'" required /><span class="icon is-left"><i class="fas fa-calendar" aria-hidden="true"></i></span></div><div class="control"><a class="button is-small is-danger has-tooltip-right" role="button" data-tooltip="Remove Event"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Remove Event</span></a></div></div></div>');const s=l.getElementsByTagName("a");s[s.length-1].addEventListener("click",a),o=!0,r()},c=document.getElementById("is-event-calculator-modal");document.getElementsByClassName("is-calculate-events-button")[0].addEventListener("click",()=>{const n=parseInt(document.getElementById("eventCalc--eventCount").value,10),i=parseInt(document.getElementById("eventCalc--dayInterval").value,10);let a=t.value.split("-");const o=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10));a=e.value.split("-");const l=new Date(parseInt(a[0],10),parseInt(a[1],10)-1,parseInt(a[2],10));for(let e=0;e<n&&l.getTime()<=o.getTime();e+=1)s(l),l.setDate(l.getDate()+i);cityssm.hideModal(c)}),document.getElementById("is-event-calculator-button").addEventListener("click",()=>{cityssm.showModal(c)});const d=c.getElementsByClassName("is-close-modal-button");for(const e of d)e.addEventListener("click",cityssm.hideModal);const u=document.getElementsByClassName("is-add-event-button");for(const e of u)e.addEventListener("click",s)}const v=document.getElementById("is-ticket-types-panel");if(v){const t=new Map,n=e=>{const n=g.value;t.has(n)?e(t.get(n)):cityssm.postJSON("/licences/doGetTicketTypes",{licenceTypeKey:n},i=>{t.set(n,i),e(i)})},a=()=>{let e=0;const t=v.getElementsByClassName("is-total-prizes-per-deal");for(const n of t)e+=parseFloat(n.value);let n=0;const i=v.getElementsByClassName("is-licence-fee");for(const e of i)n+=parseFloat(e.value);v.getElementsByTagName("tfoot")[0].innerHTML='<tr><td></td><td></td><td></td><th class="has-text-right is-nowrap">$ '+e.toFixed(2)+'</th><td class="is-hidden-print"></td><th class="has-text-right is-nowrap">$ '+n.toFixed(2)+'</th><td></td><td class="is-hidden-print"></td><td></td><td class="is-hidden-print"></td></tr>',document.getElementById("licence--totalPrizeValue").value=e.toFixed(2)},s=t=>{const n=t.currentTarget.closest("tr"),s=n.getAttribute("data-ticket-type");cityssm.confirmModal("Delete Ticket Type?","Are you sure you want to remove the "+s+" ticket type for this licence?","Yes, Delete","danger",()=>{if(n.remove(),!i){const t=e.querySelector("input[name='ticketType_toAdd'][value='"+s+"']");t?t.remove():e.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketType_toDelete" type="hidden" value="'+s+'" />')}a(),r(),d()})},o=e=>{const t=e.currentTarget.closest("tr"),i=t.getAttribute("data-ticket-type");let s,o;const c=e=>{e.preventDefault();const n=parseInt(document.getElementById("amendUnit_unitCount").value,10),i=t.querySelector("input[name='ticketType_unitCount']");i.value=n.toString(),i.nextElementSibling.innerText=n.toString();const c=t.getElementsByClassName("is-total-value-per-deal")[0];c.value=(s.ticketPrice*s.ticketCount*n).toFixed(2),c.nextElementSibling.innerText="$"+(s.ticketPrice*s.ticketCount*n).toFixed(2);const l=t.getElementsByClassName("is-total-prizes-per-deal")[0];l.value=(s.prizesPerDeal*n).toFixed(2),l.nextElementSibling.innerText="$"+(s.prizesPerDeal*n).toFixed(2);const u=document.getElementById("amendUnit_licenceFee").value,m=t.querySelector("input[name='ticketType_licenceFee']");m.value=u,m.nextElementSibling.innerText="$ "+u,o(),a(),r(),d()},l=()=>{document.getElementById("amendUnit_licenceFee").value=(s.feePerUnit*parseInt(document.getElementById("amendUnit_unitCount").value,10)).toFixed(2)};cityssm.openHtmlModal("licence-ticketTypeUnitAmend",{onshow(e){document.getElementById("amendUnit_ticketType").value=i;const a=t.querySelector("input[name='ticketType_unitCount']").value;document.getElementById("amendUnit_unitCountCurrent").value=a;const o=document.getElementById("amendUnit_unitCount");o.value=a,n(e=>{s=e.find(e=>e.ticketType===i),o.addEventListener("change",l),l()}),e.getElementsByTagName("form")[0].addEventListener("submit",c)},onshown(e,t){o=t}})},c=e=>{let t;const n=e.currentTarget.closest("td").previousElementSibling,i=e=>{const i=e.currentTarget;n.getElementsByTagName("input")[0].value=i.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=i.getAttribute("data-location-display-name"),t(),r()};cityssm.openHtmlModal("licence-distributorLookup",{onshow(){y(()=>{const e=document.createElement("div");e.className="panel";for(const t of p){if(!t.locationIsDistributor)continue;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-id",t.locationID.toString()),n.setAttribute("data-location-display-name",t.locationDisplayName),n.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(t.locationDisplayName)+"</div>"+(""===t.locationName?"":'<div class="column">'+cityssm.escapeHTML(t.locationAddress1)+"</div>")+"</div>",n.addEventListener("click",i),e.insertAdjacentElement("beforeend",n)}const t=document.getElementById("container--distributorLookup");cityssm.clearElement(t),t.insertAdjacentElement("beforeend",e)})},onshown(e,n){t=n}})},l=e=>{let t;const n=e.currentTarget.closest("td").previousElementSibling,i=e=>{const i=e.currentTarget;n.getElementsByTagName("input")[0].value=i.getAttribute("data-location-id"),n.getElementsByTagName("span")[0].innerText=i.getAttribute("data-location-display-name"),t(),r()};cityssm.openHtmlModal("licence-manufacturerLookup",{onshow(){y(()=>{const e=document.createElement("div");e.className="panel";for(const t of p){if(!t.locationIsManufacturer)continue;const n=document.createElement("a");n.className="panel-block is-block",n.setAttribute("data-location-id",t.locationID.toString()),n.setAttribute("data-location-display-name",t.locationDisplayName),n.innerHTML='<div class="columns"><div class="column is-narrow"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></div><div class="column">'+cityssm.escapeHTML(t.locationDisplayName)+"</div>"+(""===t.locationName?"":'<div class="column">'+cityssm.escapeHTML(t.locationAddress1)+"</div>")+"</div>",n.addEventListener("click",i),e.insertAdjacentElement("beforeend",n)}const t=document.getElementById("container--manufacturerLookup");cityssm.clearElement(t),t.insertAdjacentElement("beforeend",e)})},onshown(e,n){t=n}})},u=()=>{let t,a,s;const o=n=>{n.preventDefault(),m({ticketType:document.getElementById("ticketTypeAdd--ticketType").value,unitCount:parseInt(document.getElementById("ticketTypeAdd--unitCount").value,10),valuePerDeal:parseFloat(document.getElementById("ticketTypeAdd--valuePerDeal").value),prizesPerDeal:parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value),licenceFee:parseFloat(document.getElementById("ticketTypeAdd--licenceFee").value)}),i||e.insertAdjacentHTML("beforeend",'<input class="is-removed-after-save" name="ticketType_toAdd" type="hidden" value="'+document.getElementById("ticketTypeAdd--ticketType").value+'" />'),t()},c=()=>{const e=parseInt(s.value,10);document.getElementById("ticketTypeAdd--prizesTotal").value=(parseFloat(document.getElementById("ticketTypeAdd--prizesPerDeal").value)*e).toFixed(2),document.getElementById("ticketTypeAdd--licenceFee").value=(parseFloat(document.getElementById("ticketTypeAdd--feePerUnit").value)*e).toFixed(2)},l=()=>{const e=a.selectedOptions[0];document.getElementById("ticketTypeAdd--ticketPrice").value=e.getAttribute("data-ticket-price"),document.getElementById("ticketTypeAdd--ticketCount").value=e.getAttribute("data-ticket-count"),document.getElementById("ticketTypeAdd--valuePerDeal").value=(parseFloat(e.getAttribute("data-ticket-price"))*parseInt(e.getAttribute("data-ticket-count"),10)).toFixed(2),document.getElementById("ticketTypeAdd--prizesPerDeal").value=e.getAttribute("data-prizes-per-deal"),document.getElementById("ticketTypeAdd--feePerUnit").value=e.getAttribute("data-fee-per-unit"),c()},d=e=>{if(!e||0===e.length)return t(),void cityssm.alertModal("No ticket types available","","OK","danger");for(const t of e){if(v.querySelector("tr[data-ticket-type='"+t.ticketType+"']"))continue;const e=document.createElement("option");e.setAttribute("data-ticket-price",t.ticketPrice.toFixed(2)),e.setAttribute("data-ticket-count",t.ticketCount.toString()),e.setAttribute("data-prizes-per-deal",t.prizesPerDeal.toFixed(2)),e.setAttribute("data-fee-per-unit",(t.feePerUnit||0).toFixed(2)),e.value=t.ticketType,e.innerText=t.ticketType+" ("+t.ticketCount.toString()+" tickets, $"+t.ticketPrice.toFixed(2)+" each)",a.insertAdjacentElement("beforeend",e)}l()};cityssm.openHtmlModal("licence-ticketTypeAdd",{onshow(e){(a=document.getElementById("ticketTypeAdd--ticketType")).addEventListener("change",l),(s=document.getElementById("ticketTypeAdd--unitCount")).addEventListener("change",c),e.getElementsByTagName("form")[0].addEventListener("submit",o)},onshown(e,i){t=i,n(d)}})},m=e=>{const t=e.ticketType,n=document.createElement("tr");n.setAttribute("data-ticket-type",t),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_ticketType" type="hidden" value="'+t+'" /><span>'+t+"</span></td>");const i=e.unitCount;n.insertAdjacentHTML("beforeend",'<td class="has-text-right"><input name="ticketType_unitCount" type="hidden" value="'+i.toString()+'" /><span>'+i.toString()+"</span></td>");const u=e.valuePerDeal,m=(u*i).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><span data-tooltip="$'+u.toFixed(2)+' value per deal">$ '+m+"</span></td>");const p=e.prizesPerDeal,y=(p*i).toFixed(2);n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-total-prizes-per-deal" type="hidden" value="'+y.toString()+'" /><span data-tooltip="$'+p.toFixed(2)+' prizes per deal">$'+y+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td class="is-hidden-print"><div class="field has-addons"><div class="control"><button class="button is-small is-amend-ticket-type-unit-count-button" data-tooltip="Amend Units" type="button">Amend</button></div><div class="control"><button class="button is-small is-danger is-delete-ticket-type-button" data-tooltip="Delete Ticket Type" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></div></td>'),n.getElementsByClassName("is-amend-ticket-type-unit-count-button")[0].addEventListener("click",o),n.getElementsByClassName("is-delete-ticket-type-button")[0].addEventListener("click",s);const g=e.licenceFee;n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-nowrap"><input class="is-licence-fee" name="ticketType_licenceFee" type="hidden" value="'+g.toString()+'" /><span>$'+g.toFixed(2)+"</span></td>"),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_manufacturerLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-manufacturer-button" data-tooltip="Change Manufacturer" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Manufacturer</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-manufacturer-button")[0].addEventListener("click",l),n.insertAdjacentHTML("beforeend",'<td><input name="ticketType_distributorLocationID" type="hidden" value="" /><span><span class="has-text-grey">(Not Set)</span><span></td>'),n.insertAdjacentHTML("beforeend",'<td class="has-text-right is-hidden-print"><button class="button is-small is-amend-ticket-type-distributor-button" data-tooltip="Change Distributor" type="button"><i class="fas fa-pencil-alt" aria-hidden="true"></i><span class="sr-only">Change Distributor</span></button></td>'),n.getElementsByClassName("is-amend-ticket-type-distributor-button")[0].addEventListener("click",c),v.getElementsByTagName("tbody")[0].insertAdjacentElement("afterbegin",n),a(),r(),d()};a(),document.getElementById("is-add-ticket-type-button").addEventListener("click",u);const E=v.getElementsByClassName("is-amend-ticket-type-unit-count-button");for(const e of E)e.addEventListener("click",o);const f=v.getElementsByClassName("is-delete-ticket-type-button");for(const e of f)e.addEventListener("click",s);const b=v.getElementsByClassName("is-amend-ticket-type-distributor-button");for(const e of b)e.addEventListener("click",c);const k=v.getElementsByClassName("is-amend-ticket-type-manufacturer-button");for(const e of k)e.addEventListener("click",l)}if(!i){const e=document.getElementById("is-update-expected-licence-fee-button");e&&e.addEventListener("click",()=>{const t=document.getElementById("licence--licenceFee");t.value=e.getAttribute("data-licence-fee-expected"),t.classList.remove("is-danger"),t.closest(".field").getElementsByClassName("help")[0].remove(),e.remove(),r(),d()}),document.getElementById("is-add-transaction-button").addEventListener("click",()=>{let e;const t=t=>{t&&t.preventDefault(),cityssm.postJSON("/licences/doAddTransaction",e,e=>{e.success&&window.location.reload(!0)})};cityssm.openHtmlModal("licence-transactionAdd",{onshow(i){llm.getDefaultConfigProperty("externalReceiptNumber_fieldLabel",e=>{i.querySelector("label[for='transactionAdd--externalReceiptNumber']").innerText=e}),document.getElementById("transactionAdd--licenceID").value=n;const s=parseFloat(document.getElementById("licence--licenceFee").value),o=document.getElementById("licence--transactionTotal"),c=parseFloat(o?o.innerText:"0");document.getElementById("transactionAdd--licenceFee").innerText=s.toFixed(2),document.getElementById("transactionAdd--transactionTotal").innerText=c.toFixed(2);const l=(s-c).toFixed(2);if(document.getElementById("transactionAdd--discrepancy").innerText=l,document.getElementById("transactionAdd--transactionAmount").value=l,(e=i.getElementsByTagName("form")[0]).addEventListener("submit",t),!a){const e=document.getElementById("is-add-transaction-issue-licence-button");e.classList.remove("is-hidden"),e.addEventListener("click",()=>{document.getElementById("transactionAdd--issueLicence").value="true",t()})}}})});const t=document.getElementById("is-void-transaction-button");t&&t.addEventListener("click",()=>{if(c)return void cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning");const e=(-1*parseFloat(t.getAttribute("data-transaction-amount"))).toFixed(2);cityssm.confirmModal("Void Transaction?","<strong>Are you sure you want to void this transaction?</strong><br />If the history of this transaction should be maintained, it may be preferred to create a new transaction for $ "+e+".","Void Transaction","warning",()=>{cityssm.postJSON("/licences/doVoidTransaction",{licenceID:n,transactionIndex:t.getAttribute("data-transaction-index")},e=>{e.success&&window.location.reload(!0)})})})}if(!i){const e=document.getElementById("is-unissue-licence-button");if(e)e.addEventListener("click",()=>{cityssm.confirmModal("Unissue Licence?","Are you sure you want to unissue this lottery licence?","Yes, Unissue","danger",()=>{cityssm.postJSON("/licences/doUnissueLicence",{licenceID:n},e=>{e.success&&window.location.reload(!0)})})});else{const e=()=>{const e=()=>{cityssm.postJSON("/licences/doIssueLicence",{licenceID:n},e=>{e.success&&window.location.reload(!0)})};c?cityssm.alertModal("Unsaved Changes","Please save all unsaved changes before issuing this licence.","OK","warning"):cityssm.confirmModal("Issue Licence?","Are you sure you want to issue this lottery licence?","Yes, Issue","success",e)};document.getElementById("is-issue-licence-button").addEventListener("click",e),document.getElementById("is-not-issued-tag").addEventListener("dblclick",e)}}})();