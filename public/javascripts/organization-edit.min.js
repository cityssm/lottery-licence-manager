"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.querySelector("main").dataset.urlPrefix,t=document.querySelector("#form--organization"),n=document.querySelector("#container--form-message"),a=document.querySelector("#organization--organizationID").value,s=""===a,r=""===a?void 0:Number.parseInt(a,10);if(t.addEventListener("submit",a=>{a.preventDefault(),n.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(e+"/organizations/doSave",t,t=>{t.success&&cityssm.disableNavBlocker(),t.success&&s?window.location.href=e+"/organizations/"+t.organizationID.toString()+"/edit":(n.innerHTML="",cityssm.alertModal(t.message,"","OK",t.success?"success":"danger"))})}),!s){const n=()=>{cityssm.postJSON(e+"/organizations/doDelete",{organizationID:r},t=>{t.success&&(window.location.href=e+"/organizations")})};t.querySelector(".is-delete-button").addEventListener("click",()=>{cityssm.confirmModal("Delete Organization?","Are you sure you want to delete this organization?<br />Note that any active licences issued to this organization will remain active.","Yes, Delete Organization","warning",n)}),t.querySelector(".is-rollforward-button").addEventListener("click",()=>{let t,n,s=!1;const r=a=>{a.preventDefault(),s||(s=!0,cityssm.postJSON(e+"/organizations/doRollForward",n,e=>{e.success?window.location.reload():(s=!1,t(),cityssm.alertModal("Roll Forward Failed",e.message,"OK","danger"))}))};cityssm.openHtmlModal("organization-rollforward",{onshown:(e,s)=>{t=s,document.querySelector("#rollforward--organizationID").value=a,(n=document.querySelector("#form--rollforward")).addEventListener("submit",r)}})});const s=document.querySelector(".is-representative-table tbody"),i=()=>{0===s.querySelectorAll("tr").length&&(s.innerHTML='<tr class="has-background-warning is-empty-warning"><td class="has-text-centered" colspan="6"><strong>There are no representatives associated with this organization.</strong></td></tr>')};i();const d=t=>{const n=t.currentTarget.value;cityssm.postJSON(e+"/organizations/"+a+"/doSetDefaultRepresentative",{isDefaultRepresentativeIndex:n},()=>{})},o=s.querySelectorAll("input");for(const e of o)e.addEventListener("change",d);const l=t=>{t.preventDefault();const n=t.currentTarget.closest("tr"),s=n.getAttribute("data-representative-name");cityssm.confirmModal("Delete a Representative?",`<p>Are you sure you want to delete the representative "${cityssm.escapeHTML(s)}"?</p>`,"Yes, Delete","danger",()=>{cityssm.postJSON(e+"/organizations/"+a+"/doDeleteOrganizationRepresentative",{representativeIndex:n.getAttribute("data-representative-index")},e=>{e.success&&(n.remove(),i())})})},c=s.querySelectorAll(".is-delete-representative-button");for(const e of c)e.addEventListener("click",l);const m=document.querySelector(".is-edit-representative-modal"),u=m.getElementsByTagName("form")[0];let p;const v=e=>{const t=(p=e.currentTarget.closest("tr")).getAttribute("data-representative-index");document.getElementById("editOrganizationRepresentative--representativeIndex").value=t,document.getElementById("editOrganizationRepresentative--representativeName").value=p.getAttribute("data-representative-name"),document.getElementById("editOrganizationRepresentative--representativeTitle").value=p.getAttribute("data-representative-title"),document.getElementById("editOrganizationRepresentative--representativeAddress1").value=p.getAttribute("data-representative-address-1"),document.getElementById("editOrganizationRepresentative--representativeAddress2").value=p.getAttribute("data-representative-address-2"),document.getElementById("editOrganizationRepresentative--representativeCity").value=p.getAttribute("data-representative-city"),document.getElementById("editOrganizationRepresentative--representativeProvince").value=p.getAttribute("data-representative-province"),document.getElementById("editOrganizationRepresentative--representativePostalCode").value=p.getAttribute("data-representative-postal-code"),document.getElementById("editOrganizationRepresentative--representativePhoneNumber").value=p.getAttribute("data-representative-phone-number"),document.getElementById("editOrganizationRepresentative--representativePhoneNumber2").value=p.getAttribute("data-representative-phone-number-2"),document.getElementById("editOrganizationRepresentative--representativeEmailAddress").value=p.getAttribute("data-representative-email-address"),document.getElementById("editOrganizationRepresentative--isDefault").value=document.getElementById("representative-isDefault--"+t).checked?"1":"0",cityssm.showModal(m)},g=e=>{const t=document.createElement("tr");t.setAttribute("data-representative-index",e.representativeIndex.toString()),t.setAttribute("data-representative-name",e.representativeName),t.setAttribute("data-representative-title",e.representativeTitle),t.setAttribute("data-representative-address-1",e.representativeAddress1),t.setAttribute("data-representative-address-2",e.representativeAddress2),t.setAttribute("data-representative-city",e.representativeCity),t.setAttribute("data-representative-province",e.representativeProvince),t.setAttribute("data-representative-postal-code",e.representativePostalCode),t.setAttribute("data-representative-phone-number",e.representativePhoneNumber),t.setAttribute("data-representative-phone-number-2",e.representativePhoneNumber2),t.setAttribute("data-representative-email-address",e.representativeEmailAddress),t.insertAdjacentHTML("beforeend",'<td><div class="field"><input class="is-checkradio is-info" id="representative-isDefault--'+e.representativeIndex.toString()+'" name="representative-isDefault" type="radio"'+(e.isDefault?" checked":"")+' />&nbsp;<label for="representative-isDefault--'+e.representativeIndex.toString()+'"></label></div></td>'),t.getElementsByTagName("input")[0].addEventListener("change",d);let n=document.createElement("td");n.innerHTML=cityssm.escapeHTML(e.representativeName)+"<br /><small>"+cityssm.escapeHTML(e.representativeTitle)+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=cityssm.escapeHTML(e.representativeAddress1)+"<br /><small>"+(""===e.representativeAddress2?"":cityssm.escapeHTML(e.representativeAddress2)+"<br />")+cityssm.escapeHTML(e.representativeCity)+", "+cityssm.escapeHTML(e.representativeProvince)+"<br />"+cityssm.escapeHTML(e.representativePostalCode)+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=cityssm.escapeHTML(e.representativePhoneNumber)+"<br />"+cityssm.escapeHTML(e.representativePhoneNumber2),t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=cityssm.escapeHTML(e.representativeEmailAddress),t.insertAdjacentElement("beforeend",n),t.insertAdjacentHTML("beforeend",'<td><div class="buttons is-right has-addons"><button class="button is-small is-edit-representative-button" data-tooltip="Edit Representative" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-representative-button" data-tooltip="Delete Representative" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></td>'),t.getElementsByClassName("is-edit-representative-button")[0].addEventListener("click",v),t.getElementsByClassName("is-delete-representative-button")[0].addEventListener("click",l),s.insertAdjacentElement("beforeend",t)},y=s.getElementsByClassName("is-edit-representative-button");for(const e of y)e.addEventListener("click",v);let b=m.getElementsByClassName("is-cancel-button");for(const e of b)e.addEventListener("click",cityssm.hideModal);u.addEventListener("submit",t=>{t.preventDefault(),cityssm.postJSON(e+"/organizations/"+a+"/doEditOrganizationRepresentative",t.currentTarget,e=>{e.success&&(p.remove(),p=null,g(e.organizationRepresentative),cityssm.hideModal(m))})});const E=document.getElementsByClassName("is-add-representative-modal")[0],f=E.getElementsByTagName("form")[0];document.getElementsByClassName("is-add-representative-button")[0].addEventListener("click",()=>{f.reset(),cityssm.showModal(E),document.getElementById("addOrganizationRepresentative--representativeName").focus()}),b=E.getElementsByClassName("is-cancel-button");for(const e of b)e.addEventListener("click",cityssm.hideModal);f.addEventListener("submit",t=>{t.preventDefault(),cityssm.postJSON(e+"/organizations/"+a+"/doAddOrganizationRepresentative",t.currentTarget,e=>{if(e.success){const t=s.getElementsByClassName("is-empty-warning");t.length>0&&t[0].remove(),g(e.organizationRepresentative),cityssm.hideModal(E)}})}),E.getElementsByClassName("is-copy-organization-address-button")[0].addEventListener("click",e=>{e.preventDefault(),document.getElementById("addOrganizationRepresentative--representativeAddress1").value=document.getElementById("organization--organizationAddress1").value,document.getElementById("addOrganizationRepresentative--representativeAddress2").value=document.getElementById("organization--organizationAddress2").value,document.getElementById("addOrganizationRepresentative--representativeCity").value=document.getElementById("organization--organizationCity").value,document.getElementById("addOrganizationRepresentative--representativeProvince").value=document.getElementById("organization--organizationProvince").value,document.getElementById("addOrganizationRepresentative--representativePostalCode").value=document.getElementById("organization--organizationPostalCode").value});const h=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.deleteReminder(r,n,!0,e=>{e.success&&t.closest("tr").remove()})},z=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.dismissReminder(r,n,!0,e=>{e.success&&llm.organizationReminders.loadReminderTypeCache(()=>{const n=t.closest("tr"),a=B(e.reminder);n.insertAdjacentElement("afterend",a),n.remove()})})},A=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.openEditReminderModal(r,n,e=>{const n=t.closest("tr"),a=B(e);n.insertAdjacentElement("afterend",a),n.remove()})},B=e=>{const t=llm.organizationReminders.getReminderType(e.reminderTypeKey),n=document.createElement("tr");let a="";return a=""===e.dueDateString?'<span class="has-text-grey">(No Due Date Set)</span>':""!==e.dismissedDateString?'<span class="has-text-grey is-linethrough">'+e.dueDateString+"</span>":e.dueDateString,n.innerHTML="<td>"+(t?t.reminderType+'<br /><span class="is-size-7">'+t.reminderCategory+"</span>":e.reminderTypeKey)+"</td><td>"+(e.reminderStatus||"")+'</td><td class="has-text-centered">'+(""===e.dismissedDateString?'<span class="has-text-grey">(Active)</span><br /><button class="button is-small is-light is-success is-dismiss-reminder-button mt-1" data-reminder-index="'+e.reminderIndex.toString()+'"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Dismiss</span></button>':e.dismissedDateString)+'</td><td class="has-text-centered">'+a+'</td><td class="is-hidden-print"><div class="buttons is-right has-addons is-hidden-status-view"><button class="button is-small is-edit-reminder-button" data-reminder-index="'+e.reminderIndex.toString()+'" data-tooltip="Edit Reminder" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-reminder-button" data-reminder-index="'+e.reminderIndex.toString()+'" data-tooltip="Delete Reminder" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></td>',""===e.dismissedDateString&&n.getElementsByClassName("is-dismiss-reminder-button")[0].addEventListener("click",z),n.getElementsByClassName("is-edit-reminder-button")[0].addEventListener("click",A),n.getElementsByClassName("is-delete-reminder-button")[0].addEventListener("click",h),n};document.getElementById("is-add-reminder-button").addEventListener("click",e=>{e.preventDefault(),llm.organizationReminders.openAddReminderModal(r,e=>{const t=B(e);document.getElementById("container--reminders").insertAdjacentElement("afterbegin",t)})});const L=document.getElementsByClassName("is-dismiss-reminder-button");for(const e of L)e.addEventListener("click",z);const R=document.getElementsByClassName("is-edit-reminder-button");for(const e of R)e.addEventListener("click",A);const I=document.getElementsByClassName("is-delete-reminder-button");for(const e of I)e.addEventListener("click",h)}const i=()=>{cityssm.enableNavBlocker(),n.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},d=t.querySelectorAll("input, select, textarea");for(const e of d)e.addEventListener("change",i)})();