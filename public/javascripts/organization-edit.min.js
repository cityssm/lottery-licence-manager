"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementById("form--organization"),t=document.getElementById("container--form-message"),n=document.getElementById("organization--organizationID").value,a=""===n,s=""===n?null:parseInt(n,10);if(e.addEventListener("submit",n=>{n.preventDefault(),t.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON("/organizations/doSave",e,e=>{e.success&&cityssm.disableNavBlocker(),e.success&&a?window.location.href="/organizations/"+e.organizationID.toString()+"/edit":(t.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger"))})}),!a){const t=()=>{cityssm.postJSON("/organizations/doDelete",{organizationID:s},e=>{e.success&&(window.location.href="/organizations")})};e.getElementsByClassName("is-delete-button")[0].addEventListener("click",()=>{cityssm.confirmModal("Delete Organization?","Are you sure you want to delete this organization?<br />Note that any active licences issued to this organization will remain active.","Yes, Delete Organization","warning",t)}),e.getElementsByClassName("is-rollforward-button")[0].addEventListener("click",()=>{let e,t,a=!1;const s=n=>{n.preventDefault(),a||(a=!0,cityssm.postJSON("/organizations/doRollForward",t,t=>{t.success?window.location.reload():(a=!1,e(),cityssm.alertModal("Roll Forward Failed",t.message,"OK","danger"))}))};cityssm.openHtmlModal("organization-rollforward",{onshown:(a,i)=>{e=i,document.getElementById("rollforward--organizationID").value=n,(t=document.getElementById("form--rollforward")).addEventListener("submit",s)}})});const a=document.getElementsByClassName("is-representative-table")[0].getElementsByTagName("tbody")[0],i=()=>{0===a.getElementsByTagName("tr").length&&(a.innerHTML='<tr class="has-background-warning is-empty-warning"><td class="has-text-centered" colspan="6"><strong>There are no representatives associated with this organization.</strong></td></tr>')};i();const r=e=>{const t=e.currentTarget.value;cityssm.postJSON("/organizations/"+n+"/doSetDefaultRepresentative",{isDefaultRepresentativeIndex:t},()=>{})},d=a.getElementsByTagName("input");for(const e of d)e.addEventListener("change",r);const o=e=>{e.preventDefault();const t=e.currentTarget.closest("tr"),a=t.getAttribute("data-representative-name");cityssm.confirmModal("Delete a Representative?",`<p>Are you sure you want to delete the representative "${cityssm.escapeHTML(a)}"?</p>`,"Yes, Delete","danger",()=>{cityssm.postJSON("/organizations/"+n+"/doDeleteOrganizationRepresentative",{representativeIndex:t.getAttribute("data-representative-index")},e=>{e.success&&(t.remove(),i())})})},l=a.getElementsByClassName("is-delete-representative-button");for(const e of l)e.addEventListener("click",o);const c=document.getElementsByClassName("is-edit-representative-modal")[0],m=c.getElementsByTagName("form")[0];let u;const p=e=>{const t=(u=e.currentTarget.closest("tr")).getAttribute("data-representative-index");document.getElementById("editOrganizationRepresentative--representativeIndex").value=t,document.getElementById("editOrganizationRepresentative--representativeName").value=u.getAttribute("data-representative-name"),document.getElementById("editOrganizationRepresentative--representativeTitle").value=u.getAttribute("data-representative-title"),document.getElementById("editOrganizationRepresentative--representativeAddress1").value=u.getAttribute("data-representative-address-1"),document.getElementById("editOrganizationRepresentative--representativeAddress2").value=u.getAttribute("data-representative-address-2"),document.getElementById("editOrganizationRepresentative--representativeCity").value=u.getAttribute("data-representative-city"),document.getElementById("editOrganizationRepresentative--representativeProvince").value=u.getAttribute("data-representative-province"),document.getElementById("editOrganizationRepresentative--representativePostalCode").value=u.getAttribute("data-representative-postal-code"),document.getElementById("editOrganizationRepresentative--representativePhoneNumber").value=u.getAttribute("data-representative-phone-number"),document.getElementById("editOrganizationRepresentative--representativeEmailAddress").value=u.getAttribute("data-representative-email-address"),document.getElementById("editOrganizationRepresentative--isDefault").value=document.getElementById("representative-isDefault--"+t).checked?"1":"0",cityssm.showModal(c)},g=e=>{const t=document.createElement("tr");t.setAttribute("data-representative-index",e.representativeIndex.toString()),t.setAttribute("data-representative-name",e.representativeName),t.setAttribute("data-representative-title",e.representativeTitle),t.setAttribute("data-representative-address-1",e.representativeAddress1),t.setAttribute("data-representative-address-2",e.representativeAddress2),t.setAttribute("data-representative-city",e.representativeCity),t.setAttribute("data-representative-province",e.representativeProvince),t.setAttribute("data-representative-postal-code",e.representativePostalCode),t.setAttribute("data-representative-phone-number",e.representativePhoneNumber),t.setAttribute("data-representative-email-address",e.representativeEmailAddress),t.insertAdjacentHTML("beforeend",'<td><div class="field"><input class="is-checkradio is-info" id="representative-isDefault--'+e.representativeIndex.toString()+'" name="representative-isDefault" type="radio"'+(e.isDefault?" checked":"")+' />&nbsp;<label for="representative-isDefault--'+e.representativeIndex.toString()+'"></label></div></td>'),t.getElementsByTagName("input")[0].addEventListener("change",r);let n=document.createElement("td");n.innerHTML=e.representativeName+"<br /><small>"+e.representativeTitle+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativeAddress1+"<br /><small>"+(""===e.representativeAddress2?"":e.representativeAddress2+"<br />")+e.representativeCity+", "+e.representativeProvince+"<br />"+e.representativePostalCode+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativePhoneNumber,t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativeEmailAddress,t.insertAdjacentElement("beforeend",n),t.insertAdjacentHTML("beforeend",'<td><div class="buttons is-right has-addons"><button class="button is-small is-edit-representative-button" data-tooltip="Edit Representative" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-representative-button" data-tooltip="Delete Representative" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></td>'),t.getElementsByClassName("is-edit-representative-button")[0].addEventListener("click",p),t.getElementsByClassName("is-delete-representative-button")[0].addEventListener("click",o),a.insertAdjacentElement("beforeend",t)},v=a.getElementsByClassName("is-edit-representative-button");for(const e of v)e.addEventListener("click",p);let y=c.getElementsByClassName("is-cancel-button");for(const e of y)e.addEventListener("click",cityssm.hideModal);m.addEventListener("submit",e=>{e.preventDefault(),cityssm.postJSON("/organizations/"+n+"/doEditOrganizationRepresentative",e.currentTarget,e=>{e.success&&(u.remove(),u=null,g(e.organizationRepresentative),cityssm.hideModal(c))})});const E=document.getElementsByClassName("is-add-representative-modal")[0],b=E.getElementsByTagName("form")[0];document.getElementsByClassName("is-add-representative-button")[0].addEventListener("click",()=>{b.reset(),cityssm.showModal(E),document.getElementById("addOrganizationRepresentative--representativeName").focus()}),y=E.getElementsByClassName("is-cancel-button");for(const e of y)e.addEventListener("click",cityssm.hideModal);b.addEventListener("submit",e=>{e.preventDefault(),cityssm.postJSON("/organizations/"+n+"/doAddOrganizationRepresentative",e.currentTarget,e=>{if(e.success){const t=a.getElementsByClassName("is-empty-warning");t.length>0&&t[0].remove(),g(e.organizationRepresentative),cityssm.hideModal(E)}})}),E.getElementsByClassName("is-copy-organization-address-button")[0].addEventListener("click",e=>{e.preventDefault(),document.getElementById("addOrganizationRepresentative--representativeAddress1").value=document.getElementById("organization--organizationAddress1").value,document.getElementById("addOrganizationRepresentative--representativeAddress2").value=document.getElementById("organization--organizationAddress2").value,document.getElementById("addOrganizationRepresentative--representativeCity").value=document.getElementById("organization--organizationCity").value,document.getElementById("addOrganizationRepresentative--representativeProvince").value=document.getElementById("organization--organizationProvince").value,document.getElementById("addOrganizationRepresentative--representativePostalCode").value=document.getElementById("organization--organizationPostalCode").value});const f=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.deleteReminder(s,n,!0,e=>{e.success&&t.closest("tr").remove()})},h=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.dismissReminder(s,n,!0,e=>{e.success&&llm.organizationReminders.loadReminderTypeCache(()=>{const n=t.closest("tr"),a=B(e.reminder);n.insertAdjacentElement("afterend",a),n.remove()})})},z=e=>{e.preventDefault();const t=e.currentTarget,n=parseInt(t.getAttribute("data-reminder-index"),10);llm.organizationReminders.openEditReminderModal(s,n,e=>{const n=t.closest("tr"),a=B(e);n.insertAdjacentElement("afterend",a),n.remove()})},B=e=>{const t=llm.organizationReminders.getReminderType(e.reminderTypeKey),n=document.createElement("tr");let a="";return a=""===e.reminderDateString?'<span class="has-text-grey">(No Reminder Set)</span>':""!==e.dismissedDateString?'<span class="has-text-grey is-linethrough">'+e.reminderDateString+"</span>":e.reminderDateString,n.innerHTML="<td>"+(t?t.reminderType+'<br /><span class="is-size-7">'+t.reminderCategory+"</span>":e.reminderTypeKey)+"</td><td>"+(e.reminderStatus||"")+'</td><td class="has-text-centered">'+(""===e.dismissedDateString?'<span class="has-text-grey">(Active)</span><br /><button class="button is-small is-light is-success is-dismiss-reminder-button mt-1" data-reminder-index="'+e.reminderIndex.toString()+'"><span class="icon is-small"><i class="fas fa-check" aria-hidden="true"></i></span><span>Dismiss</span></button>':e.dismissedDateString)+'</td><td class="has-text-centered">'+a+'</td><td class="is-hidden-print"><div class="buttons is-right has-addons is-hidden-status-view"><button class="button is-small is-edit-reminder-button" data-reminder-index="'+e.reminderIndex.toString()+'" data-tooltip="Edit Reminder" type="button"><span class="icon is-small"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-reminder-button" data-reminder-index="'+e.reminderIndex.toString()+'" data-tooltip="Delete Reminder" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></div></td>',""===e.dismissedDateString&&n.getElementsByClassName("is-dismiss-reminder-button")[0].addEventListener("click",h),n.getElementsByClassName("is-edit-reminder-button")[0].addEventListener("click",z),n.getElementsByClassName("is-delete-reminder-button")[0].addEventListener("click",f),n};document.getElementById("is-add-reminder-button").addEventListener("click",e=>{e.preventDefault(),llm.organizationReminders.openAddReminderModal(s,e=>{const t=B(e);document.getElementById("container--reminders").insertAdjacentElement("afterbegin",t)})});const A=document.getElementsByClassName("is-dismiss-reminder-button");for(const e of A)e.addEventListener("click",h);const I=document.getElementsByClassName("is-edit-reminder-button");for(const e of I)e.addEventListener("click",z);const N=document.getElementsByClassName("is-delete-reminder-button");for(const e of N)e.addEventListener("click",f)}const i=()=>{cityssm.enableNavBlocker(),t.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},r=e.querySelectorAll("input, select, textarea");for(const e of r)e.addEventListener("change",i)})();