"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=document.getElementById("form--organization"),t=document.getElementById("container--form-message"),n=document.getElementById("organization--organizationID").value,a=""===n;if(e.addEventListener("submit",function(n){n.preventDefault(),t.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON("/organizations/doSave",e,function(e){e.success&&cityssm.disableNavBlocker(),e.success&&a?window.location.href="/organizations/"+e.organizationID+"/edit":(t.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger"))})}),!a){var i=function(){cityssm.postJSON("/organizations/doDelete",{organizationID:n},function(e){e.success&&(window.location.href="/organizations")})};e.getElementsByClassName("is-delete-button")[0].addEventListener("click",function(){cityssm.confirmModal("Delete Organization?","Are you sure you want to delete this organization?<br />Note that any active licences issued to this organization will remain active.","Yes, Delete Organization","warning",i)});var r=document.getElementsByClassName("is-representative-table")[0].getElementsByTagName("tbody")[0],s=function(){0===r.getElementsByTagName("tr").length&&(r.innerHTML='<tr class="has-background-warning is-empty-warning"><td class="has-text-centered" colspan="6"><strong>There are no representatives associated with this organization.</strong></td></tr>')};s();for(var d=function(e){var t=e.currentTarget.value;cityssm.postJSON("/organizations/"+n+"/doSetDefaultRepresentative",{isDefaultRepresentativeIndex:t},function(){})},o=r.getElementsByTagName("input"),l=0;l<o.length;l+=1)o[l].addEventListener("change",d);var c=function(e){e.preventDefault();var t=e.currentTarget.closest("tr"),a=t.getAttribute("data-representative-name");cityssm.confirmModal("Delete a Representative?",'<p>Are you sure you want to delete the representative "'+a+'"?</p>',"Yes, Delete","danger",function(){cityssm.postJSON("/organizations/"+n+"/doDeleteOrganizationRepresentative",{representativeIndex:t.getAttribute("data-representative-index")},function(e){e.success&&(t.remove(),s())})})},v=r.getElementsByClassName("is-delete-representative-button");for(l=0;l<v.length;l+=1)v[l].addEventListener("click",c);var u,m=document.getElementsByClassName("is-edit-representative-modal")[0],p=m.getElementsByTagName("form")[0],g=function(e){var t=(u=e.currentTarget.closest("tr")).getAttribute("data-representative-index");document.getElementById("editOrganizationRepresentative--representativeIndex").value=t,document.getElementById("editOrganizationRepresentative--representativeName").value=u.getAttribute("data-representative-name"),document.getElementById("editOrganizationRepresentative--representativeTitle").value=u.getAttribute("data-representative-title"),document.getElementById("editOrganizationRepresentative--representativeAddress1").value=u.getAttribute("data-representative-address-1"),document.getElementById("editOrganizationRepresentative--representativeAddress2").value=u.getAttribute("data-representative-address-2"),document.getElementById("editOrganizationRepresentative--representativeCity").value=u.getAttribute("data-representative-city"),document.getElementById("editOrganizationRepresentative--representativeProvince").value=u.getAttribute("data-representative-province"),document.getElementById("editOrganizationRepresentative--representativePostalCode").value=u.getAttribute("data-representative-postal-code"),document.getElementById("editOrganizationRepresentative--representativePhoneNumber").value=u.getAttribute("data-representative-phone-number"),document.getElementById("editOrganizationRepresentative--representativeEmailAddress").value=u.getAttribute("data-representative-email-address"),document.getElementById("editOrganizationRepresentative--isDefault").value=document.getElementById("representative-isDefault--"+t).checked?"1":"0",cityssm.showModal(m)},y=function(e){var t=document.createElement("tr");t.setAttribute("data-representative-index",e.representativeIndex.toString()),t.setAttribute("data-representative-name",e.representativeName),t.setAttribute("data-representative-title",e.representativeTitle),t.setAttribute("data-representative-address-1",e.representativeAddress1),t.setAttribute("data-representative-address-2",e.representativeAddress2),t.setAttribute("data-representative-city",e.representativeCity),t.setAttribute("data-representative-province",e.representativeProvince),t.setAttribute("data-representative-postal-code",e.representativePostalCode),t.setAttribute("data-representative-phone-number",e.representativePhoneNumber),t.setAttribute("data-representative-email-address",e.representativeEmailAddress),t.insertAdjacentHTML("beforeend",'<td><div class="field"><input class="is-checkradio is-info" id="representative-isDefault--'+e.representativeIndex+'" name="representative-isDefault" type="radio"'+(e.isDefault?" checked":"")+' />&nbsp;<label for="representative-isDefault--'+e.representativeIndex+'"></label></div></td>'),t.getElementsByTagName("input")[0].addEventListener("change",d);var n=document.createElement("td");n.innerHTML=e.representativeName+"<br /><small>"+e.representativeTitle+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativeAddress1+"<br /><small>"+(""===e.representativeAddress2?"":e.representativeAddress2+"<br />")+e.representativeCity+", "+e.representativeProvince+"<br />"+e.representativePostalCode+"</small>",t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativePhoneNumber,t.insertAdjacentElement("beforeend",n),(n=document.createElement("td")).innerHTML=e.representativeEmailAddress,t.insertAdjacentElement("beforeend",n),t.insertAdjacentHTML("beforeend",'<td><div class="buttons is-right has-addons"><button class="button is-small is-edit-representative-button" data-tooltip="Edit Representative" type="button"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span><span>Edit</span></button><button class="button is-small has-text-danger is-delete-representative-button" data-tooltip="Delete Representative" type="button"><i class="fas fa-trash" aria-hidden="true"></i><span class="sr-only">Delete</span></button></td>'),t.getElementsByClassName("is-edit-representative-button")[0].addEventListener("click",g),t.getElementsByClassName("is-delete-representative-button")[0].addEventListener("click",c),r.insertAdjacentElement("beforeend",t)},E=r.getElementsByClassName("is-edit-representative-button");for(l=0;l<E.length;l+=1)E[l].addEventListener("click",g);for(var f=m.getElementsByClassName("is-cancel-button"),b=0;b<f.length;b+=1)f[b].addEventListener("click",cityssm.hideModal);p.addEventListener("submit",function(e){e.preventDefault(),cityssm.postJSON("/organizations/"+n+"/doEditOrganizationRepresentative",e.currentTarget,function(e){e.success&&(u.remove(),u=null,y(e.organizationRepresentative),cityssm.hideModal(m))})});var z=document.getElementsByClassName("is-add-representative-modal")[0],h=z.getElementsByTagName("form")[0];document.getElementsByClassName("is-add-representative-button")[0].addEventListener("click",function(){h.reset(),cityssm.showModal(z),document.getElementById("addOrganizationRepresentative--representativeName").focus()}),f=z.getElementsByClassName("is-cancel-button");for(b=0;b<f.length;b+=1)f[b].addEventListener("click",cityssm.hideModal);h.addEventListener("submit",function(e){e.preventDefault(),cityssm.postJSON("/organizations/"+n+"/doAddOrganizationRepresentative",e.currentTarget,function(e){if(e.success){var t=r.getElementsByClassName("is-empty-warning");t.length>0&&t[0].remove(),y(e.organizationRepresentative),cityssm.hideModal(z)}})}),z.getElementsByClassName("is-copy-organization-address-button")[0].addEventListener("click",function(e){e.preventDefault(),document.getElementById("addOrganizationRepresentative--representativeAddress1").value=document.getElementById("organization--organizationAddress1").value,document.getElementById("addOrganizationRepresentative--representativeAddress2").value=document.getElementById("organization--organizationAddress2").value,document.getElementById("addOrganizationRepresentative--representativeCity").value=document.getElementById("organization--organizationCity").value,document.getElementById("addOrganizationRepresentative--representativeProvince").value=document.getElementById("organization--organizationProvince").value,document.getElementById("addOrganizationRepresentative--representativePostalCode").value=document.getElementById("organization--organizationPostalCode").value})}function A(){cityssm.enableNavBlocker(),t.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'}for(var B=e.querySelectorAll("input, select, textarea"),I=0;I<B.length;I+=1)B[I].addEventListener("change",A)}();