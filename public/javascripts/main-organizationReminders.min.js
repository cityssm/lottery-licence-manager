"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),llm.organizationReminders=(()=>{let e;const t=new Map,n=n=>{0===t.size?llm.getDefaultConfigProperty("reminderCategories",i=>{e=i;for(const n of e)for(const e of n.reminderTypes)e.reminderCategory=n.reminderCategory,t.set(e.reminderTypeKey,e);n&&n()}):n&&n()},i=(e,t)=>{cityssm.postJSON("/organizations/doGetReminders",{organizationID:e},t)},r=(e,t,n)=>{cityssm.postJSON("/organizations/doDeleteReminder",{organizationID:e,reminderIndex:t},n)};return{getRemindersByOrganizationID:i,getReminderByID:(e,t,n)=>{cityssm.postJSON("/organizations/doGetReminder",{organizationID:e,reminderIndex:t},n)},openAddReminderModal:(r,d)=>{let o;const m=e=>{e.preventDefault(),cityssm.postJSON("/organizations/doAddReminder",e.currentTarget,e=>{e.success&&(o(),d&&d(e.reminder))})},s=e=>{const n=e.currentTarget.value,i=t.get(n),r=document.getElementById("addReminder--reminderStatus");r.value="",r.innerHTML='<option value="">(Not Set)</option>';for(const e of i.reminderStatuses){const t=document.createElement("option");t.value=e,t.innerText=e,r.appendChild(t)}};n(()=>{cityssm.openHtmlModal("reminderAdd",{onshow(){document.getElementById("addReminder--organizationID").value=r.toString(),document.getElementById("addReminder--reminderDateString").setAttribute("min",cityssm.dateToString(new Date)),i(r,t=>{const n=document.getElementById("addReminder--reminderTypeKey");for(const i of e){if(!i.isActive)continue;const e=document.createElement("optgroup");e.label=i.reminderCategory;for(const n of i.reminderTypes){if(!n.isActive)continue;if(n.hasUndismissedLimit&&t.find(e=>e.reminderTypeKey===n.reminderTypeKey&&""===e.dismissedDateString))continue;const i=document.createElement("option");i.value=n.reminderTypeKey,i.innerText=n.reminderType,e.appendChild(i)}n.appendChild(e)}n.addEventListener("change",s),n.closest(".select").classList.remove("is-loading")}),document.getElementById("form--addReminder").addEventListener("submit",m)},onshown(e,t){o=t}})})},openEditReminderModal:(r,d,o)=>{let m;const s=e=>{e.preventDefault(),cityssm.postJSON("/organizations/doEditReminder",e.currentTarget,e=>{e.success&&(m(),o&&o(e.reminder))})},a=()=>{const e=document.getElementById("editReminder--reminderTypeKey").value,n=t.get(e),i=document.getElementById("editReminder--reminderStatus");i.value="",i.innerHTML='<option value="">(Not Set)</option>';for(const e of n.reminderStatuses){const t=document.createElement("option");t.value=e,t.innerText=e,i.appendChild(t)}};n(()=>{cityssm.openHtmlModal("reminderEdit",{onshow(){document.getElementById("editReminder--organizationID").value=r.toString(),document.getElementById("editReminder--reminderIndex").value=d.toString(),document.getElementById("form--editReminder").addEventListener("submit",s)},onshown(t,n){m=n,i(r,t=>{const n=t.find(e=>e.reminderIndex===d);if(!n)return m(),void cityssm.alertModal("Reminder Not Found","","OK","danger");const i=document.getElementById("editReminder--reminderTypeKey");for(const r of e){const e=document.createElement("optgroup");e.label=r.reminderCategory;for(const i of r.reminderTypes){if(i.reminderTypeKey!==n.reminderTypeKey){if(!i.isActive||!r.isActive)continue;if(i.hasUndismissedLimit&&t.find(e=>e.reminderTypeKey===i.reminderTypeKey&&""===e.dismissedDateString))continue}const d=document.createElement("option");d.value=i.reminderTypeKey,d.innerText=i.reminderType,e.appendChild(d)}e.children.length>0&&i.appendChild(e)}if(i.value=n.reminderTypeKey,i.addEventListener("change",a),i.closest(".select").classList.remove("is-loading"),document.getElementById("editReminder--reminderDateString").value=n.reminderDateString,a(),n.reminderStatus&&""!==n.reminderStatus){const e=document.getElementById("editReminder--reminderStatus");let t=!1;for(const i of e.options)if(i.value===n.reminderStatus){t=!0;break}if(!t){const t=document.createElement("option");t.innerText=n.reminderStatus,t.value=n.reminderStatus,e.appendChild(t)}e.value=n.reminderStatus}document.getElementById("editReminder--reminderNote").value=n.reminderNote;const r=document.getElementById("editReminder--dismissedDateString");r.value=n.dismissedDateString,r.setAttribute("max",cityssm.dateToString(new Date))})}})})},deleteReminder:(e,t,n,i)=>{n?cityssm.confirmModal("Delete Reminder?","Are you sure you want to delete this reminder?","Yes, Delete","danger",()=>{r(e,t,i)}):r(e,t,i)},getReminderType:e=>t.get(e)}})();