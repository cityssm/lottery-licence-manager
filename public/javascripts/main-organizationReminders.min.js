"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),llm.organizationReminders=(()=>{let e;const t=new Map;let n=[];const i=i=>{0===t.size?(llm.getDefaultConfigProperty("dismissingStatuses",e=>{n=e}),llm.getDefaultConfigProperty("reminderCategories",n=>{e=n;for(const n of e)for(const e of n.reminderTypes)e.reminderCategory=n.reminderCategory,t.set(e.reminderTypeKey,e);i&&i()})):i&&i()},r=(e,t)=>{cityssm.postJSON("/organizations/doGetReminders",{organizationID:e},t)},d=(e,t,n)=>{cityssm.postJSON("/organizations/doDismissReminder",{organizationID:e,reminderIndex:t},n)},s=(e,t,n)=>{cityssm.postJSON("/organizations/doDeleteReminder",{organizationID:e,reminderIndex:t},n)};return{loadReminderTypeCache:i,getRemindersByOrganizationID:r,getReminderByID:(e,t,n)=>{cityssm.postJSON("/organizations/doGetReminder",{organizationID:e,reminderIndex:t},n)},openAddReminderModal:(n,d)=>{let s;const o=e=>{e.preventDefault(),cityssm.postJSON("/organizations/doAddReminder",e.currentTarget,e=>{e.success&&(s(),d&&d(e.reminder))})},m=e=>{const n=e.currentTarget.value,i=t.get(n),r=document.getElementById("addReminder--reminderStatus");r.value="",r.innerHTML='<option value="">(Not Set)</option>';for(const e of i.reminderStatuses){const t=document.createElement("option");t.value=e,t.innerText=e,r.appendChild(t)}};i(()=>{cityssm.openHtmlModal("reminderAdd",{onshow(){document.getElementById("addReminder--organizationID").value=n.toString(),document.getElementById("addReminder--reminderDateString").setAttribute("min",cityssm.dateToString(new Date)),r(n,t=>{const n=document.getElementById("addReminder--reminderTypeKey");for(const i of e){if(!i.isActive)continue;const e=document.createElement("optgroup");e.label=i.reminderCategory;for(const n of i.reminderTypes){if(!n.isActive)continue;if(n.hasUndismissedLimit&&t.find(e=>e.reminderTypeKey===n.reminderTypeKey&&""===e.dismissedDateString))continue;const i=document.createElement("option");i.value=n.reminderTypeKey,i.innerText=n.reminderType,e.appendChild(i)}n.appendChild(e)}n.addEventListener("change",m),n.closest(".select").classList.remove("is-loading")}),document.getElementById("form--addReminder").addEventListener("submit",o)},onshown(e,t){s=t}})})},openEditReminderModal:(d,s,o)=>{let m,a=!1;const c=e=>{e.preventDefault(),cityssm.postJSON("/organizations/doEditReminder",e.currentTarget,e=>{e.success&&(m(),o&&o(e.reminder))})},l=()=>{const e=document.getElementById("editReminder--reminderTypeKey").value,i=t.get(e),r=document.getElementById("editReminder--reminderStatus");r.value="",r.innerHTML='<option data-is-dismissing="0" value="">(Not Set)</option>';for(const e of i.reminderStatuses){const t=document.createElement("option");t.value=e,t.innerText=e,t.setAttribute("data-is-dismissing",n.includes(e)?"1":"0"),r.appendChild(t)}},u=e=>{if(a)return;const t="1"===e.currentTarget.selectedOptions[0].getAttribute("data-is-dismissing");document.getElementById("editReminder--dismissedDateString").value=t?cityssm.dateToString(new Date):""};i(()=>{cityssm.openHtmlModal("reminderEdit",{onshow(){document.getElementById("editReminder--organizationID").value=d.toString(),document.getElementById("editReminder--reminderIndex").value=s.toString(),document.getElementById("form--editReminder").addEventListener("submit",c)},onshown(t,n){m=n,r(d,t=>{const n=t.find(e=>e.reminderIndex===s);if(!n)return m(),void cityssm.alertModal("Reminder Not Found","","OK","danger");const i=document.getElementById("editReminder--reminderTypeKey");for(const r of e){const e=document.createElement("optgroup");e.label=r.reminderCategory;for(const i of r.reminderTypes){if(i.reminderTypeKey!==n.reminderTypeKey){if(!i.isActive||!r.isActive)continue;if(i.hasUndismissedLimit&&t.find(e=>e.reminderTypeKey===i.reminderTypeKey&&""===e.dismissedDateString))continue}const d=document.createElement("option");d.value=i.reminderTypeKey,d.innerText=i.reminderType,e.appendChild(d)}e.children.length>0&&i.appendChild(e)}i.value=n.reminderTypeKey,i.addEventListener("change",l),i.closest(".select").classList.remove("is-loading"),document.getElementById("editReminder--reminderDateString").value=n.reminderDateString,l();const r=document.getElementById("editReminder--reminderStatus");if(n.reminderStatus&&""!==n.reminderStatus){let e=!1;for(const t of r.options)if(t.value===n.reminderStatus){e=!0;break}if(!e){const e=document.createElement("option");e.innerText=n.reminderStatus,e.value=n.reminderStatus,r.appendChild(e)}r.value=n.reminderStatus}r.addEventListener("change",u),document.getElementById("editReminder--reminderNote").value=n.reminderNote;const d=document.getElementById("editReminder--dismissedDateString");d.value=n.dismissedDateString,d.setAttribute("max",cityssm.dateToString(new Date)),""!==n.dismissedDateString&&(a=!0),d.addEventListener("change",()=>{a=!0})})}})})},dismissReminder:(e,t,n,i)=>{n?cityssm.confirmModal("Dismiss Reminder?","Are you sure you want to dismiss this reminder?","Yes, Dismiss","warning",()=>{d(e,t,i)}):d(e,t,i)},deleteReminder:(e,t,n,i)=>{n?cityssm.confirmModal("Delete Reminder?","Are you sure you want to delete this reminder?","Yes, Delete","danger",()=>{s(e,t,i)}):s(e,t,i)},getReminderType:e=>t.get(e)}})();