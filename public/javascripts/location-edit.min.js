(function(){function m(){n=!0;window.llm.enableNavBlocker();h.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'}var d=document.getElementById("form--location"),h=document.getElementById("container--form-message"),k=document.getElementById("location--locationID").value,n=!1,b=""===k,f="true"===document.getElementsByTagName("main")[0].getAttribute("data-is-admin");d.addEventListener("submit",
function(a){a.preventDefault();h.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>';window.fetch(b?"/locations/doCreate":"/locations/doUpdate",{method:"POST",credentials:"include",body:new URLSearchParams(new FormData(d))}).then(function(a){return a.json()}).then(function(a){a.success&&(n=!1,window.llm.disableNavBlocker());a.success&&b?window.location.href="/locations/"+a.locationID+"/edit":(h.innerHTML="",window.llm.alertModal(a.message,"","OK",a.success?"success":
"danger"))})});if(!b){var p=function(){window.fetch("/locations/doDelete",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({locationID:k})}).then(function(a){return a.json()}).then(function(a){a.success&&(window.location.href="/locations")})};d.getElementsByClassName("is-delete-button")[0].addEventListener("click",function(a){a.preventDefault();window.llm.confirmModal("Delete Location?","Are you sure you want to delete this location?<br />Note that any active licences associated with this location will remain active.",
"Yes, Delete Location","warning",p)})}if(!b&&f){var t=parseInt(k);d.getElementsByClassName("is-merge-button")[0].addEventListener("click",function(a){a.preventDefault();if(n)window.llm.alertModal("Unsaved Changes","You must save all unsaved changes before merging this location record.","OK","warning");else{a=document.getElementById("location--locationName").value;var d=(""===a?document.getElementById("location--locationAddress1").value:a)+", #"+k,b="",f=[],l=null,h=null,g=null,m=function(){window.fetch("/locations/doMerge",
{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetLocationID:k,sourceLocationID:b})}).then(function(a){return a.json()}).then(function(a){a.success?window.location.reload(!0):window.llm.alertModal("Merge Not Completed","Please try again.","OK","danger")})},p=function(a){a.preventDefault();b=a.currentTarget.getAttribute("data-location-id");a=a.currentTarget.getAttribute("data-location-display-name");g();window.llm.confirmModal("Confirm Merge",
"Are you sure you want to update all licences associated with <em>"+a+", #"+b+"</em> and associate them with <em>"+d+"</em>?","Yes, Complete Merge","warning",m)},r=function(){var a=l.value.trim().toLowerCase().split(" "),q=document.createElement("div");q.className="list is-hoverable";for(var d=0;d<f.length;d+=1){var c=f[d];if(c.locationID!==t){for(var e=!0,b=0;b<a.length;b+=1){var g=a[b];if(-1===c.locationName.toLowerCase().indexOf(g)){e=!1;break}}e&&(e=document.createElement("a"),e.className="list-item",
e.setAttribute("data-location-id",c.locationID),e.setAttribute("data-location-display-name",c.locationDisplayName),e.addEventListener("click",p),e.innerHTML='<div class="level is-marginless">'+('<div class="level-left"><div>'+window.llm.escapeHTML(c.locationDisplayName)+"<br /><small>"+window.llm.escapeHTML(c.locationAddress1)+"</small></div></div>")+('<div class="level-right">#'+c.locationID+"</div>")+'</div><div class="has-text-right">'+(0<c.licences_count?' <span class="tag is-info has-tooltip-left" data-tooltip="Licence Count"><span class="icon"><i class="fas fa-certificate" aria-hidden="true"></i></span> <span>'+
c.licences_count+"</span></span>":"")+(0<c.distributor_count?' <span class="tag is-info has-tooltip-left" data-tooltip="Distributor Count"><span class="icon"><i class="fas fa-truck-moving" aria-hidden="true"></i></span> <span>'+c.distributor_count+"</span></span>":"")+(0<c.manufacturer_count?' <span class="tag is-info has-tooltip-left" data-tooltip="Manufacturer Count"><span class="icon"><i class="fas fa-print" aria-hidden="true"></i></span> <span>'+c.manufacturer_count+"</span></span>":"")+"</div>",
q.insertAdjacentElement("beforeend",e))}}window.llm.clearElement(h);h.insertAdjacentElement("beforeend",q)};window.llm.openHtmlModal("locationMerge",{onshow:function(a){a=a.getElementsByClassName("mergeLocation--locationDisplayNameAndID_target");for(var b=0;b<a.length;b+=1)a[b].innerText=d;h=document.getElementById("container--sourceLocations");l=document.getElementById("mergeLocation--locationFilter");l.addEventListener("keyup",r);window.fetch("/locations/doGetLocations",{method:"GET",credentials:"include"}).then(function(a){return a.json()}).then(function(a){f=
a;l.removeAttribute("disabled");r()})},onshown:function(a,b){g=b}})}})}for(var f=d.getElementsByTagName("input"),g=0;g<f.length;g+=1)f[g].addEventListener("change",m)})();
