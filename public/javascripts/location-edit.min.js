"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=document.getElementById("form--location"),a=document.getElementById("container--form-message"),n=document.getElementById("location--locationID").value;let s=!1;const o=""===n,i="true"===document.getElementsByTagName("main")[0].getAttribute("data-is-admin");if(t.addEventListener("submit",n=>{n.preventDefault(),a.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(e+(o?"/locations/doCreate":"/locations/doUpdate"),t,e=>{e.success&&(s=!1,cityssm.disableNavBlocker()),e.success&&o?window.location.href="/locations/"+e.locationID.toString()+"/edit":(a.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger"))})}),!o){const a=()=>{cityssm.postJSON(e+"/locations/doDelete",{locationID:n},e=>{e.success&&(window.location.href="/locations")})};t.getElementsByClassName("is-delete-button")[0].addEventListener("click",e=>{e.preventDefault(),cityssm.confirmModal("Delete Location?","Are you sure you want to delete this location?<br />Note that any active licences associated with this location will remain active.","Yes, Delete Location","warning",a)})}if(!o&&i){const a=parseInt(n,10);t.getElementsByClassName("is-merge-button")[0].addEventListener("click",t=>{if(t.preventDefault(),s)return void cityssm.alertModal("Unsaved Changes","You must save all unsaved changes before merging this location record.","OK","warning");const o=document.getElementById("location--locationName").value,i=(""===o?document.getElementById("location--locationAddress1").value:o)+", #"+n;let c="",l=[],r=null,d=null,m=null;const u=()=>{cityssm.postJSON(e+"/locations/doMerge",{targetLocationID:n,sourceLocationID:c},e=>{e.success?window.location.reload():cityssm.alertModal("Merge Not Completed","Please try again.","OK","danger")})},g=e=>{e.preventDefault();const t=e.currentTarget;c=t.getAttribute("data-location-id");const a=t.getAttribute("data-location-display-name");m(),cityssm.confirmModal("Confirm Merge","Are you sure you want to update all licences associated with <em>"+a+", #"+c+"</em> and associate them with <em>"+i+"</em>?","Yes, Complete Merge","warning",u)},p=()=>{const e=r.value.trim().toLowerCase().split(" "),t=document.createElement("div");t.className="panel";for(const n of l){if(n.locationID===a)continue;let s=!0;for(const t of e)if(!n.locationName.toLowerCase().includes(t)){s=!1;break}if(!s)continue;const o=document.createElement("a");o.className="panel-block is-block",o.setAttribute("data-location-id",n.locationID.toString()),o.setAttribute("data-location-display-name",n.locationDisplayName),o.addEventListener("click",g),o.innerHTML='<div class="level is-marginless"><div class="level-left"><div>'+cityssm.escapeHTML(n.locationDisplayName)+"<br /><small>"+cityssm.escapeHTML(n.locationAddress1)+'</small></div></div><div class="level-right">#'+n.locationID.toString()+'</div></div><div class="has-text-right">'+(n.licences_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Licence Count"><span class="icon"><i class="fas fa-certificate" aria-hidden="true"></i></span> <span>'+n.licences_count.toString()+"</span></span>":"")+(n.distributor_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Distributor Count"><span class="icon"><i class="fas fa-truck-moving" aria-hidden="true"></i></span> <span>'+n.distributor_count.toString()+"</span></span>":"")+(n.manufacturer_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Manufacturer Count"><span class="icon"><i class="fas fa-print" aria-hidden="true"></i></span> <span>'+n.manufacturer_count.toString()+"</span></span>":"")+"</div>",t.insertAdjacentElement("beforeend",o)}cityssm.clearElement(d),d.insertAdjacentElement("beforeend",t)};cityssm.openHtmlModal("locationMerge",{onshow(e){const t=e.getElementsByClassName("mergeLocation--locationDisplayNameAndID_target");for(const e of t)e.innerText=i;d=document.getElementById("container--sourceLocations"),(r=document.getElementById("mergeLocation--locationFilter")).addEventListener("keyup",p)},onshown(t,a){m=a,cityssm.postJSON(e+"/locations/doGetLocations",{limit:-1},e=>{l=e.locations,r.removeAttribute("disabled"),r.focus(),p()})}})})}const c=()=>{s=!0,cityssm.enableNavBlocker(),a.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'},l=t.getElementsByTagName("input");for(const e of l)e.addEventListener("change",c);const r=document.getElementById("location--locationName");o&&r.focus();const d=document.getElementById("location--locationIsDistributor"),m=document.getElementById("location--locationIsManufacturer"),u=()=>{d.checked||m.checked?r.setAttribute("required","required"):r.removeAttribute("required")};d.addEventListener("change",u),m.addEventListener("change",u)})();