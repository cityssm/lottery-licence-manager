"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){var e=document.getElementById("form--location"),t=document.getElementById("container--form-message"),a=document.getElementById("location--locationID").value,n=!1,i=""===a,o="true"===document.getElementsByTagName("main")[0].getAttribute("data-is-admin");if(e.addEventListener("submit",function(a){a.preventDefault(),t.innerHTML='Saving... <i class="fas fa-circle-notch fa-spin" aria-hidden="true"></i>',cityssm.postJSON(i?"/locations/doCreate":"/locations/doUpdate",e,function(e){e.success&&(n=!1,cityssm.disableNavBlocker()),e.success&&i?window.location.href="/locations/"+e.locationID+"/edit":(t.innerHTML="",cityssm.alertModal(e.message,"","OK",e.success?"success":"danger"))})}),!i){var s=function(){cityssm.postJSON("/locations/doDelete",{locationID:a},function(e){e.success&&(window.location.href="/locations")})};e.getElementsByClassName("is-delete-button")[0].addEventListener("click",function(e){e.preventDefault(),cityssm.confirmModal("Delete Location?","Are you sure you want to delete this location?<br />Note that any active licences associated with this location will remain active.","Yes, Delete Location","warning",s)})}if(!i&&o){var c=parseInt(a,10);e.getElementsByClassName("is-merge-button")[0].addEventListener("click",function(e){if(e.preventDefault(),n)cityssm.alertModal("Unsaved Changes","You must save all unsaved changes before merging this location record.","OK","warning");else{var t=document.getElementById("location--locationName").value,i=(""===t?document.getElementById("location--locationAddress1").value:t)+", #"+a,o="",s=[],l=null,r=null,d=null,u=function(){cityssm.postJSON("/locations/doMerge",{targetLocationID:a,sourceLocationID:o},function(e){e.success?window.location.reload(!0):cityssm.alertModal("Merge Not Completed","Please try again.","OK","danger")})},m=function(e){e.preventDefault();var t=e.currentTarget;o=t.getAttribute("data-location-id");var a=t.getAttribute("data-location-display-name");d(),cityssm.confirmModal("Confirm Merge","Are you sure you want to update all licences associated with <em>"+a+", #"+o+"</em> and associate them with <em>"+i+"</em>?","Yes, Complete Merge","warning",u)},f=function(){var e=l.value.trim().toLowerCase().split(" "),t=document.createElement("div");t.className="panel";for(var a=0;a<s.length;a+=1){var n=s[a];if(n.locationID!==c){for(var i=!0,o=0;o<e.length;o+=1){var d=e[o];if(-1===n.locationName.toLowerCase().indexOf(d)){i=!1;break}}if(i){var u=document.createElement("a");u.className="panel-block is-block",u.setAttribute("data-location-id",n.locationID),u.setAttribute("data-location-display-name",n.locationDisplayName),u.addEventListener("click",m),u.innerHTML='<div class="level is-marginless"><div class="level-left"><div>'+cityssm.escapeHTML(n.locationDisplayName)+"<br /><small>"+cityssm.escapeHTML(n.locationAddress1)+'</small></div></div><div class="level-right">#'+n.locationID+'</div></div><div class="has-text-right">'+(n.licences_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Licence Count"><span class="icon"><i class="fas fa-certificate" aria-hidden="true"></i></span> <span>'+n.licences_count+"</span></span>":"")+(n.distributor_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Distributor Count"><span class="icon"><i class="fas fa-truck-moving" aria-hidden="true"></i></span> <span>'+n.distributor_count+"</span></span>":"")+(n.manufacturer_count>0?' <span class="tag is-info has-tooltip-left" data-tooltip="Manufacturer Count"><span class="icon"><i class="fas fa-print" aria-hidden="true"></i></span> <span>'+n.manufacturer_count+"</span></span>":"")+"</div>",t.insertAdjacentElement("beforeend",u)}}}cityssm.clearElement(r),r.insertAdjacentElement("beforeend",t)};cityssm.openHtmlModal("locationMerge",{onshow:function(e){for(var t=e.getElementsByClassName("mergeLocation--locationDisplayNameAndID_target"),a=0;a<t.length;a+=1)t[a].innerText=i;r=document.getElementById("container--sourceLocations"),(l=document.getElementById("mergeLocation--locationFilter")).addEventListener("keyup",f)},onshown:function(e,t){d=t,cityssm.postJSON("/locations/doGetLocations",{limit:-1},function(e){s=e.locations,l.removeAttribute("disabled"),l.focus(),f()})}})}})}function l(){n=!0,cityssm.enableNavBlocker(),t.innerHTML='<span class="tag is-light is-info is-medium"><span class="icon"><i class="fas fa-exclamation-triangle" aria-hidden="true"></i></span> <span>Unsaved Changes</span></div>'}for(var r=e.getElementsByTagName("input"),d=0;d<r.length;d+=1)r[d].addEventListener("change",l);var u=document.getElementById("location--locationName");i&&u.focus();var m=document.getElementById("location--locationIsDistributor"),f=document.getElementById("location--locationIsManufacturer");function g(){m.checked||f.checked?u.setAttribute("required","required"):u.removeAttribute("required")}m.addEventListener("change",g),f.addEventListener("change",g)}();