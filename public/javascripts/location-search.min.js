"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=exports.dateDiff,t=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),n=document.getElementById("form--searchFilters"),a=document.getElementById("filter--limit"),s=document.getElementById("filter--offset"),i=document.getElementById("container--searchResults"),o="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create");let r=new Date,c=[];const l=()=>{const d=parseInt(a.value,10),m=parseInt(s.value,10);c=[],i.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading locations...</em></p>',cityssm.postJSON(t+"/locations/doGetLocations",n,n=>{if(0===(c=n.locations).length)return void(i.innerHTML='<div class="message is-info"><div class="message-body"><strong>Your search returned no results.</strong><br />Please try expanding your search criteria.</div></div>');r=new Date,i.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th>Location</th><th>Address</th><th class="has-text-centered">Last Licence End Date</th><th class="has-text-centered">Last Manufacturer End Date</th><th class="has-text-centered">Last Distributor End Date</th>'+(o?'<th class="is-hidden-print"><span class="sr-only">Options</span></th>':"")+"</tr></thead><tbody></tbody></table>";const a=i.getElementsByTagName("tbody")[0];if(c.forEach((n,s)=>{const i=((n,a)=>{const s=document.createElement("tr");s.innerHTML="<td></td>";const i=document.createElement("a");i.innerText=n.locationDisplayName,i.href=t+"/locations/"+n.locationID.toString(),s.getElementsByTagName("td")[0].insertAdjacentElement("beforeend",i);const c=document.createElement("td");c.innerHTML=(""===n.locationAddress1?"":cityssm.escapeHTML(n.locationAddress1)+"<br />")+(""===n.locationAddress2?"":"<small>"+cityssm.escapeHTML(n.locationAddress2)+"</small><br />")+(""===n.locationCity?"":"<small>"+cityssm.escapeHTML(n.locationCity)+", "+n.locationProvince+"</small>"),s.insertAdjacentElement("beforeend",c);let l="";if(""!==n.licences_endDateMaxString){const t=cityssm.dateStringToDate(n.licences_endDateMaxString);t<r&&(l='<br /><span class="is-size-7">'+e(t,r).formatted+" ago</span>")}if(s.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(""===n.licences_endDateMaxString?'<span class="has-text-grey">Not Used</span>':n.licences_endDateMaxString+l)+"</td>"),s.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(n.locationIsManufacturer?'<span data-tooltip="Manufacturer"><span class="tag is-success">Yes</span><br />'+(""===n.manufacturer_endDateMaxString?'<span class="has-text-grey">Never Used</span>':n.manufacturer_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),s.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(n.locationIsDistributor?'<span data-tooltip="Distributor"><span class="tag is-success">Yes</span><br />'+(""===n.distributor_endDateMaxString?'<span class="has-text-grey">Never Used</span>':n.distributor_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),o){const e=n.canUpdate&&0===n.licences_count&&0===n.distributor_count&&0===n.manufacturer_count;s.insertAdjacentHTML("beforeend",'<td class="is-hidden-print has-text-right is-nowrap">'+(n.canUpdate?'<a class="button is-small" data-tooltip="Edit Location" href="/locations/'+n.locationID.toString()+'/edit"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></a>':"")+(e?' <button class="button is-small is-danger is-delete-location-button" data-tooltip="Delete Location" data-location-index="'+a.toString()+'" type="button"><span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span></button>':"")+"</td>"),e&&s.getElementsByClassName("is-delete-location-button")[0].addEventListener("click",u)}return s})(n,s);a.insertAdjacentElement("beforeend",i)}),i.insertAdjacentHTML("beforeend",'<div class="level is-block-print"><div class="level-left has-text-weight-bold">Displaying locations '+(m+1).toString()+" to "+Math.min(d+m,n.count).toString()+" of "+n.count.toString()+"</div></div>"),d<n.count){const e=document.createElement("nav");if(e.className="level-right is-hidden-print",e.setAttribute("role","pagination"),e.setAttribute("aria-label","pagination"),m>0){const t=document.createElement("a");t.className="button",t.innerText="Previous",t.addEventListener("click",e=>{e.preventDefault(),s.value=Math.max(0,m-d).toString(),l()}),e.insertAdjacentElement("beforeend",t)}if(d+m<n.count){const t=document.createElement("a");t.className="button ml-3",t.innerHTML='<span>Next Locations</span><span class="icon"><i class="fas fa-chevron-right" aria-hidden="true"></i></span>',t.addEventListener("click",e=>{e.preventDefault(),s.value=(m+d).toString(),l()}),e.insertAdjacentElement("beforeend",t)}i.getElementsByClassName("level")[0].insertAdjacentElement("beforeend",e)}})},d=()=>{s.value="0",l()},u=e=>{e.preventDefault();const n=parseInt(e.currentTarget.getAttribute("data-location-index"),10),a=c[n];cityssm.confirmModal("Delete Location",`Are you sure you want to delete ${cityssm.escapeHTML(a.locationDisplayName)}?`,"Yes, Delete","warning",()=>{cityssm.postJSON(t+"/locations/doDelete",{locationID:a.locationID},e=>{e.success&&l()})})};n.addEventListener("submit",e=>{e.preventDefault()}),document.getElementById("filter--locationNameAddress").addEventListener("change",d),document.getElementById("filter--locationIsDistributor").addEventListener("change",d),document.getElementById("filter--locationIsManufacturer").addEventListener("change",d),document.getElementById("filter--locationIsActive").addEventListener("change",d),d()})();