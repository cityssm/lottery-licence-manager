"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),function(){const e=document.getElementById("form--searchFilters"),t=document.getElementById("filter--limit"),n=document.getElementById("filter--offset"),a=document.getElementById("container--searchResults"),s="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create");let i=[];function c(e,t){const n=document.createElement("tr");n.innerHTML="<td></td>";const a=document.createElement("a");a.innerText=e.locationDisplayName,a.href="/locations/"+e.locationID,n.getElementsByTagName("td")[0].insertAdjacentElement("beforeend",a);const i=document.createElement("td");if(i.innerHTML=(""===e.locationAddress1?"":cityssm.escapeHTML(e.locationAddress1)+"<br />")+(""===e.locationAddress2?"":"<small>"+cityssm.escapeHTML(e.locationAddress2)+"</small><br />")+(""===e.locationCity?"":"<small>"+cityssm.escapeHTML(e.locationCity)+", "+e.locationProvince+"</small>"),n.insertAdjacentElement("beforeend",i),n.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(""===e.licences_endDateMaxString?'<span class="has-text-grey">Not Used</span>':e.licences_endDateMaxString)+"</td>"),n.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(e.locationIsManufacturer?'<span data-tooltip="Manufacturer"><span class="tag is-success">Yes</span><br />'+(""===e.manufacturer_endDateMaxString?'<span class="has-text-grey">Never Used</span>':e.manufacturer_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),n.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(e.locationIsDistributor?'<span data-tooltip="Distributor"><span class="tag is-success">Yes</span><br />'+(""===e.distributor_endDateMaxString?'<span class="has-text-grey">Never Used</span>':e.distributor_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),s){const a=e.canUpdate&&0===e.licences_count&&0===e.distributor_count&&0===e.manufacturer_count;n.insertAdjacentHTML("beforeend",'<td class="is-hidden-print has-text-right is-nowrap">'+(e.canUpdate?'<a class="button is-small" data-tooltip="Edit Location" href="/locations/'+e.locationID+'/edit"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></a>':"")+(a?' <button class="button is-small is-danger is-delete-location-button" data-tooltip="Delete Location" data-location-index="'+t+'" type="button"><span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span></button>':"")+"</td>"),a&&n.getElementsByClassName("is-delete-location-button")[0].addEventListener("click",l)}return n}function o(){const r=parseInt(t.value,10),l=parseInt(n.value,10);i=[],a.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading locations...</em></p>',cityssm.postJSON("/locations/doGetLocations",e,function(e){if(0===(i=e.locations).length)return void(a.innerHTML='<div class="message is-info"><div class="message-body"><strong>Your search returned no results.</strong><br />Please try expanding your search criteria.</div></div>');a.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th>Location</th><th>Address</th><th class="has-text-centered">Last Licence End Date</th><th class="has-text-centered">Last Manufacturer End Date</th><th class="has-text-centered">Last Distributor End Date</th>'+(s?'<th class="is-hidden-print"><span class="sr-only">Options</span></th>':"")+"</tr></thead><tbody></tbody></table>";const t=a.getElementsByTagName("tbody")[0];for(let e=0;e<i.length;e+=1){const n=c(i[e],e);t.insertAdjacentElement("beforeend",n)}if(a.insertAdjacentHTML("beforeend",'<div class="level is-block-print"><div class="level-left has-text-weight-bold">Displaying locations '+(l+1)+" to "+Math.min(r+l,e.count)+" of "+e.count+"</div></div>"),r<e.count){const t=document.createElement("nav");if(t.className="level-right is-hidden-print",t.setAttribute("role","pagination"),t.setAttribute("aria-label","pagination"),l>0){const e=document.createElement("a");e.className="button",e.innerText="Previous",e.addEventListener("click",function(e){e.preventDefault(),n.value=Math.max(0,l-r).toString(),o()}),t.insertAdjacentElement("beforeend",e)}if(r+l<e.count){const e=document.createElement("a");e.className="button ml-3",e.innerHTML='<span>Next Locations</span><span class="icon"><i class="fas fa-chevron-right" aria-hidden="true"></i></span>',e.addEventListener("click",function(e){e.preventDefault(),n.value=(l+r).toString(),o()}),t.insertAdjacentElement("beforeend",e)}a.getElementsByClassName("level")[0].insertAdjacentElement("beforeend",t)}})}function r(){n.value="0",o()}function l(e){e.preventDefault();const t=parseInt(e.currentTarget.getAttribute("data-location-index"),10),n=i[t];cityssm.confirmModal("Delete Location",`Are you sure you want to delete ${cityssm.escapeHTML(n.locationDisplayName)}?`,"Yes, Delete","warning",function(){cityssm.postJSON("/locations/doDelete",{locationID:n.locationID},function(e){e.success&&o()})})}e.addEventListener("submit",function(e){e.preventDefault()}),document.getElementById("filter--locationNameAddress").addEventListener("change",r),document.getElementById("filter--locationIsDistributor").addEventListener("change",r),document.getElementById("filter--locationIsManufacturer").addEventListener("change",r),r()}();