"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{const e=document.getElementsByTagName("main")[0].getAttribute("data-url-prefix"),t=document.getElementById("form--searchFilters"),n=document.getElementById("filter--limit"),a=document.getElementById("filter--offset"),s=document.getElementById("container--searchResults"),i="true"===document.getElementsByTagName("main")[0].getAttribute("data-can-create");let o=[];const r=()=>{const c=parseInt(n.value,10),d=parseInt(a.value,10);o=[],s.innerHTML='<p class="has-text-centered has-text-grey-lighter"><i class="fas fa-3x fa-circle-notch fa-spin" aria-hidden="true"></i><br /><em>Loading locations...</em></p>',cityssm.postJSON(e+"/locations/doGetLocations",t,t=>{if(0===(o=t.locations).length)return void(s.innerHTML='<div class="message is-info"><div class="message-body"><strong>Your search returned no results.</strong><br />Please try expanding your search criteria.</div></div>');s.innerHTML='<table class="table is-fullwidth is-striped is-hoverable"><thead><tr><th>Location</th><th>Address</th><th class="has-text-centered">Last Licence End Date</th><th class="has-text-centered">Last Manufacturer End Date</th><th class="has-text-centered">Last Distributor End Date</th>'+(i?'<th class="is-hidden-print"><span class="sr-only">Options</span></th>':"")+"</tr></thead><tbody></tbody></table>";const n=s.getElementsByTagName("tbody")[0];if(o.forEach((t,a)=>{const s=((t,n)=>{const a=document.createElement("tr");a.innerHTML="<td></td>";const s=document.createElement("a");s.innerText=t.locationDisplayName,s.href=e+"/locations/"+t.locationID.toString(),a.getElementsByTagName("td")[0].insertAdjacentElement("beforeend",s);const o=document.createElement("td");if(o.innerHTML=(""===t.locationAddress1?"":cityssm.escapeHTML(t.locationAddress1)+"<br />")+(""===t.locationAddress2?"":"<small>"+cityssm.escapeHTML(t.locationAddress2)+"</small><br />")+(""===t.locationCity?"":"<small>"+cityssm.escapeHTML(t.locationCity)+", "+t.locationProvince+"</small>"),a.insertAdjacentElement("beforeend",o),a.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(""===t.licences_endDateMaxString?'<span class="has-text-grey">Not Used</span>':t.licences_endDateMaxString)+"</td>"),a.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(t.locationIsManufacturer?'<span data-tooltip="Manufacturer"><span class="tag is-success">Yes</span><br />'+(""===t.manufacturer_endDateMaxString?'<span class="has-text-grey">Never Used</span>':t.manufacturer_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),a.insertAdjacentHTML("beforeend",'<td class="has-text-centered">'+(t.locationIsDistributor?'<span data-tooltip="Distributor"><span class="tag is-success">Yes</span><br />'+(""===t.distributor_endDateMaxString?'<span class="has-text-grey">Never Used</span>':t.distributor_endDateMaxString)+"</span>":'<span class="sr-only">No</span>')+"</td>"),i){const e=t.canUpdate&&0===t.licences_count&&0===t.distributor_count&&0===t.manufacturer_count;a.insertAdjacentHTML("beforeend",'<td class="is-hidden-print has-text-right is-nowrap">'+(t.canUpdate?'<a class="button is-small" data-tooltip="Edit Location" href="/locations/'+t.locationID.toString()+'/edit"><span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span> <span>Edit</span></a>':"")+(e?' <button class="button is-small is-danger is-delete-location-button" data-tooltip="Delete Location" data-location-index="'+n.toString()+'" type="button"><span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span></button>':"")+"</td>"),e&&a.getElementsByClassName("is-delete-location-button")[0].addEventListener("click",l)}return a})(t,a);n.insertAdjacentElement("beforeend",s)}),s.insertAdjacentHTML("beforeend",'<div class="level is-block-print"><div class="level-left has-text-weight-bold">Displaying locations '+(d+1).toString()+" to "+Math.min(c+d,t.count).toString()+" of "+t.count.toString()+"</div></div>"),c<t.count){const e=document.createElement("nav");if(e.className="level-right is-hidden-print",e.setAttribute("role","pagination"),e.setAttribute("aria-label","pagination"),d>0){const t=document.createElement("a");t.className="button",t.innerText="Previous",t.addEventListener("click",e=>{e.preventDefault(),a.value=Math.max(0,d-c).toString(),r()}),e.insertAdjacentElement("beforeend",t)}if(c+d<t.count){const t=document.createElement("a");t.className="button ml-3",t.innerHTML='<span>Next Locations</span><span class="icon"><i class="fas fa-chevron-right" aria-hidden="true"></i></span>',t.addEventListener("click",e=>{e.preventDefault(),a.value=(d+c).toString(),r()}),e.insertAdjacentElement("beforeend",t)}s.getElementsByClassName("level")[0].insertAdjacentElement("beforeend",e)}})},c=()=>{a.value="0",r()},l=t=>{t.preventDefault();const n=parseInt(t.currentTarget.getAttribute("data-location-index"),10),a=o[n];cityssm.confirmModal("Delete Location",`Are you sure you want to delete ${cityssm.escapeHTML(a.locationDisplayName)}?`,"Yes, Delete","warning",()=>{cityssm.postJSON(e+"/locations/doDelete",{locationID:a.locationID},e=>{e.success&&r()})})};t.addEventListener("submit",e=>{e.preventDefault()}),document.getElementById("filter--locationNameAddress").addEventListener("change",c),document.getElementById("filter--locationIsDistributor").addEventListener("change",c),document.getElementById("filter--locationIsManufacturer").addEventListener("change",c),document.getElementById("filter--locationIsActive").addEventListener("change",c),c()})();